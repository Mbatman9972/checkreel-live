<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CheckReel Dashboard</title>
<link rel="icon" type="image/x-icon" href="images/favicon.ico">
<style>
* {
margin: 0;
padding: 0;
box-sizing: border-box;
}

body {
font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
background: linear-gradient(135deg, #1e3c72 0%, #2a5298 25%, #667eea 50%, #764ba2 75%, #8e44ad 100%);
min-height: 100vh;
color: #333;
}

body[dir="rtl"] {
    direction: rtl;
}

body[dir="rtl"] .container {
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
}

body[dir="rtl"] .card {
    display: block !important;
    visibility: visible !important;
}

.container {
max-width: 1200px;
margin: 0 auto;
padding: 20px;
}

.header {
display: flex;
justify-content: space-between;
align-items: center;
background: rgba(255, 255, 255, 0.95);
backdrop-filter: blur(10px);
padding: 15px 30px;
border-radius: 15px;
margin-bottom: 30px;
box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
}

.logo-section {
display: flex;
align-items: center;
gap: 15px;
}

.logo-img {
width: 45px;
height: 45px;
border-radius: 10px;
}

.logo-text {
font-size: 24px;
font-weight: bold;
background: linear-gradient(45deg, #1e3c72, #667eea);
-webkit-background-clip: text;
-webkit-text-fill-color: transparent;
background-clip: text;
}

.user-section {
display: flex;
align-items: center;
gap: 20px;
}

.tier-badge {
padding: 8px 16px;
border-radius: 20px;
font-size: 12px;
font-weight: 600;
text-transform: uppercase;
letter-spacing: 0.5px;
}

.tier-free { background: #e3f2fd; color: #1976d2; }
.tier-plus { background: #f3e5f5; color: #7b1fa2; }
.tier-premium { background: #fff3e0; color: #f57c00; }

.dashboard-grid {
display: grid;
grid-template-columns: 1fr 1fr 1fr;
gap: 20px;
margin-bottom: 30px;
}

.card {
background: rgba(255, 255, 255, 0.95);
backdrop-filter: blur(10px);
border-radius: 20px;
padding: 25px;
box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
}

.card h2 {
margin-bottom: 20px;
color: #333;
display: flex;
align-items: center;
gap: 10px;
font-size: 18px;
}

.region-grid {
display: grid;
grid-template-columns: repeat(2, 1fr);
gap: 10px;
margin-bottom: 15px;
}

.region-option {
display: flex;
flex-direction: column;
align-items: center;
padding: 15px;
border: 2px solid #e0e0e0;
border-radius: 12px;
cursor: pointer;
transition: all 0.3s ease;
background: white;
text-align: center;
}

.region-option:hover {
transform: translateY(-2px);
box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
}

.region-option.selected {
border-color: #1e3c72;
background: linear-gradient(135deg, #1e3c72 0%, #667eea 100%);
color: white;
animation: glowPulse 2s infinite ease-in-out;
}

@keyframes glowPulse {
0%, 100% {
box-shadow: 0 0 20px rgba(30, 60, 114, 0.7);
}
50% {
box-shadow: 0 0 30px rgba(30, 60, 114, 1), 0 0 40px rgba(102, 126, 234, 0.8);
}
}

.region-icon {
width: 35px;
height: 35px;
margin-bottom: 8px;
border-radius: 6px;
object-fit: cover;
}

.region-name {
font-size: 12px;
font-weight: 600;
}

.platforms-grid {
display: grid;
grid-template-columns: repeat(3, 1fr);
gap: 12px;
}

.platform-option {
display: flex;
flex-direction: column;
align-items: center;
padding: 15px;
border: 2px solid #e0e0e0;
border-radius: 12px;
cursor: pointer;
transition: all 0.3s ease;
background: white;
position: relative;
overflow: hidden;
}

.platform-option:hover {
transform: translateY(-2px);
box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
}

.platform-option.selected {
border-color: #ff1493;
background: linear-gradient(135deg, #ff1493 0%, #ff69b4 100%);
color: white;
animation: pinkGlow 2s infinite ease-in-out;
}

@keyframes pinkGlow {
0%, 100% {
box-shadow: 0 0 20px rgba(255, 20, 147, 0.7);
}
50% {
box-shadow: 0 0 30px rgba(255, 20, 147, 1), 0 0 40px rgba(255, 105, 180, 0.8);
}
}

.platform-icon {
width: 35px;
height: 35px;
margin-bottom: 8px;
border-radius: 6px;
object-fit: cover;
transition: all 0.3s ease;
opacity: 1;
}

.platform-option.selected .platform-icon {
opacity: 1;
filter: brightness(1.2) contrast(1.1);
}

.platform-name {
font-size: 11px;
font-weight: 600;
text-align: center;
}

.upload-area {
border: 3px dashed #ddd;
border-radius: 15px;
padding: 30px;
text-align: center;
cursor: pointer;
transition: all 0.3s ease;
background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
}

.upload-area:hover {
border-color: #1e3c72;
background: linear-gradient(135deg, #e3f2fd 0%, #f8f9fa 100%);
}

.upload-area.dragover {
border-color: #1e3c72;
background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
transform: scale(1.02);
}

.upload-icon {
font-size: 36px;
margin-bottom: 10px;
display: block;
}

.file-info {
display: none;
text-align: center;
padding: 20px;
background: #f8f9fa;
border-radius: 10px;
border: 2px solid #28a745;
}

.file-name {
font-weight: 600;
margin-bottom: 5px;
}

.remove-file {
background: #dc3545;
color: white;
border: none;
padding: 8px 16px;
border-radius: 5px;
cursor: pointer;
margin-top: 10px;
}

.tier-selection {
background: rgba(255, 255, 255, 0.95);
backdrop-filter: blur(10px);
border-radius: 20px;
padding: 25px;
margin-bottom: 20px;
box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
}

.tier-plans {
display: grid;
grid-template-columns: repeat(3, 1fr);
gap: 15px;
margin-top: 15px;
}

.tier-plan {
background: white;
border: 2px solid #e0e0e0;
border-radius: 15px;
padding: 20px;
text-align: center;
cursor: pointer;
transition: all 0.3s ease;
position: relative;
}

.tier-plan:hover {
transform: translateY(-3px);
box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
}

.tier-plan.active {
border-color: #1e3c72;
background: linear-gradient(135deg, #1e3c72 0%, #667eea 100%);
color: white;
}

.tier-plan.recommended {
border-color: #ff6b6b;
}

.tier-plan.recommended::before {
content: "RECOMMENDED";
position: absolute;
top: -10px;
left: 50%;
transform: translateX(-50%);
background: #ff6b6b;
color: white;
padding: 4px 12px;
border-radius: 12px;
font-size: 10px;
font-weight: bold;
}

.tier-name {
font-size: 16px;
font-weight: bold;
margin-bottom: 8px;
}

.tier-price {
font-size: 18px;
font-weight: bold;
color: #1e3c72;
margin-bottom: 8px;
}

.tier-plan.active .tier-price {
color: white;
}

.tier-scans {
font-size: 12px;
opacity: 0.8;
margin-bottom: 10px;
}

.tier-features {
font-size: 11px;
opacity: 0.9;
line-height: 1.4;
}

.selection-alert {
background: linear-gradient(135deg, #ff6b6b, #ff8e8e);
color: white;
padding: 15px 25px;
border-radius: 10px;
margin-bottom: 20px;
text-align: center;
font-weight: 600;
box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
}

.selection-alert.hidden {
display: none;
}

.scan-section {
text-align: center;
margin-top: 30px;
position: relative;
z-index: 10;
}

.scan-btn {
background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
color: white;
border: none;
padding: 15px 40px;
border-radius: 25px;
font-size: 18px;
font-weight: 600;
cursor: pointer;
transition: all 0.3s ease;
display: inline-flex;
align-items: center;
gap: 10px;
min-width: 200px;
justify-content: center;
position: relative;
}

.scan-btn:disabled {
background: #ccc;
cursor: not-allowed;
}

.scan-btn.ready {
background: linear-gradient(135deg, #1e3c72 0%, #667eea 100%);
box-shadow: 0 8px 25px rgba(30, 60, 114, 0.3);
}

.scan-btn.ready:hover {
transform: translateY(-2px);
box-shadow: 0 12px 35px rgba(30, 60, 114, 0.4);
}

.btn-loader {
display: none;
width: 20px;
height: 20px;
border: 2px solid transparent;
border-top: 2px solid white;
border-radius: 50%;
animation: spin 1s linear infinite;
}

.btn-loader.active {
display: block;
}

@keyframes spin {
0% { transform: rotate(0deg); }
100% { transform: rotate(360deg); }
}

.scan-history {
background: rgba(255, 255, 255, 0.95);
backdrop-filter: blur(10px);
border-radius: 20px;
padding: 25px;
margin-top: 50px;
margin-bottom: 30px;
box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
display: none;
}

.scan-history.visible {
display: block;
}

.history-tabs {
display: flex;
gap: 10px;
margin-bottom: 20px;
border-bottom: 2px solid #e0e0e0;
}

.history-tab {
padding: 10px 20px;
background: none;
border: none;
cursor: pointer;
font-weight: 600;
color: #666;
transition: all 0.3s ease;
border-bottom: 3px solid transparent;
}

.history-tab.active {
color: #1e3c72;
border-bottom-color: #1e3c72;
}

.history-list {
max-height: 300px;
overflow-y: auto;
}

.history-item {
display: flex;
justify-content: space-between;
align-items: center;
padding: 15px;
background: #f8f9fa;
border-radius: 10px;
margin-bottom: 10px;
cursor: pointer;
transition: all 0.3s ease;
}

.history-item:hover {
background: #e3f2fd;
transform: translateX(5px);
}

.history-date {
font-size: 12px;
color: #666;
}

.countries-modal {
display: none;
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: rgba(0, 0, 0, 0.8);
z-index: 1000;
padding: 20px;
}

.countries-content {
background: white;
border-radius: 20px;
padding: 30px;
max-width: 600px;
max-height: 80vh;
margin: 50px auto;
overflow-y: auto;
position: relative;
}

.close-modal {
position: absolute;
top: 15px;
right: 20px;
background: none;
border: none;
font-size: 24px;
cursor: pointer;
color: #666;
}

.countries-grid {
display: grid;
grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
gap: 10px;
margin-top: 20px;
}

.country-item {
padding: 10px;
background: #f8f9fa;
border-radius: 8px;
text-align: center;
cursor: pointer;
transition: all 0.3s ease;
border: 2px solid transparent;
}

.country-item:hover {
background: #e3f2fd;
border-color: #1e3c72;
}

.results-section {
display: none;
margin-top: 40px;
margin-bottom: 40px;
}

.score-display {
display: flex;
align-items: center;
justify-content: center;
gap: 40px;
margin-bottom: 40px;
padding: 20px;
}

.score-circle {
width: 120px;
height: 120px;
border-radius: 50%;
display: flex;
align-items: center;
justify-content: center;
position: relative;
box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
}

.score-circle::before {
content: '';
width: 80px;
height: 80px;
background: white;
border-radius: 50%;
position: absolute;
}

.score-value {
font-size: 24px;
font-weight: bold;
z-index: 1;
color: #333;
}

.status-indicator {
display: flex;
align-items: center;
gap: 10px;
font-size: 18px;
font-weight: 600;
}

.status-icon {
font-size: 24px;
}

.results-grid {
display: grid;
grid-template-columns: 1fr 1fr;
gap: 20px;
}

.issues-card, .recommendations-card {
background: white;
padding: 20px;
border-radius: 15px;
box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
}

.issue-item, .recommendation-item {
display: flex;
align-items: flex-start;
gap: 12px;
padding: 15px;
margin-bottom: 12px;
background: #f8f9fa;
border-radius: 8px;
cursor: pointer;
transition: all 0.3s ease;
line-height: 1.4;
min-height: 60px;
}

.issue-item:hover, .recommendation-item:hover {
background: #e3f2fd;
transform: translateX(5px);
}

.insight-modal {
display: none;
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: rgba(0, 0, 0, 0.8);
z-index: 1000;
padding: 20px;
}

.insight-content {
background: white;
border-radius: 20px;
padding: 30px;
max-width: 500px;
margin: 50px auto;
position: relative;
}

.insight-content h3 {
margin-bottom: 20px;
color: #1e3c72;
}

.stats-grid {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
gap: 15px;
margin-bottom: 20px;
}

.stat-card {
background: rgba(255, 255, 255, 0.95);
backdrop-filter: blur(10px);
padding: 15px;
border-radius: 15px;
text-align: center;
box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
}

.stat-number {
font-size: 20px;
font-weight: bold;
color: #1e3c72;
margin-bottom: 5px;
}

.stat-label {
color: #666;
font-size: 12px;
}

.footer {
text-align: center;
padding: 20px 0;
color: rgba(255, 255, 255, 0.8);
font-size: 14px;
margin-top: 40px;
}

@media (max-width: 1024px) {
.dashboard-grid {
grid-template-columns: 1fr 1fr;
}
}

@media (max-width: 768px) {
.dashboard-grid {
grid-template-columns: 1fr;
}
.platforms-grid {
grid-template-columns: repeat(2, 1fr);
}
.region-grid {
grid-template-columns: 1fr;
}
.tier-plans {
grid-template-columns: 1fr;
}
.score-display {
flex-direction: column;
gap: 20px;
}
}
</style>
</head>
<body>
<div class="container">
<div class="header">
<div class="logo-section">
<img src="images/logo.png" alt="CheckReel Logo" class="logo-img">
<span class="logo-text">CheckReel</span>
</div>
<div class="user-section">
<span id="scansLeft">3 scans left</span>
<span id="tierBadge" class="tier-badge tier-free">Free Trial</span>
</div>
</div>

<div class="tier-selection">
<h2 id="choose-plan">Choose Your Plan</h2>
<div class="tier-plans">
<div class="tier-plan active" data-tier="free" onclick="selectTier('free')">
<div class="tier-name" id="free-trial">Free Trial</div>
<div class="tier-price">$0</div>
<div class="tier-scans" id="free-scans">3 scans</div>
<div class="tier-features" id="free-features">Basic compliance check<br>Standard results</div>
</div>
<div class="tier-plan recommended" data-tier="plus" onclick="selectTier('plus')">
<div class="tier-name" id="plus-tier">Plus</div>
<div class="tier-price">$4.99/<span id="per-month">mo</span></div>
<div class="tier-scans" id="plus-scans">20 scans/month</div>
<div class="tier-features" id="plus-features">Enhanced compliance check<br>Detailed insights<br>Scan history<br>Priority support</div>
</div>
<div class="tier-plan" data-tier="premium" onclick="selectTier('premium')">
<div class="tier-name" id="premium-tier">Premium</div>
<div class="tier-price">$9.99/<span id="per-month-premium">mo</span></div>
<div class="tier-scans" id="premium-scans">40 scans/month</div>
<div class="tier-features" id="premium-features">Full compliance suite<br>Advanced analytics<br>Team features<br>White-label reports<br>API access<br>Dedicated support</div>
</div>
</div>
</div>

<div id="insightModal" class="insight-modal">
<div class="insight-content">
<button class="close-modal" onclick="closeInsightModal()">&times;</button>
<h3 id="insightTitle">Insight Details</h3>
<div id="insightContent"></div>
</div>
</div>

<div class="footer">
<p>&copy; 2025 CheckReel. All rights reserved. Copyright Protected.</p>
</div>
</div>

<script src="lang-loader.js"></script>

<script>
// Global variables
let selectedFile = null;
let selectedPlatforms = [];
let selectedRegion = null;
let selectedCountry = null;
let currentTier = 'free';
let scanHistory = [];
let currentLanguage = 'en';

// Safe storage wrapper
if (!window.safeStorage) {
  window.safeStorage = {
    getItem: (k) => { try { return localStorage.getItem(k); } catch { return null } },
    setItem: (k,v) => { try { localStorage.setItem(k,v) } catch {} },
    removeItem: (k) => { try { localStorage.removeItem(k) } catch {} }
  };
}

// Language content for dashboard elements
const DASHBOARD_TRANSLATIONS = {
    en: {
        'choose-plan': 'Choose Your Plan',
        'free-trial': 'Free Trial',
        'plus-tier': 'Plus',
        'premium-tier': 'Premium',
        'per-month': 'mo',
        'free-scans': '3 scans',
        'plus-scans': '20 scans/month',
        'premium-scans': '40 scans/month',
        'free-features': 'Basic compliance check<br>Standard results',
        'plus-features': 'Enhanced compliance check<br>Detailed insights<br>Scan history<br>Priority support',
        'premium-features': 'Full compliance suite<br>Advanced analytics<br>Team features<br>White-label reports<br>API access<br>Dedicated support',
        'selection-alert': 'Please select a region and platform before uploading content for analysis',
        'select-region': 'Select Region',
        'select-platform': 'Select Target Platform',
        'upload-content': 'Upload Content to Check',
        'drop-here': 'Drop your content here',
        'click-browse': 'or click to browse files',
        'start-check': 'Start Content Check',
        'analyzing': 'Analyzing...',
        'scan-history-title': 'Scan History',
        'all-scans': 'All Scans',
        'by-region': 'By Region',
        'by-platform': 'By Platform',
        'compliance-report': 'Compliance Report',
        'issues-found': 'Issues Found',
        'recommendations': 'Recommendations',
        'active-users': 'Active Users',
        'content-scanned': 'Content Scanned',
        'success-rate': 'Success Rate',
        'platforms': 'Platforms',
        'scans-used': 'Scans Used (Testing)',
        'scans-left': 'scans left',
        'recommended': 'RECOMMENDED'
    },
    fr: {
        'choose-plan': 'Choisissez votre plan',
        'free-trial': 'Essai gratuit',
        'plus-tier': 'Plus',
        'premium-tier': 'Premium',
        'per-month': 'mois',
        'free-scans': '3 analyses',
        'plus-scans': '20 analyses/mois',
        'premium-scans': '40 analyses/mois',
        'free-features': 'Vérification de conformité de base<br>Résultats standards',
        'plus-features': 'Vérification de conformité améliorée<br>Informations détaillées<br>Historique des analyses<br>Support prioritaire',
        'premium-features': 'Suite de conformité complète<br>Analyses avancées<br>Fonctionnalités d\'équipe<br>Rapports en marque blanche<br>Accès API<br>Support dédié',
        'selection-alert': 'Veuillez sélectionner une région et une plateforme avant de télécharger le contenu pour analyse',
        'select-region': 'Sélectionner la région',
        'select-platform': 'Sélectionner la plateforme cible',
        'upload-content': 'Télécharger le contenu à vérifier',
        'drop-here': 'Déposez votre contenu ici',
        'click-browse': 'ou cliquez pour parcourir les fichiers',
        'start-check': 'Commencer la vérification du contenu',
        'analyzing': 'Analyse en cours...',
        'scan-history-title': 'Historique des analyses',
        'all-scans': 'Toutes les analyses',
        'by-region': 'Par région',
        'by-platform': 'Par plateforme',
        'compliance-report': 'Rapport de conformité',
        'issues-found': 'Problèmes trouvés',
        'recommendations': 'Recommandations',
        'active-users': 'Utilisateurs actifs',
        'content-scanned': 'Contenu analysé',
        'success-rate': 'Taux de réussite',
        'platforms': 'Plateformes',
        'scans-used': 'Analyses utilisées (Test)',
        'scans-left': 'analyses restantes',
        'recommended': 'RECOMMANDÉ'
    },
    ar: {
        'choose-plan': 'اختر خطتك',
        'free-trial': 'تجربة مجانية',
        'plus-tier': 'بلس',
        'premium-tier': 'بريميوم',
        'per-month': 'شهر',
        'free-scans': '3 فحوصات',
        'plus-scans': '20 فحص/شهر',
        'premium-scans': '40 فحص/شهر',
        'free-features': 'فحص امتثال أساسي<br>نتائج قياسية',
        'plus-features': 'فحص امتثال محسّن<br>رؤى مفصلة<br>سجل الفحوصات<br>دعم ذو أولوية',
        'premium-features': 'مجموعة امتثال كاملة<br>تحليلات متقدمة<br>ميزات الفريق<br>تقارير بعلامة تجارية خاصة<br>الوصول إلى API<br>دعم مخصص',
        'selection-alert': 'يرجى اختيار منطقة ومنصة قبل تحميل المحتوى للتحليل',
        'select-region': 'اختر المنطقة',
        'select-platform': 'اختر المنصة المستهدفة',
        'upload-content': 'ارفع المحتوى للفحص',
        'drop-here': 'اسقط محتواك هنا',
        'click-browse': 'أو انقر لاستعراض الملفات',
        'start-check': 'ابدأ فحص المحتوى',
        'analyzing': 'جاري التحليل...',
        'scan-history-title': 'سجل الفحوصات',
        'all-scans': 'جميع الفحوصات',
        'by-region': 'حسب المنطقة',
        'by-platform': 'حسب المنصة',
        'compliance-report': 'تقرير الامتثال',
        'issues-found': 'المشاكل المكتشفة',
        'recommendations': 'التوصيات',
        'active-users': 'المستخدمون النشطون',
        'content-scanned': 'المحتوى المفحوص',
        'success-rate': 'معدل النجاح',
        'platforms': 'المنصات',
        'scans-used': 'الفحوصات المستخدمة (اختبار)',
        'scans-left': 'فحوصات متبقية',
        'recommended': 'موصى به'
    }
};

// Apply dashboard translations
function applyDashboardTranslations(lang) {
    const translations = DASHBOARD_TRANSLATIONS[lang] || DASHBOARD_TRANSLATIONS['en'];
    
    Object.keys(translations).forEach(key => {
        const element = document.getElementById(key);
        if (element) {
            if (key.includes('features')) {
                element.innerHTML = translations[key];
            } else {
                element.textContent = translations[key];
            }
        }
    });
    
    updateTierDisplay();
}

// Initialize dashboard with language persistence
document.addEventListener('DOMContentLoaded', function() {
    currentLanguage = safeStorage.getItem('checkreel_language') || 'en';
    console.log('Dashboard loading with language:', currentLanguage);
    
    if (window.loadLanguageContent) {
        window.loadLanguageContent(currentLanguage);
    }
    
    setTimeout(() => {
        applyDashboardTranslations(currentLanguage);
        
        if (currentLanguage === 'ar') {
            document.body.setAttribute('dir', 'rtl');
            document.documentElement.setAttribute('dir', 'rtl');
        } else {
            document.body.removeAttribute('dir');
            document.documentElement.removeAttribute('dir');
        }
    }, 100);
    
    initializeUpload();
    updateTierDisplay();
    updateUserCounter();
    updateScansCounter();
    loadScanHistory();
    
    console.log('✅ Dashboard loaded with full language support');
});

// Countries data
const countriesData = {
    middleEast: [
        'Palestine', 'Jordan', 'Lebanon', 'Syria', 'Iraq', 'Kuwait', 'Saudi Arabia',
        'Bahrain', 'Qatar', 'United Arab Emirates', 'Oman', 'Yemen', 'Iran', 'Turkey', 'Cyprus'
    ],
    mena: [
        'Palestine', 'Jordan', 'Lebanon', 'Syria', 'Iraq', 'Kuwait', 'Saudi Arabia',
        'Bahrain', 'Qatar', 'United Arab Emirates', 'Oman', 'Yemen', 'Iran', 'Turkey',
        'Egypt', 'Libya', 'Tunisia', 'Algeria', 'Morocco', 'Sudan', 'Mauritania', 'Djibouti', 'Somalia'
    ],
    europe: [
        'Albania', 'Andorra', 'Armenia', 'Austria', 'Azerbaijan', 'Belarus', 'Belgium',
        'Bosnia and Herzegovina', 'Bulgaria', 'Croatia', 'Cyprus', 'Czech Republic',
        'Denmark', 'Estonia', 'Finland', 'France', 'Georgia', 'Germany', 'Greece',
        'Hungary', 'Iceland', 'Ireland', 'Italy', 'Kazakhstan', 'Kosovo', 'Latvia',
        'Liechtenstein', 'Lithuania', 'Luxembourg', 'Malta', 'Moldova', 'Monaco',
        'Montenegro', 'Netherlands', 'North Macedonia', 'Norway', 'Poland', 'Portugal',
        'Romania', 'Russia', 'San Marino', 'Serbia', 'Slovakia', 'Slovenia', 'Spain',
        'Sweden', 'Switzerland', 'Ukraine', 'United Kingdom', 'Vatican City'
    ]
};

// Tier selection
function selectTier(tier) {
    currentTier = tier;
    safeStorage.setItem('checkreel_tier', tier);
    
    document.querySelectorAll('.tier-plan').forEach(plan => {
        plan.classList.remove('active');
    });
    document.querySelector(`[data-tier="${tier}"]`).classList.add('active');
    
    if (tier !== 'free') {
        safeStorage.setItem('checkreel_scans_used', '0');
    }
    
    updateTierDisplay();
    updateScansCounter();
    updatePlatformCounter();
    
    const historySection = document.getElementById('scanHistory');
    if (tier === 'plus' || tier === 'premium') {
        historySection.classList.add('visible');
    } else {
        historySection.classList.remove('visible');
    }
}

// Region selection
function selectRegion(region) {
    selectedRegion = region;
    document.querySelectorAll('.region-option').forEach(opt => opt.classList.remove('selected'));
    document.querySelector(`[data-region="${region}"]`).classList.add('selected');
    updateScanButton();
    updateSelectionAlert();
}

// Platform selection
function selectPlatform(platform) {
    const userTier = safeStorage.getItem('checkreel_tier') || 'free';
    const platformElement = document.querySelector(`[data-platform="${platform}"]`);
    
    if (userTier === 'premium') {
        if (selectedPlatforms.includes(platform)) {
            selectedPlatforms = selectedPlatforms.filter(p => p !== platform);
            platformElement.classList.remove('selected');
        } else {
            if (selectedPlatforms.length < 3) {
                selectedPlatforms.push(platform);
                platformElement.classList.add('selected');
            } else {
                alert('Premium users can select up to 3 platforms per scan');
            }
        }
    } else {
        selectedPlatforms = [platform];
        document.querySelectorAll('.platform-option').forEach(opt => opt.classList.remove('selected'));
        platformElement.classList.add('selected');
    }
    
    updatePlatformCounter();
    updateScanButton();
    updateSelectionAlert();
}

// Update platform counter
function updatePlatformCounter() {
    const counterEl = document.getElementById("platformCounter");
    const userTier = safeStorage.getItem('checkreel_tier') || 'free';
    
    if (userTier === "premium" && counterEl) {
        counterEl.textContent = `(${selectedPlatforms.length}/3 selected)`;
    } else if (counterEl) {
        counterEl.textContent = '';
    }
}

// Countries modal functions
function showCountries(region) {
    const modal = document.getElementById('countriesModal');
    const grid = document.getElementById('countriesGrid');
    const title = document.getElementById('modalTitle');
    title.textContent = `Select Country - ${region.charAt(0).toUpperCase() + region.slice(1)}`;
    grid.innerHTML = '';
    
    countriesData[region].forEach(country => {
        const item = document.createElement('div');
        item.className = 'country-item';
        item.textContent = country;
        item.onclick = () => selectCountry(country);
        grid.appendChild(item);
    });
    
    modal.style.display = 'block';
}

function selectCountry(country) {
    selectedCountry = country;
    closeCountriesModal();
}

function closeCountriesModal() {
    document.getElementById('countriesModal').style.display = 'none';
}

// Update selection alert
function updateSelectionAlert() {
    const alert = document.getElementById('selectionAlert');
    if (selectedRegion && selectedPlatforms.length > 0) {
        alert.classList.add('hidden');
    } else {
        alert.classList.remove('hidden');
    }
}

// File upload functionality
function initializeUpload() {
    const uploadArea = document.getElementById('uploadArea');
    const fileInput = document.getElementById('fileInput');
    const fileInfo = document.getElementById('fileInfo');
    const removeFileBtn = document.getElementById('removeFile');
    
    if (!uploadArea || !fileInput) return;
    
    uploadArea.addEventListener('click', () => {
        if (!selectedRegion || selectedPlatforms.length === 0) {
            const translations = DASHBOARD_TRANSLATIONS[currentLanguage] || DASHBOARD_TRANSLATIONS['en'];
            alert(translations['selection-alert']);
            return;
        }
        fileInput.click();
    });
    
    fileInput.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (file && selectedRegion && selectedPlatforms.length > 0) {
            handleFileSelect(file);
        }
    });
    
    uploadArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        if (selectedRegion && selectedPlatforms.length > 0) {
            uploadArea.classList.add('dragover');
        }
    });
    
    uploadArea.addEventListener('dragleave', (e) => {
        e.preventDefault();
        uploadArea.classList.remove('dragover');
    });
    
    uploadArea.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadArea.classList.remove('dragover');
        if (!selectedRegion || selectedPlatforms.length === 0) {
            const translations = DASHBOARD_TRANSLATIONS[currentLanguage] || DASHBOARD_TRANSLATIONS['en'];
            alert(translations['selection-alert']);
            return;
        }
        const file = e.dataTransfer.files[0];
        if (file) {
            handleFileSelect(file);
        }
    });
    
    if (removeFileBtn) {
        removeFileBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            clearSelectedFile();
        });
    }
}

function handleFileSelect(file) {
    const allowedTypes = ['video/mp4', 'video/quicktime', 'image/jpeg', 'image/png', 'audio/mp3', 'audio/wav'];
    if (!allowedTypes.includes(file.type)) {
        alert('Unsupported file type. Please select MP4, MOV, JPG, PNG, MP3, or WAV files.');
        return;
    }
    
    const maxSize = 100 * 1024 * 1024;
    if (file.size > maxSize) {
        alert('File size too large. Please select a file smaller than 100MB.');
        return;
    }
    
    selectedFile = file;
    displayFileInfo(file);
    updateScanButton();
}

function displayFileInfo(file) {
    const uploadArea = document.getElementById('uploadArea');
    const fileInfo = document.getElementById('fileInfo');
    const fileName = document.getElementById('fileName');
    const fileSize = document.getElementById('fileSize');
    
    if (fileName) fileName.textContent = file.name;
    if (fileSize) fileSize.textContent = formatFileSize(file.size);
    if (uploadArea) uploadArea.style.display = 'none';
    if (fileInfo) fileInfo.style.display = 'block';
}

function clearSelectedFile() {
    const uploadArea = document.getElementById('uploadArea');
    const fileInfo = document.getElementById('fileInfo');
    const fileInput = document.getElementById('fileInput');
    
    selectedFile = null;
    if (fileInput) fileInput.value = '';
    if (uploadArea) uploadArea.style.display = 'block';
    if (fileInfo) fileInfo.style.display = 'none';
    updateScanButton();
}

function formatFileSize(bytes) {
    if (bytes === 0) return '0 Bytes';
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}

function updateScanButton() {
    const scanBtn = document.getElementById('scanBtn');
    if (!scanBtn) return;
    
    const canScan = selectedFile && selectedPlatforms.length > 0 && selectedRegion;
    scanBtn.disabled = !canScan;
    
    if (canScan) {
        scanBtn.classList.add('ready');
    } else {
        scanBtn.classList.remove('ready');
    }
}

// Scan functionality
const scanBtn = document.getElementById('scanBtn');
if (scanBtn) {
    scanBtn.addEventListener('click', async function() {
        if (!selectedFile || selectedPlatforms.length === 0 || !selectedRegion) return;
        
        if (!checkScanLimit()) {
            alert('You have reached your scan limit! Please upgrade your plan.');
            return;
        }
        
        await performScan();
    });
}

function checkScanLimit() {
    const userTier = safeStorage.getItem('checkreel_tier') || 'free';
    const scansUsed = parseInt(safeStorage.getItem('checkreel_scans_used') || '0');
    const limits = {
        free: 3,
        plus: 20,
        premium: 40
    };
    return scansUsed < limits[userTier];
}

async function performScan() {
    const scanBtn = document.getElementById('scanBtn');
    const btnText = document.getElementById('start-check');
    const btnLoader = document.getElementById('btnLoader');
    const resultsSection = document.getElementById('resultsSection');
    
    if (!scanBtn) return;
    
    const translations = DASHBOARD_TRANSLATIONS[currentLanguage] || DASHBOARD_TRANSLATIONS['en'];
    
    scanBtn.disabled = true;
    if (btnText) btnText.textContent = translations['analyzing'];
    if (btnLoader) btnLoader.classList.add('active');
    
    try {
        await new Promise(resolve => setTimeout(resolve, 3000));
        
        const results = generateDynamicResults();
        displayResults(results);
        saveScanToHistory(results);
        incrementScanCount();
        updateTierDisplay();
        updateScansCounter();
        
        if (resultsSection) {
            resultsSection.scrollIntoView({ behavior: 'smooth' });
        }
        
    } catch (error) {
        console.error('Scan error:', error);
        alert('An error occurred during scanning. Please try again.');
    } finally {
        scanBtn.disabled = false;
        if (btnText) btnText.textContent = translations['start-check'];
        if (btnLoader) btnLoader.classList.remove('active');
    }
}

function generateDynamicResults() {
    const userTier = safeStorage.getItem('checkreel_tier') || 'free';
    const scenarios = [
        { score: 95, issueCount: 0 },
        { score: 85, issueCount: 2 },
        { score: 70, issueCount: 4 },
        { score: 55, issueCount: 6 },
        { score: 40, issueCount: 8 }
    ];
    
    const scenario = scenarios[Math.floor(Math.random() * scenarios.length)];
    let issues, recommendations, status, statusIcon;
    
    // Generate multilingual status messages
    if (scenario.score >= 90) {
        if (currentLanguage === 'fr') {
            status = 'Parfait! Prêt à publier';
        } else if (currentLanguage === 'ar') {
            status = 'مثالي! جاهز للنشر';
        } else {
            status = 'Perfect! Ready to Post';
        }
        statusIcon = '✅';
    } else if (scenario.score >= 80) {
        if (currentLanguage === 'fr') {
            status = 'Bon à publier';
        } else if (currentLanguage === 'ar') {
            status = 'جيد للنشر';
        } else {
            status = 'Good to Post';
        }
        statusIcon = '✅';
    } else if (scenario.score >= 70) {
        if (currentLanguage === 'fr') {
            status = 'Problèmes mineurs - Révision recommandée';
        } else if (currentLanguage === 'ar') {
            status = 'مشاكل بسيطة - يُنصح بالمراجعة';
        } else {
            status = 'Minor Issues - Review Recommended';
        }
        statusIcon = '⚠️';
    } else if (scenario.score >= 60) {
        if (currentLanguage === 'fr') {
            status = 'Problèmes modérés - Corriger avant publication';
        } else if (currentLanguage === 'ar') {
            status = 'مشاكل متوسطة - إصلاح قبل النشر';
        } else {
            status = 'Moderate Issues - Fix Before Posting';
        }
        statusIcon = '⚠️';
    } else {
        if (currentLanguage === 'fr') {
            status = 'Problèmes majeurs - Ne pas publier';
        } else if (currentLanguage === 'ar') {
            status = 'مشاكل كبيرة - لا تنشر';
        } else {
            status = 'Major Issues - Do Not Post';
        }
        statusIcon = '❌';
    }
    
    // Generate multilingual issues and recommendations
    if (userTier === 'free') {
        issues = scenario.issueCount > 0 ? [
            { 
                icon: '⚠️', 
                text: currentLanguage === 'fr' ? 
                    `${scenario.issueCount} problèmes de conformité détectés pour ${selectedPlatforms.join(', ')}` :
                    currentLanguage === 'ar' ?
                    `تم اكتشاف ${scenario.issueCount} مشاكل امتثال لـ ${selectedPlatforms.join(', ')}` :
                    `${scenario.issueCount} compliance issues detected for ${selectedPlatforms.join(', ')}`
            }
        ] : [];
        recommendations = [
            { 
                icon: '💡', 
                text: currentLanguage === 'fr' ? 
                    'Passez à Plus ou Premium pour une analyse détaillée' :
                    currentLanguage === 'ar' ?
                    'ترقية إلى Plus أو Premium للحصول على تحليل مفصل' :
                    'Upgrade to Plus or Premium for detailed analysis'
            }
        ];
    } else if (userTier === 'plus') {
        issues = scenario.issueCount > 0 ? [
            { 
                icon: '🔊', 
                text: currentLanguage === 'fr' ? 
                    `Les niveaux audio dépassent les limites de ${selectedPlatforms.join(', ')}` :
                    currentLanguage === 'ar' ?
                    `مستويات الصوت تتجاوز حدود ${selectedPlatforms.join(', ')}` :
                    `Audio levels exceed ${selectedPlatforms.join(', ')} limits`
            },
            { 
                icon: '📋', 
                text: currentLanguage === 'fr' ? 
                    `Le contenu peut violer les directives communautaires de ${selectedRegion}` :
                    currentLanguage === 'ar' ?
                    `المحتوى قد ينتهك إرشادات مجتمع ${selectedRegion}` :
                    `Content may violate ${selectedRegion} community guidelines`
            }
        ].slice(0, Math.min(scenario.issueCount, 2)) : [];
        
        recommendations = [
            { 
                icon: '📈', 
                text: currentLanguage === 'fr' ? 
                    `Utilisez des hashtags tendance pour ${selectedPlatforms.join(', ')}` :
                    currentLanguage === 'ar' ?
                    `استخدم الهاشتاجات الرائجة لـ ${selectedPlatforms.join(', ')}` :
                    `Use trending hashtags for ${selectedPlatforms.join(', ')}`
            },
            { 
                icon: '⏰', 
                text: currentLanguage === 'fr' ? 
                    `Meilleur moment de publication pour ${selectedRegion}: 19h-21h local` :
                    currentLanguage === 'ar' ?
                    `أفضل وقت للنشر في ${selectedRegion}: 7-9 مساءً بالتوقيت المحلي` :
                    `Best posting time for ${selectedRegion}: 7-9 PM local`
            }
        ];
    } else { // premium
        issues = scenario.issueCount > 0 ? [
            { 
                icon: '🎵', 
                text: currentLanguage === 'fr' ? 
                    'Amélioration audio nécessaire - notre IA recommande l\'optimisation vocale' :
                    currentLanguage === 'ar' ?
                    'تحسين الصوت مطلوب - ذكائنا الاصطناعي يوصي بتحسين الصوت' :
                    'Audio enhancement needed - our AI recommends voice optimization'
            },
            { 
                icon: '📹', 
                text: currentLanguage === 'fr' ? 
                    'Qualité visuelle en dessous des standards de la plateforme' :
                    currentLanguage === 'ar' ?
                    'الجودة البصرية أقل من معايير المنصة' :
                    'Visual quality below platform standards'
            },
            { 
                icon: '⏱️', 
                text: currentLanguage === 'fr' ? 
                    `Le rythme vidéo nécessite un ajustement pour ${selectedPlatforms.join(', ')}` :
                    currentLanguage === 'ar' ?
                    `إيقاع الفيديو يحتاج تعديل لـ ${selectedPlatforms.join(', ')}` :
                    `Video pacing needs adjustment for ${selectedPlatforms.join(', ')}`
            }
        ].slice(0, Math.min(scenario.issueCount, 3)) : [];
        
        recommendations = [
            { 
                icon: '🧠', 
                text: currentLanguage === 'fr' ? 
                    'Analyse IA: Ajustez le rythme du contenu pour un meilleur engagement' :
                    currentLanguage === 'ar' ?
                    'تحليل الذكاء الاصطناعي: اضبط إيقاع المحتوى لمشاركة أفضل' :
                    'AI Analysis: Adjust content pacing for better engagement'
            },
            { 
                icon: '🎯', 
                text: currentLanguage === 'fr' ? 
                    'Conseil d\'optimisation: Ajoutez des accroches plus fortes dans les 3 premières secondes' :
                    currentLanguage === 'ar' ?
                    'نصيحة التحسين: أضف خطافات أقوى في أول 3 ثواني' :
                    'Optimization tip: Add stronger hooks in first 3 seconds'
            },
            { 
                icon: '⭐', 
                text: currentLanguage === 'fr' ? 
                    'Notre IA avancée suggère des ajustements de format pour un potentiel viral' :
                    currentLanguage === 'ar' ?
                    'يقترح الذكاء الاصطناعي لدينا تعديلات في التنسيق لإمكانية الانتشار' :
                    'Our advanced AI suggests format tweaks for viral potential'
            }
       ].slice(0, Math.min(scenario.issueCount, 3));
        
        recommendations = [
            { 
                icon: '🧠', 
                text: currentLanguage === 'fr' ? 
                    'Analyse IA: Ajustez le rythme du contenu pour un meilleur engagement' :
                    currentLanguage === 'ar' ?
                    'تحليل الذكاء الاصطناعي: اضبط إيقاع المحتوى لمشاركة أفضل' :
                    'AI Analysis: Adjust content pacing for better engagement'
            },
            { 
                icon: '🎯', 
                text: currentLanguage === 'fr' ? 
                    'Conseil d\'optimisation: Ajoutez des accroches plus fortes dans les 3 premières secondes' :
                    currentLanguage === 'ar' ?
                    'نصيحة التحسين: أضف خطافات أقوى في أول 3 ثواني' :
                    'Optimization tip: Add stronger hooks in first 3 seconds'
            },
            { 
                icon: '⭐', 
                text: currentLanguage === 'fr' ? 
                    'Notre IA avancée suggère des ajustements de format pour un potentiel viral' :
                    currentLanguage === 'ar' ?
                    'يقترح الذكاء الاصطناعي لدينا تعديلات في التنسيق لإمكانية الانتشار' :
                    'Our advanced AI suggests format tweaks for viral potential'
            }
        ];
    }
    
    return {
        score: scenario.score,
        status,
        statusIcon,
        issues,
        recommendations
    };
}

// The rest of your JavaScript functions (displayResults, saveScanToHistory, incrementScanCount, updateTierDisplay, updateUserCounter, updateScansCounter, loadScanHistory, filterHistory, closeInsightModal) should be here.

</script>
</body>
</html>

