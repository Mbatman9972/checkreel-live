<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CheckReel Dashboard</title>
<link rel="icon" type="image/x-icon" href="images/favicon.ico">
<style>
* {
margin: 0;
padding: 0;
box-sizing: border-box;
}

body {
font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
background: linear-gradient(135deg, #1e3c72 0%, #2a5298 25%, #667eea 50%, #764ba2 75%, #8e44ad 100%);
min-height: 100vh;
color: #333;
}

body[dir="rtl"] {
    direction: rtl;
}

.container {
max-width: 1200px;
margin: 0 auto;
padding: 20px;
}

.header {
display: flex;
justify-content: space-between;
align-items: center;
background: rgba(255, 255, 255, 0.95);
backdrop-filter: blur(10px);
padding: 15px 30px;
border-radius: 15px;
margin-bottom: 30px;
box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
}

.logo-section {
display: flex;
align-items: center;
gap: 15px;
}

.logo-img {
width: 45px;
height: 45px;
border-radius: 10px;
}

.logo-text {
font-size: 24px;
font-weight: bold;
background: linear-gradient(45deg, #1e3c72, #667eea);
-webkit-background-clip: text;
-webkit-text-fill-color: transparent;
background-clip: text;
}

.user-section {
display: flex;
align-items: center;
gap: 20px;
}

.language-selector {
display: flex;
gap: 8px;
}

.lang-btn {
padding: 6px 12px;
border: 2px solid #e0e0e0;
background: white;
border-radius: 6px;
cursor: pointer;
font-weight: 600;
font-size: 11px;
transition: all 0.2s ease;
}

.lang-btn.active {
border-color: #1e3c72;
background: #1e3c72;
color: white;
}

.tier-badge {
padding: 8px 16px;
border-radius: 20px;
font-size: 12px;
font-weight: 600;
text-transform: uppercase;
letter-spacing: 0.5px;
}

.tier-free { background: #e3f2fd; color: #1976d2; }
.tier-plus { background: #f3e5f5; color: #7b1fa2; }
.tier-premium { background: #fff3e0; color: #f57c00; }
/* Admin badge */
.admin-badge {
    background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
    color: white;
    padding: 4px 12px;
    border-radius: 12px;
    font-size: 11px;
    font-weight: bold;
    margin-left: 10px;
    animation: adminGlow 2s infinite;
}

@keyframes adminGlow {
    0%, 100% { box-shadow: 0 0 5px rgba(255, 107, 107, 0.5); }
    50% { box-shadow: 0 0 15px rgba(255, 107, 107, 0.8); }
}

.dashboard-grid {
display: grid;
grid-template-columns: 1fr 1fr 1fr;
gap: 20px;
margin-bottom: 30px;
}

.card {
background: rgba(255, 255, 255, 0.95);
backdrop-filter: blur(10px);
border-radius: 20px;
padding: 25px;
box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
}

.card h2 {
margin-bottom: 20px;
color: #333;
display: flex;
align-items: center;
gap: 10px;
font-size: 18px;
}

.region-grid {
display: grid;
grid-template-columns: repeat(2, 1fr);
gap: 10px;
margin-bottom: 15px;
}

.region-option {
display: flex;
flex-direction: column;
align-items: center;
padding: 15px;
border: 2px solid #e0e0e0;
border-radius: 12px;
cursor: pointer;
transition: all 0.3s ease;
background: white;
text-align: center;
}

.region-option:hover {
transform: translateY(-2px);
box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
}

.region-option.selected {
border-color: #1e3c72;
background: linear-gradient(135deg, #1e3c72 0%, #667eea 100%);
color: white;
animation: glowPulse 2s infinite ease-in-out;
}

@keyframes glowPulse {
0%, 100% {
box-shadow: 0 0 20px rgba(30, 60, 114, 0.7);
}
50% {
box-shadow: 0 0 30px rgba(30, 60, 114, 1), 0 0 40px rgba(102, 126, 234, 0.8);
}
}

.region-icon {
width: 35px;
height: 35px;
margin-bottom: 8px;
border-radius: 6px;
object-fit: cover;
}

/* FIX 3: Global icon visibility */
.region-option[data-region="global"] .region-icon {
    background: #f0f0f0;
    padding: 5px;
}

.region-name {
font-size: 12px;
font-weight: 600;
}

.platforms-grid {
display: grid;
grid-template-columns: repeat(3, 1fr);
gap: 12px;
}

.platform-option {
display: flex;
flex-direction: column;
align-items: center;
padding: 15px;
border: 2px solid #e0e0e0;
border-radius: 12px;
cursor: pointer;
transition: all 0.3s ease;
background: white;
position: relative;
overflow: hidden;
}

.platform-option:hover {
transform: translateY(-2px);
box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
}

.platform-option.selected {
border-color: #ff1493;
background: linear-gradient(135deg, #ff1493 0%, #ff69b4 100%);
color: white;
animation: pinkGlow 2s infinite ease-in-out;
}

@keyframes pinkGlow {
0%, 100% {
box-shadow: 0 0 20px rgba(255, 20, 147, 0.7);
}
50% {
box-shadow: 0 0 30px rgba(255, 20, 147, 1), 0 0 40px rgba(255, 105, 180, 0.8);
}
}

.platform-icon {
width: 35px;
height: 35px;
margin-bottom: 8px;
border-radius: 6px;
object-fit: cover;
transition: all 0.3s ease;
opacity: 1;
}

.platform-option.selected .platform-icon {
opacity: 1;
filter: brightness(1.2) contrast(1.1);
}

.platform-name {
font-size: 11px;
font-weight: 600;
text-align: center;
}

.upload-area {
border: 3px dashed #ddd;
border-radius: 15px;
padding: 30px;
text-align: center;
cursor: pointer;
transition: all 0.3s ease;
background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
}

.upload-area:hover {
border-color: #1e3c72;
background: linear-gradient(135deg, #e3f2fd 0%, #f8f9fa 100%);
}

.upload-area.dragover {
border-color: #1e3c72;
background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
transform: scale(1.02);
}

.upload-icon {
font-size: 36px;
margin-bottom: 10px;
display: block;
}

.file-info {
display: none;
text-align: center;
padding: 20px;
background: #f8f9fa;
border-radius: 10px;
border: 2px solid #28a745;
}

.file-name {
font-weight: 600;
margin-bottom: 5px;
}

.remove-file {
background: #dc3545;
color: white;
border: none;
padding: 8px 16px;
border-radius: 5px;
cursor: pointer;
margin-top: 10px;
}

.tier-selection {
background: rgba(255, 255, 255, 0.95);
backdrop-filter: blur(10px);
border-radius: 20px;
padding: 25px;
margin-bottom: 20px;
box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
}

.tier-plans {
display: grid;
grid-template-columns: repeat(3, 1fr);
gap: 15px;
margin-top: 15px;
}

.tier-plan {
background: white;
border: 2px solid #e0e0e0;
border-radius: 15px;
padding: 20px;
text-align: center;
cursor: pointer;
transition: all 0.3s ease;
position: relative;
}

.tier-plan:hover {
transform: translateY(-3px);
box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
}

.tier-plan.active {
border-color: #1e3c72;
background: linear-gradient(135deg, #1e3c72 0%, #667eea 100%);
color: white;
}

.tier-plan.recommended {
border-color: #ff6b6b;
}

.tier-plan.recommended::before {
content: "RECOMMENDED";
position: absolute;
top: -10px;
left: 50%;
transform: translateX(-50%);
background: #ff6b6b;
color: white;
padding: 4px 12px;
border-radius: 12px;
font-size: 10px;
font-weight: bold;
}

.tier-name {
font-size: 16px;
font-weight: bold;
margin-bottom: 8px;
}

.tier-price {
font-size: 18px;
font-weight: bold;
color: #1e3c72;
margin-bottom: 8px;
}

.tier-plan.active .tier-price {
color: white;
}

.tier-scans {
font-size: 12px;
opacity: 0.8;
margin-bottom: 10px;
}

.tier-features {
font-size: 11px;
opacity: 0.9;
line-height: 1.4;
}

.selection-alert {
background: linear-gradient(135deg, #ff6b6b, #ff8e8e);
color: white;
padding: 15px 25px;
border-radius: 10px;
margin-bottom: 20px;
text-align: center;
font-weight: 600;
box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
}

.selection-alert.hidden {
display: none;
}

.scan-section {
text-align: center;
margin-top: 30px;
position: relative;
z-index: 10;
}

.scan-btn {
background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
color: white;
border: none;
padding: 15px 40px;
border-radius: 25px;
font-size: 18px;
font-weight: 600;
cursor: pointer;
transition: all 0.3s ease;
display: inline-flex;
align-items: center;
gap: 10px;
min-width: 200px;
justify-content: center;
position: relative;
}

.scan-btn:disabled {
background: #ccc;
cursor: not-allowed;
}

.scan-btn.ready {
background: linear-gradient(135deg, #1e3c72 0%, #667eea 100%);
box-shadow: 0 8px 25px rgba(30, 60, 114, 0.3);
}

.scan-btn.ready:hover {
transform: translateY(-2px);
box-shadow: 0 12px 35px rgba(30, 60, 114, 0.4);
}

.btn-loader {
display: none;
width: 20px;
height: 20px;
border: 2px solid transparent;
border-top: 2px solid white;
border-radius: 50%;
animation: spin 1s linear infinite;
}

.btn-loader.active {
display: block;
}

@keyframes spin {
0% { transform: rotate(0deg); }
100% { transform: rotate(360deg); }
}

.scan-history {
background: rgba(255, 255, 255, 0.95);
backdrop-filter: blur(10px);
border-radius: 20px;
padding: 25px;
margin-top: 50px;
margin-bottom: 30px;
box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
display: none;
}

.scan-history.visible {
display: block;
}

.history-header {
display: flex;
justify-content: space-between;
align-items: center;
cursor: pointer;
padding: 15px 0;
border-bottom: 2px solid #e0e0e0;
margin-bottom: 20px;
transition: all 0.3s ease;
}

.history-header:hover {
background: rgba(30, 60, 114, 0.05);
margin: 0 -25px 20px -25px;
padding: 15px 25px;
border-radius: 10px;
}

.history-toggle {
font-size: 18px;
transition: transform 0.3s ease;
color: #1e3c72;
}

.history-toggle.expanded {
transform: rotate(180deg);
}

.history-content {
max-height: 0;
overflow: hidden;
transition: max-height 0.3s ease;
}

.history-content.expanded {
max-height: 500px;
}

.history-tabs {
display: flex;
gap: 10px;
margin-bottom: 20px;
border-bottom: 2px solid #e0e0e0;
}

.history-tab {
padding: 10px 20px;
background: none;
border: none;
cursor: pointer;
font-weight: 600;
color: #666;
transition: all 0.3s ease;
border-bottom: 3px solid transparent;
}

.history-tab.active {
color: #1e3c72;
border-bottom-color: #1e3c72;
}

.history-list {
max-height: 300px;
overflow-y: auto;
}

.history-item {
display: flex;
justify-content: space-between;
align-items: center;
padding: 15px;
background: #f8f9fa;
border-radius: 10px;
margin-bottom: 10px;
cursor: pointer;
transition: all 0.3s ease;
}

.history-item:hover {
background: #e3f2fd;
transform: translateX(5px);
}

.history-date {
font-size: 12px;
color: #666;
}

.results-section {
display: none;
margin-top: 40px;
margin-bottom: 40px;
}

.score-display {
display: flex;
align-items: center;
justify-content: center;
gap: 40px;
margin-bottom: 40px;
padding: 20px;
}

.score-circle {
width: 120px;
height: 120px;
border-radius: 50%;
display: flex;
align-items: center;
justify-content: center;
position: relative;
box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
}

.score-circle::before {
content: '';
width: 80px;
height: 80px;
background: white;
border-radius: 50%;
position: absolute;
}

.score-value {
font-size: 24px;
font-weight: bold;
z-index: 1;
color: #333;
}

.status-indicator {
display: flex;
align-items: center;
gap: 10px;
font-size: 18px;
font-weight: 600;
}

.status-icon {
font-size: 24px;
}

.results-grid {
display: grid;
grid-template-columns: 1fr 1fr;
gap: 20px;
}

.issues-card, .recommendations-card {
background: white;
padding: 20px;
border-radius: 15px;
box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
}

.issue-item, .recommendation-item {
display: flex;
align-items: flex-start;
gap: 12px;
padding: 15px;
margin-bottom: 12px;
background: #f8f9fa;
border-radius: 8px;
cursor: pointer;
transition: all 0.3s ease;
line-height: 1.4;
min-height: 60px;
}

.issue-item:hover, .recommendation-item:hover {
background: #e3f2fd;
transform: translateX(5px);
}

.payment-modal {
display: none;
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: rgba(0, 0, 0, 0.8);
z-index: 2000;
padding: 20px;
overflow-y: auto;
}

/* FIX 1: Payment modal responsiveness */
.payment-content {
background: white;
border-radius: 20px;
padding: 40px;
max-width: 500px;
margin: 20px auto;
position: relative;
text-align: center;
box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
max-height: 90vh;
overflow-y: auto;
}

.payment-header {
margin-bottom: 30px;
}

.payment-header h2 {
color: #1e3c72;
margin-bottom: 10px;
font-size: 28px;
}

.payment-header .tier-highlight {
background: linear-gradient(135deg, #1e3c72 0%, #667eea 100%);
color: white;
padding: 8px 20px;
border-radius: 25px;
display: inline-block;
font-weight: bold;
margin-bottom: 20px;
}

.payment-features {
text-align: left;
margin: 30px 0;
background: #f8f9fa;
padding: 25px;
border-radius: 15px;
}

.payment-features h4 {
color: #1e3c72;
margin-bottom: 15px;
text-align: center;
}

.payment-features ul {
list-style: none;
padding: 0;
}

.payment-features li {
padding: 8px 0;
display: flex;
align-items: center;
gap: 10px;
}

.payment-features li::before {
content: "✅";
font-size: 16px;
}

.payment-price {
font-size: 36px;
font-weight: bold;
color: #1e3c72;
margin: 20px 0;
}

.payment-buttons {
display: flex;
gap: 15px;
margin-top: 30px;
}

.payment-btn {
flex: 1;
padding: 15px 25px;
border: none;
border-radius: 10px;
font-size: 16px;
font-weight: 600;
cursor: pointer;
transition: all 0.3s ease;
}

.payment-btn.primary {
background: linear-gradient(135deg, #1e3c72 0%, #667eea 100%);
color: white;
}

.payment-btn.primary:hover {
transform: translateY(-2px);
box-shadow: 0 8px 25px rgba(30, 60, 114, 0.4);
}

.payment-btn.secondary {
background: #f8f9fa;
color: #666;
border: 2px solid #e0e0e0;
}

.payment-btn.secondary:hover {
background: #e9ecef;
}

.close-payment {
position: absolute;
top: 15px;
right: 20px;
background: none;
border: none;
font-size: 28px;
cursor: pointer;
color: #999;
transition: color 0.3s ease;
}

.close-payment:hover {
color: #333;
}

.payment-security {
margin-top: 25px;
padding-top: 20px;
border-top: 1px solid #e0e0e0;
font-size: 12px;
color: #666;
}

.payment-security::before {
content: "🔒";
margin-right: 5px;
}

.insight-content {
background: white;
border-radius: 20px;
padding: 30px;
max-width: 500px;
margin: 50px auto;
position: relative;
}

.insight-content h3 {
margin-bottom: 20px;
color: #1e3c72;
}

.stats-grid {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
gap: 15px;
margin-bottom: 20px;
}

.stat-card {
background: rgba(255, 255, 255, 0.95);
backdrop-filter: blur(10px);
padding: 15px;
border-radius: 15px;
text-align: center;
box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
}

.stat-number {
font-size: 20px;
font-weight: bold;
color: #1e3c72;
margin-bottom: 5px;
}

.stat-label {
color: #666;
font-size: 12px;
}

.footer {
text-align: center;
padding: 20px 0;
color: rgba(255, 255, 255, 0.8);
font-size: 14px;
margin-top: 40px;
}

.platform-tag, .region-tag, .score-tag {
background: #e3f2fd;
color: #1976d2;
padding: 2px 8px;
border-radius: 12px;
font-size: 11px;
font-weight: 600;
}

/* Country Selection Modal CSS */
.country-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    z-index: 3000;
    padding: 20px;
    overflow-y: auto;
}

/* FIX 2: Country modal responsiveness */
.country-modal-content {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(15px);
    border-radius: 20px;
    padding: 30px;
    max-width: 600px;
    max-height: 85vh;
    margin: 20px auto;
    position: relative;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    overflow: hidden;
    display: flex;
    flex-direction: column;
}

.country-modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 25px;
    padding-bottom: 15px;
    border-bottom: 2px solid #e0e0e0;
}

.country-modal-title {
    font-size: 24px;
    font-weight: bold;
    color: #1e3c72;
    margin: 0;
}

.close-country-modal {
    background: none;
    border: none;
    font-size: 28px;
    cursor: pointer;
    color: #999;
    transition: color 0.3s ease;
    padding: 0;
    width: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.close-country-modal:hover {
    color: #333;
}

.country-search {
    width: 100%;
    padding: 12px 20px;
    border: 2px solid #e0e0e0;
    border-radius: 25px;
    font-size: 16px;
    margin-bottom: 20px;
    background: white;
    transition: border-color 0.3s ease;
}

.country-search:focus {
    outline: none;
    border-color: #1e3c72;
}

.country-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
    max-height: 400px;
    overflow-y: auto;
    padding-right: 10px;
    flex: 1;
    min-height: 0;
}

.country-option {
    background: white;
    border: 2px solid #e0e0e0;
    border-radius: 12px;
    padding: 15px 20px;
    cursor: pointer;
    transition: all 0.3s ease;
    text-align: left;
    font-weight: 500;
    color: #333;
}

.country-option:hover {
    background: #f8f9fa;
    border-color: #1e3c72;
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(30, 60, 114, 0.2);
}

.country-option.hidden {
    display: none;
}

/* RTL Support for Country Modal */
[dir="rtl"] .country-modal-header {
    flex-direction: row-reverse;
}

[dir="rtl"] .country-option {
    text-align: right;
}

/* Custom scrollbar for country grid */
.country-grid::-webkit-scrollbar {
    width: 6px;
}

.country-grid::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 10px;
}

.country-grid::-webkit-scrollbar-thumb {
    background: #1e3c72;
    border-radius: 10px;
}

.country-grid::-webkit-scrollbar-thumb:hover {
    background: #667eea;
}

@media (max-width: 1024px) {
.dashboard-grid {
grid-template-columns: 1fr 1fr;
}
}

@media (max-width: 768px) {
.dashboard-grid {
grid-template-columns: 1fr;
}
.platforms-grid {
grid-template-columns: repeat(2, 1fr);
}
.region-grid {
grid-template-columns: 1fr;
}
.tier-plans {
grid-template-columns: 1fr;
}
.score-display {
flex-direction: column;
gap: 20px;
}

.payment-content {
    margin: 10px;
    padding: 30px 20px;
    max-height: calc(100vh - 20px);
}

.country-modal-content {
    margin: 10px;
    max-height: calc(100vh - 20px);
    padding: 20px;
}

.country-grid {
    grid-template-columns: 1fr;
    max-height: calc(100vh - 200px);
}

.country-modal-title {
    font-size: 20px;
}
}
</style>
</head>
<body>
<div class="container">
<div class="header">
<div class="logo-section">
<img src="images/logo.png" alt="CheckReel Logo" class="logo-img">
<span class="logo-text">CheckReel</span>
</div>
<div class="user-section">
<div class="language-selector">
<button class="lang-btn active" onclick="setLanguage('en')">EN</button>
<button class="lang-btn" onclick="setLanguage('ar')">AR</button>
<button class="lang-btn" onclick="setLanguage('fr')">FR</button>
</div>
<span id="scansLeft">3 scans left</span>
<span id="tierBadge" class="tier-badge tier-free">Free Trial</span>
<span id="adminBadge" class="admin-badge" style="display: none;">ADMIN</span>
</div>
</div>

<div class="tier-selection">
<h2 id="choose-plan">Choose Your Plan</h2>
<div class="tier-plans">
<div class="tier-plan active" data-tier="free" onclick="selectTier('free')">
<div class="tier-name" id="free-trial">Free Trial</div>
<div class="tier-price">$0</div>
<div class="tier-scans" id="free-scans">3 scans</div>
<div class="tier-features" id="free-features">Basic compliance check<br>Standard results</div>
</div>
<div class="tier-plan recommended" data-tier="plus" onclick="showPaymentModal('plus')">
<div class="tier-name" id="plus-tier">Plus</div>
<div class="tier-price">$4.99/<span id="per-month">mo</span></div>
<div class="tier-scans" id="plus-scans">20 scans/month</div>
<div class="tier-features" id="plus-features">Enhanced compliance check<br>Detailed insights<br>Scan history<br>Priority support</div>
</div>
<div class="tier-plan" data-tier="premium" onclick="showPaymentModal('premium')">
<div class="tier-name" id="premium-tier">Premium</div>
<div class="tier-price">$9.99/<span id="per-month-premium">mo</span></div>
<div class="tier-scans" id="premium-scans">40 scans/month</div>
<div class="tier-features" id="premium-features">Full compliance suite<br>Advanced analytics<br>Team features<br>White-label reports<br>API access<br>Dedicated support</div>
</div>
</div>
</div>

<div class="dashboard-grid">
<div class="card">
<h2 id="select-region">🌍 Select Region</h2>
<div class="region-grid">
<div class="region-option" data-region="middle-east" onclick="selectRegion('middle-east')">
<img src="images/region-icons/middle-east.png" alt="Middle East" class="region-icon">
<span class="region-name" id="middle-east">Middle East</span>
</div>
<div class="region-option" data-region="global" onclick="selectRegion('global')">
<img src="images/region-icons/global.png" alt="Global" class="region-icon">
<span class="region-name" id="global">Global</span>
</div>
<div class="region-option" data-region="europe" onclick="selectRegion('europe')">
<img src="images/region-icons/europe.png" alt="Europe" class="region-icon">
<span class="region-name" id="europe">Europe</span>
</div>
<div class="region-option" data-region="mena" onclick="selectRegion('mena')">
<img src="images/region-icons/mena.png" alt="MENA" class="region-icon">
<span class="region-name" id="mena">MENA</span>
</div>
</div>
</div>

<div class="card">
<h2 id="select-platform">📱 Select Target Platform <span id="platformCounter"></span></h2>
<div class="platforms-grid">
<div class="platform-option" data-platform="tiktok" onclick="selectPlatform('tiktok')">
<img src="images/tiktok.png" alt="TikTok" class="platform-icon">
<span class="platform-name">TikTok</span>
</div>
<div class="platform-option" data-platform="youtube" onclick="selectPlatform('youtube')">
<img src="images/youtube.png" alt="YouTube" class="platform-icon">
<span class="platform-name">YouTube</span>
</div>
<div class="platform-option" data-platform="instagram" onclick="selectPlatform('instagram')">
<img src="images/instagram.png" alt="Instagram" class="platform-icon">
<span class="platform-name">Instagram</span>
</div>
<div class="platform-option" data-platform="facebook" onclick="selectPlatform('facebook')">
<img src="images/facebook.png" alt="Facebook" class="platform-icon">
<span class="platform-name">Facebook</span>
</div>
<div class="platform-option" data-platform="twitter" onclick="selectPlatform('twitter')">
<img src="images/twitter.png" alt="Twitter" class="platform-icon">
<span class="platform-name">Twitter</span>
</div>
<div class="platform-option" data-platform="snapchat" onclick="selectPlatform('snapchat')">
<img src="images/snapchat.png" alt="Snapchat" class="platform-icon">
<span class="platform-name">Snapchat</span>
</div>
</div>
</div>

<div class="card">
<h2 id="upload-content">📁 Upload Content to Check</h2>
<div id="selectionAlert" class="selection-alert">
<span id="selection-alert">Please select a region and platform before uploading content for analysis</span>
</div>
<div class="upload-area" id="uploadArea">
<div class="upload-icon">📁</div>
<p id="drop-here">Drop your content here</p>
<p id="click-browse">or click to browse files</p>
<small>Supports: MP4, MOV, AVI, MP3, WAV, JPG, PNG (Max: 100MB)</small>
</div>
<div class="file-info" id="fileInfo">
<div class="file-name" id="fileName"></div>
<div class="file-size" id="fileSize"></div>
<button class="remove-file" id="removeFile">Remove File</button>
</div>
<input type="file" id="fileInput" accept="video/*,audio/*,image/*" style="display: none;">
</div>
</div>

<div class="scan-section">
<button class="scan-btn" id="scanBtn" disabled>
<div class="btn-loader" id="btnLoader"></div>
<span id="start-check">Start Content Check</span>
</button>
</div>

<div class="scan-history" id="scanHistory">
<div class="history-header" onclick="toggleHistorySection()">
<h3 id="scan-history-title">Scan History</h3>
<span class="history-toggle" id="historyToggle">▼</span>
</div>

<div class="history-content" id="historyContent">
<div class="history-tabs">
<button class="history-tab active" data-filter="all" id="all-scans">All Scans</button>
<button class="history-tab" data-filter="region" id="by-region">By Region</button>
<button class="history-tab" data-filter="platform" id="by-platform">By Platform</button>
</div>

<div class="history-list" id="historyList">
<div class="history-item">
<div>
<div class="file-name">Sample scan</div>
<div class="history-date">5/31/2025</div>
</div>
<div>
<span class="platform-tag">TikTok</span> | 
<span class="region-tag">Middle East</span> | 
<span class="score-tag">Score: 55</span>
</div>
</div>
</div>
</div>
</div>

<div class="results-section" id="resultsSection">
<div class="score-display" id="scoreDisplay">
<div class="score-circle" id="scoreCircle">
<div class="score-value" id="scoreValue">55</div>
</div>
<div class="status-indicator">
<span class="status-icon" id="statusIcon">❌</span>
<span id="statusText">Major Issues - Do Not Post</span>
</div>
</div>

<div class="results-grid">
<div class="issues-card">
<h3 id="issues-found">Issues Found</h3>
<div id="issuesList"></div>
</div>
<div class="recommendations-card">
<h3 id="recommendations">Recommendations</h3>
<div id="recommendationsList"></div>
</div>
</div>
</div>

<div class="stats-grid">
<div class="stat-card">
<div class="stat-number" id="statUsers">2,845</div>
<div class="stat-label" id="active-users">Active Users</div>
</div>
<div class="stat-card">
<div class="stat-number" id="statScanned">18,492</div>
<div class="stat-label" id="content-scanned">Content Scanned</div>
</div>
<div class="stat-card">
<div class="stat-number" id="statSuccess">94%</div>
<div class="stat-label" id="success-rate">Success Rate</div>
</div>
<div class="stat-card">
<div class="stat-number" id="statPlatforms">6</div>
<div class="stat-label" id="platforms">Platforms</div>
</div>
<div class="stat-card">
<div class="stat-number" id="statScansUsed">0</div>
<div class="stat-label" id="scans-used">Scans Used (Testing)</div>
</div>
</div>

<div id="insightModal" class="insight-modal">
<div class="insight-content">
<button class="close-modal" onclick="closeInsightModal()">&times;</button>
<h3 id="insightTitle">Insight Details</h3>
<div id="insightContent"></div>
</div>
</div>

<!-- Payment Modal -->
<div id="paymentModal" class="payment-modal">
<div class="payment-content">
<button class="close-payment" onclick="closePaymentModal()">&times;</button>
<div class="payment-header">
<h2 id="upgrade-to">Upgrade to</h2>
<div class="tier-highlight" id="selectedTierName">Plus</div>
<p id="unlock-features">Unlock premium features and boost your content success!</p>
</div>
<div class="payment-price" id="paymentPrice">$4.99/month</div>
<div class="payment-features" id="paymentFeatures">
<h4 id="whats-included">What's Included:</h4>
<ul>
<li id="feature-enhanced">Enhanced compliance checking</li>
<li id="feature-insights">Detailed content insights</li>
<li id="feature-history">Complete scan history</li>
<li id="feature-support">Priority customer support</li>
</ul>
</div>
<div class="payment-buttons">
<button class="payment-btn secondary" onclick="closePaymentModal()" id="maybe-later">Maybe Later</button>
<button class="payment-btn primary" onclick="proceedToPayment()" id="subscribe-now">Subscribe Now</button>
</div>
<div class="payment-security" id="secure-payment">
Secure payment powered by Stripe. Cancel anytime.
</div>
</div>
</div>

<!-- Country Selection Modal -->
<div id="countryModal" class="country-modal">
<div class="country-modal-content">
<div class="country-modal-header">
<h3 class="country-modal-title" id="countryModalTitle">Select Country</h3>
<button class="close-country-modal" onclick="closeCountryModal()">&times;</button>
</div>

<input type="text" class="country-search" id="countrySearch" placeholder="Search countries..." onkeyup="filterCountries()">

<div class="country-grid" id="countryGrid">
<!-- Countries will be populated here by JavaScript -->
</div>
</div>
</div>

<div class="footer">
<p>&copy; 2025 CheckReel. All rights reserved. Copyright Protected.</p>
</div>
</div>

<script src="lang-loader.js"></script>

<script>
// CRITICAL FIX: Declare missing variables
let currentLanguage = 'en';
let currentTier = 'free';
let selectedRegion = null;
let selectedPlatforms = [];
let selectedFile = null;
let scanHistory = [];

// Country Modal Variables
let selectedCountry = null;
let currentModalRegion = null;

// Safe storage wrapper
if (!window.safeStorage) {
  window.safeStorage = {
    getItem: (k) => { try { return localStorage.getItem(k); } catch { return null } },
    setItem: (k,v) => { try { localStorage.setItem(k,v) } catch {} },
    removeItem: (k) => { try { localStorage.removeItem(k) } catch {} }
  };
}
// Admin Override System
const ADMIN_PASSWORD = "checkreel2025"; // Change this to your secure password

function checkAdminAccess() {
    const isAdmin = sessionStorage.getItem('checkreel_admin') === 'true';
    return isAdmin;
}

function promptAdminLogin() {
    const password = prompt('Enter admin password to access tier override:');
    if (password === ADMIN_PASSWORD) {
        sessionStorage.setItem('checkreel_admin', 'true');
        alert('Admin access granted! You can now switch tiers freely.');
        
        // Show admin badge
        const adminBadge = document.getElementById('adminBadge');
        if (adminBadge) adminBadge.style.display = 'inline-block';
        
        return true;
    } else if (password !== null) {
        alert('Invalid password!');
    }
    return false;
}

// Add admin login trigger (Ctrl+Shift+A)
document.addEventListener('keydown', function(e) {
    if (e.ctrlKey && e.shiftKey && e.key === 'A') {
        if (!checkAdminAccess()) {
            promptAdminLogin();
        } else {
            alert('Already logged in as admin!');
        }
    }
});
// Payment Configuration - UPDATE THESE URLs WHEN READY
const PAYMENT_CONFIG = {
    // Stripe/PayPal URLs - replace with your actual payment processor URLs
    plus: {
        url: 'https://checkout.stripe.com/pay/cs_test_plus_plan', // Replace with real Stripe URL
        priceId: 'price_plus_monthly', // Your Stripe price ID
        amount: '$4.99/month'
    },
    premium: {
        url: 'https://checkout.stripe.com/pay/cs_test_premium_plan', // Replace with real Stripe URL  
        priceId: 'price_premium_monthly', // Your Stripe price ID
        amount: '$9.99/month'
    },
    // Success/cancel URLs
    successUrl: window.location.origin + '/dashboard.html?payment=success',
    cancelUrl: window.location.origin + '/dashboard.html?payment=cancelled'
};

// Payment Modal Functions
let selectedPaymentTier = null;

function showPaymentModal(tier) {
    selectedPaymentTier = tier;
    const modal = document.getElementById('paymentModal');
    const tierName = document.getElementById('selectedTierName');
    const price = document.getElementById('paymentPrice');
    const features = document.getElementById('paymentFeatures');
    
    // Update modal content based on tier
    if (tier === 'plus') {
        tierName.textContent = getTranslation('plus-tier');
        price.textContent = PAYMENT_CONFIG.plus.amount;
        features.innerHTML = `
            <h4>${getTranslation('whats-included')}:</h4>
            <ul>
                <li>${getTranslation('feature-enhanced')}</li>
                <li>${getTranslation('feature-insights')}</li>
                <li>${getTranslation('feature-history')}</li>
                <li>${getTranslation('feature-support')}</li>
            </ul>
        `;
    } else if (tier === 'premium') {
        tierName.textContent = getTranslation('premium-tier');
        price.textContent = PAYMENT_CONFIG.premium.amount;
        features.innerHTML = `
            <h4>${getTranslation('whats-included')}:</h4>
            <ul>
                <li>${getTranslation('feature-compliance')}</li>
                <li>${getTranslation('feature-analytics')}</li>
                <li>${getTranslation('feature-team')}</li>
                <li>${getTranslation('feature-reports')}</li>
                <li>${getTranslation('feature-api')}</li>
                <li>${getTranslation('feature-dedicated')}</li>
            </ul>
        `;
    }
    
    modal.style.display = 'block';
}

function closePaymentModal() {
    document.getElementById('paymentModal').style.display = 'none';
    selectedPaymentTier = null;
}

function proceedToPayment() {
    if (!selectedPaymentTier) return;
    
    // Get payment URL for selected tier
    const paymentUrl = PAYMENT_CONFIG[selectedPaymentTier].url;
    
    // Add success/cancel URLs and user info
    const fullPaymentUrl = `${paymentUrl}?success_url=${encodeURIComponent(PAYMENT_CONFIG.successUrl)}&cancel_url=${encodeURIComponent(PAYMENT_CONFIG.cancelUrl)}&client_reference_id=${Date.now()}`;
    
    // Close modal and redirect to payment
    closePaymentModal();
    
    // Open payment in same window (Stripe/PayPal best practice)
    window.location.href = fullPaymentUrl;
}

// Check for payment status on page load
function checkPaymentStatus() {
    const urlParams = new URLSearchParams(window.location.search);
    const paymentStatus = urlParams.get('payment');
    
    if (paymentStatus === 'success') {
        // Payment successful - activate paid tier
        handlePaymentSuccess();
    } else if (paymentStatus === 'cancelled') {
        // Payment cancelled - show message
        handlePaymentCancelled();
    }
}

function handlePaymentSuccess() {
    const urlParams = new URLSearchParams(window.location.search);
    // Show success message
    alert('Payment successful! Your subscription is now active.');
    
    // Activate the paid tier (you'll need to verify this server-side in production)
    const tier = urlParams.get('tier') || 'plus'; // Get tier from URL or default to plus
    selectTier(tier);
    
    // Clean URL
    window.history.replaceState({}, document.title, window.location.pathname);
    
    // Update UI to show paid features
    updateUserCounter();
    updateScansCounter();
    loadScanHistory();
    
    // Show selection alert initially since nothing is selected
    updateSelectionAlert();
}

function handlePaymentCancelled() {
    // Show cancelled message
    alert('Payment was cancelled. You can try again anytime.');
    
    // Clean URL
    window.history.replaceState({}, document.title, window.location.pathname);
}

// Enhanced tier selection with payment verification
function selectTier(tier) {
    // Check if admin or selecting free tier
    if (tier === 'free' || checkAdminAccess()) {
        currentTier = tier;
        safeStorage.setItem('checkreel_tier', tier);
        updateTierUI(tier);
        updateTierDisplay();
        updateScansCounter();
        updatePlatformCounter();
        
        const historySection = document.getElementById('scanHistory');
        if (tier === 'plus' || tier === 'premium') {
            historySection.classList.add('visible');
        } else {
            historySection.classList.remove('visible');
        }
        
        if (tier !== 'free') {
            safeStorage.setItem('checkreel_scans_used', '0');
        }
    } else {
        // Not admin - show payment modal
        showPaymentModal(tier);
    }
}

function updateTierUI(tier) {
    document.querySelectorAll('.tier-plan').forEach(plan => {
        plan.classList.remove('active');
    });
    document.querySelector(`[data-tier="${tier}"]`).classList.add('active');
}

// Check subscription status (integrate with your backend)
function checkSubscriptionStatus(tier) {
    // TESTING OVERRIDE - set to true to test tier functionality
    const TESTING_MODE = true;
    if (TESTING_MODE && (tier === 'plus' || tier === 'premium')) {
        return true;
    }
    // In production, verify with your backend/Stripe
    // For now, check if user has stored subscription
    const storedSubscription = safeStorage.getItem('checkreel_subscription');
    const subscriptionData = storedSubscription ? JSON.parse(storedSubscription) : null;
    
    if (subscriptionData && subscriptionData.tier === tier && subscriptionData.active) {
        return true;
    }
    
    return false;
}

// Block premium features for non-subscribers
function checkFeatureAccess(feature) {
    const userTier = safeStorage.getItem('checkreel_tier') || 'free';
    
    const featureAccess = {
        'scan-history': ['plus', 'premium'],
        'multi-platform': ['premium'],
        'detailed-insights': ['plus', 'premium'],
        'api-access': ['premium']
    };
    
    if (featureAccess[feature] && !featureAccess[feature].includes(userTier)) {
        // Show upgrade prompt
        showUpgradePrompt(feature);
        return false;
    }
    
    return true;
}

function showUpgradePrompt(feature) {
    const featureNames = {
        'scan-history': 'Scan History',
        'multi-platform': 'Multi-Platform Selection', 
        'detailed-insights': 'Detailed Insights',
        'api-access': 'API Access'
    };
    
    const message = `${featureNames[feature]} is available in our paid plans. Would you like to upgrade?`;
    
    if (confirm(message)) {
        showPaymentModal('plus');
    }
}

// COUNTRY MODAL FUNCTIONS
// FIX 4: Modified region selection function
function selectRegion(region) {
    // Clear all previous region selections first
    document.querySelectorAll('.region-option').forEach(opt => {
        opt.classList.remove('selected');
        // Reset region name text to original
        const regionName = opt.querySelector('.region-name');
        if (regionName) {
            const regionKey = opt.getAttribute('data-region');
            regionName.textContent = getTranslation(regionKey);
        }
    });
    
    // Show country modal instead of directly selecting region
    currentModalRegion = region;
    showCountryModal(region);
}

// Show country modal
function showCountryModal(region) {
    const modal = document.getElementById('countryModal');
    const title = document.getElementById('countryModalTitle');
    const grid = document.getElementById('countryGrid');
    const searchInput = document.getElementById('countrySearch');
    
    // Update modal title
    const regionName = getTranslation(region);
    title.textContent = `Select Country - ${regionName}`;
    
    // Clear search
    if (searchInput) searchInput.value = '';
    
    // Populate countries
    populateCountries(region);
    
    // Show modal
    modal.style.display = 'block';
}

// Close country modal
function closeCountryModal() {
    const modal = document.getElementById('countryModal');
    modal.style.display = 'none';
    currentModalRegion = null;
    selectedCountry = null;
}

// Populate countries based on region
function populateCountries(region) {
    const grid = document.getElementById('countryGrid');
    if (!grid) return;
    
    grid.innerHTML = '';
    
    // Get countries for the region
    const countries = DASHBOARD_TRANSLATIONS[currentLanguage]?.countries?.[region];
    if (!countries) return;
    
    // Create country options
    Object.keys(countries).forEach(countryKey => {
        const countryDiv = document.createElement('div');
        countryDiv.className = 'country-option';
        countryDiv.setAttribute('data-country', countryKey);
        countryDiv.setAttribute('data-country-name', countries[countryKey].toLowerCase());
        countryDiv.textContent = countries[countryKey];
        countryDiv.onclick = () => selectCountry(countryKey, countries[countryKey]);
        grid.appendChild(countryDiv);
    });
}

// FIX 4: Select country and ensure single selection
function selectCountry(countryKey, countryName) {
    selectedCountry = countryKey;
    selectedRegion = currentModalRegion;
    
    // Clear all region selections first
    document.querySelectorAll('.region-option').forEach(opt => {
        opt.classList.remove('selected');
        const regionName = opt.querySelector('.region-name');
        if (regionName) {
            const regionKey = opt.getAttribute('data-region');
            regionName.textContent = getTranslation(regionKey);
        }
    });
    
    // Update UI to show region + country selection
    updateRegionSelection(currentModalRegion, countryName);
    
    // Close modal
    closeCountryModal();
    
    // Update other UI elements
    updateScanButton();
    updateSelectionAlert();
}

// Update region selection UI to show country
function updateRegionSelection(region, countryName) {
    // Clear all region selections
    document.querySelectorAll('.region-option').forEach(opt => opt.classList.remove('selected'));
    
    // Select the chosen region
    const regionElement = document.querySelector(`[data-region="${region}"]`);
    if (regionElement) {
        regionElement.classList.add('selected');
        
        // Update region name to include country
        const regionNameEl = regionElement.querySelector('.region-name');
        if (regionNameEl) {
            const regionTranslation = getTranslation(region);
            regionNameEl.textContent = `${regionTranslation} - ${countryName}`;
        }
    }
}

// Filter countries based on search
function filterCountries() {
    const searchInput = document.getElementById('countrySearch');
    const countryOptions = document.querySelectorAll('.country-option');
    
    if (!searchInput) return;
    
    const searchTerm = searchInput.value.toLowerCase();
    
    countryOptions.forEach(option => {
        const countryName = option.getAttribute('data-country-name');
        if (countryName && countryName.includes(searchTerm)) {
            option.classList.remove('hidden');
        } else {
            option.classList.add('hidden');
        }
    });
}

// Close modal when clicking outside
document.addEventListener('click', function(event) {
    const modal = document.getElementById('countryModal');
    const modalContent = document.querySelector('.country-modal-content');
    
    if (modal && event.target === modal && !modalContent.contains(event.target)) {
        closeCountryModal();
    }
});

// Close modal with Escape key
document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        closeCountryModal();
    }
});

// Platform selection
function selectPlatform(platform) {
    const userTier = safeStorage.getItem('checkreel_tier') || 'free';
    const platformElement = document.querySelector(`[data-platform="${platform}"]`);
    
    if (userTier === 'premium') {
        if (selectedPlatforms.includes(platform)) {
            selectedPlatforms = selectedPlatforms.filter(p => p !== platform);
            platformElement.classList.remove('selected');
        } else {
            if (selectedPlatforms.length < 3) {
                selectedPlatforms.push(platform);
                platformElement.classList.add('selected');
            } else {
                alert('Premium users can select up to 3 platforms per scan');
            }
        }
    } else {
        selectedPlatforms = [platform];
        document.querySelectorAll('.platform-option').forEach(opt => opt.classList.remove('selected'));
        platformElement.classList.add('selected');
    }
    
    updatePlatformCounter();
    updateScanButton();
    updateSelectionAlert();
}

// Update platform counter
function updatePlatformCounter() {
    const counterEl = document.getElementById("platformCounter");
    const userTier = safeStorage.getItem('checkreel_tier') || 'free';
    
    if (userTier === "premium" && counterEl) {
        counterEl.textContent = `(${selectedPlatforms.length}/3 selected)`;
    } else if (counterEl) {
        counterEl.textContent = '';
    }
}

// Update selection alert
function updateSelectionAlert() {
    const alert = document.getElementById('selectionAlert');
    if (selectedRegion && selectedPlatforms.length > 0) {
        alert.classList.add('hidden');
    } else {
        alert.classList.remove('hidden');
    }
}

// File upload functionality
function initializeUpload() {
    const uploadArea = document.getElementById('uploadArea');
    const fileInput = document.getElementById('fileInput');
    const fileInfo = document.getElementById('fileInfo');
    const removeFileBtn = document.getElementById('removeFile');
    
    if (!uploadArea || !fileInput) return;
    
    uploadArea.addEventListener('click', () => {
        if (!selectedRegion || selectedPlatforms.length === 0) {
            alert(getTranslation('selection-alert'));
            return;
        }
        fileInput.click();
    });
    
    fileInput.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (file && selectedRegion && selectedPlatforms.length > 0) {
            handleFileSelect(file);
        }
    });
    
    uploadArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        if (selectedRegion && selectedPlatforms.length > 0) {
            uploadArea.classList.add('dragover');
        }
    });
    
    uploadArea.addEventListener('dragleave', (e) => {
        e.preventDefault();
        uploadArea.classList.remove('dragover');
    });
    
    uploadArea.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadArea.classList.remove('dragover');
        if (!selectedRegion || selectedPlatforms.length === 0) {
            alert(getTranslation('selection-alert'));
            return;
        }
        const file = e.dataTransfer.files[0];
        if (file) {
            handleFileSelect(file);
        }
    });
    
    if (removeFileBtn) {
        removeFileBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            clearSelectedFile();
        });
    }
}

function handleFileSelect(file) {
    const allowedTypes = ['video/mp4', 'video/quicktime', 'image/jpeg', 'image/png', 'audio/mp3', 'audio/wav'];
    if (!allowedTypes.includes(file.type)) {
        alert('Unsupported file type. Please select MP4, MOV, JPG, PNG, MP3, or WAV files.');
        return;
    }
    
    const maxSize = 100 * 1024 * 1024;
    if (file.size > maxSize) {
        alert('File size too large. Please select a file smaller than 100MB.');
        return;
    }
    
    selectedFile = file;
    displayFileInfo(file);
    updateScanButton();
}

function displayFileInfo(file) {
    const uploadArea = document.getElementById('uploadArea');
    const fileInfo = document.getElementById('fileInfo');
    const fileName = document.getElementById('fileName');
    const fileSize = document.getElementById('fileSize');
    
    if (fileName) fileName.textContent = file.name;
    if (fileSize) fileSize.textContent = formatFileSize(file.size);
    if (uploadArea) uploadArea.style.display = 'none';
    if (fileInfo) fileInfo.style.display = 'block';
}

function clearSelectedFile() {
    const uploadArea = document.getElementById('uploadArea');
    const fileInfo = document.getElementById('fileInfo');
    const fileInput = document.getElementById('fileInput');
    
    selectedFile = null;
    if (fileInput) fileInput.value = '';
    if (uploadArea) uploadArea.style.display = 'block';
    if (fileInfo) fileInfo.style.display = 'none';
    updateScanButton();
}

function formatFileSize(bytes) {
    if (bytes === 0) return '0 Bytes';
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}

function updateScanButton() {
    const scanBtn = document.getElementById('scanBtn');
    if (!scanBtn) return;
    
    const canScan = selectedFile && selectedPlatforms.length > 0 && selectedRegion;
    scanBtn.disabled = !canScan;
    
    if (canScan) {
        scanBtn.classList.add('ready');
    } else {
        scanBtn.classList.remove('ready');
    }
}

// Scan functionality
const scanBtn = document.getElementById('scanBtn');
if (scanBtn) {
    scanBtn.addEventListener('click', async function() {
        if (!selectedFile || selectedPlatforms.length === 0 || !selectedRegion) return;
        
        if (!checkScanLimit()) {
            alert('You have reached your scan limit! Please upgrade your plan.');
            return;
        }
        
        await performScan();
    });
}

function checkScanLimit() {
    const userTier = safeStorage.getItem('checkreel_tier') || 'free';
    const scansUsed = parseInt(safeStorage.getItem('checkreel_scans_used') || '0');
    const limits = {
        free: 3,
        plus: 20,
        premium: 40
    };
    return scansUsed < limits[userTier];
}

async function performScan() {
    const scanBtn = document.getElementById('scanBtn');
    const btnText = document.getElementById('start-check');
    const btnLoader = document.getElementById('btnLoader');
    const resultsSection = document.getElementById('resultsSection');
    
    if (!scanBtn) return;
    
    scanBtn.disabled = true;
    if (btnText) btnText.textContent = getTranslation('analyzing');
    if (btnLoader) btnLoader.classList.add('active');
    
    try {
        await new Promise(resolve => setTimeout(resolve, 3000));
        
        const results = generateDynamicResults();
        displayResults(results);
        saveScanToHistory(results);
        incrementScanCount();
        updateTierDisplay();
        updateScansCounter();
        
        if (resultsSection) {
            resultsSection.style.display = 'block';
            resultsSection.scrollIntoView({ behavior: 'smooth' });
        }
        
    } catch (error) {
        console.error('Scan error:', error);
        alert('An error occurred during scanning. Please try again.');
    } finally {
        scanBtn.disabled = false;
        if (btnText) btnText.textContent = getTranslation('start-check');
        if (btnLoader) btnLoader.classList.remove('active');
    }
}

function generateDynamicResults() {
    const userTier = safeStorage.getItem('checkreel_tier') || 'free';
    const scenarios = [
        { score: 95, issueCount: 0 },
        { score: 85, issueCount: 2 },
        { score: 70, issueCount: 4 },
        { score: 55, issueCount: 6 },
        { score: 40, issueCount: 8 }
    ];
    
    const scenario = scenarios[Math.floor(Math.random() * scenarios.length)];
    let issues, recommendations, status, statusIcon;
    
    // Generate multilingual status messages
    if (scenario.score >= 90) {
        status = getTranslation('noIssues');
        statusIcon = '✅';
    } else if (scenario.score >= 70) {
        status = getTranslation('minorIssues');
        statusIcon = '⚠️';
    } else {
        status = getTranslation('majorIssues');
        statusIcon = '❌';
    }
    
    // Generate multilingual issues and recommendations with platform/region context
    const platformText = selectedPlatforms.map(p => getTranslation(p)).join(', ');
    const regionText = getTranslation(selectedRegion);
    
    if (userTier === 'free') {
        issues = scenario.issueCount > 0 ? [
            { 
                icon: '⚠️', 
                text: `${scenario.issueCount} compliance issues detected for ${platformText}`
            }
        ] : [];
        recommendations = [
            { 
                icon: '💡', 
                text: 'Upgrade to Plus or Premium for detailed analysis'
            }
        ];
    } else if (userTier === 'plus') {
        issues = scenario.issueCount > 0 ? [
            { 
                icon: '🔊', 
                text: getTranslation('audioLevelsExceed', { platform: platformText })
            },
            { 
                icon: '📋', 
                text: getTranslation('contentViolateGuidelines', { region: regionText })
            }
        ].slice(0, Math.min(scenario.issueCount, 2)) : [];
        
        recommendations = [
            { 
                icon: '📈', 
                text: getTranslation('useTrendingHashtags', { platform: platformText })
            },
            { 
                icon: '⏰', 
                text: getTranslation('bestPostingTime', { region: regionText })
            }
        ];
    } else { // premium
        issues = scenario.issueCount > 0 ? [
            { 
                icon: '🎵', 
                text: 'Audio enhancement needed - our AI recommends voice optimization'
            },
            { 
                icon: '📹', 
                text: 'Visual quality below platform standards'
            },
            { 
                icon: '⏱️', 
                text: `Video pacing needs adjustment for ${platformText}`
            }
        ].slice(0, Math.min(scenario.issueCount, 3)) : [];
        
        recommendations = [
            { 
                icon: '🧠', 
                text: 'AI Analysis: Adjust content pacing for better engagement'
            },
            { 
                icon: '🎯', 
                text: 'Optimization tip: Add stronger hooks in first 3 seconds'
            },
            { 
                icon: '⭐', 
                text: 'Our advanced AI suggests format tweaks for viral potential'
            }
        ];
    }
    
    return {
        score: scenario.score,
        status,
        statusIcon,
        issues,
        recommendations
    };
}

function displayResults(results) {
    // Update score display
    const scoreValue = document.getElementById('scoreValue');
    const statusText = document.getElementById('statusText');
    const statusIcon = document.getElementById('statusIcon');
    const scoreCircle = document.getElementById('scoreCircle');
    
    if (scoreValue) scoreValue.textContent = results.score;
    if (statusText) statusText.textContent = results.status;
    if (statusIcon) statusIcon.textContent = results.statusIcon;
    
    // Color code the score circle
    if (scoreCircle) {
        if (results.score >= 90) {
            scoreCircle.style.background = 'linear-gradient(135deg, #28a745, #20c997)';
        } else if (results.score >= 70) {
            scoreCircle.style.background = 'linear-gradient(135deg, #ffc107, #fd7e14)';
        } else {
            scoreCircle.style.background = 'linear-gradient(135deg, #dc3545, #e74c3c)';
        }
    }
    
    // Display issues
    const issuesList = document.getElementById('issuesList');
    if (issuesList) {
        issuesList.innerHTML = '';
        results.issues.forEach(issue => {
            const issueItem = document.createElement('div');
            issueItem.className = 'issue-item';
            issueItem.innerHTML = `
                <span style="font-size: 18px;">${issue.icon}</span>
                <span>${issue.text}</span>
            `;
            issuesList.appendChild(issueItem);
        });
    }
    
    // Display recommendations
    const recommendationsList = document.getElementById('recommendationsList');
    if (recommendationsList) {
        recommendationsList.innerHTML = '';
        results.recommendations.forEach(rec => {
            const recItem = document.createElement('div');
            recItem.className = 'recommendation-item';
            recItem.innerHTML = `
                <span style="font-size: 18px;">${rec.icon}</span>
                <span>${rec.text}</span>
            `;
            recommendationsList.appendChild(recItem);
        });
    }
}

function saveScanToHistory(results) {
    const historyItem = {
        id: Date.now(),
        fileName: selectedFile.name,
        date: new Date().toLocaleDateString(),
        score: results.score,
        status: results.status,
        platforms: [...selectedPlatforms],
        region: selectedRegion,
        issues: results.issues.length,
        recommendations: results.recommendations.length
    };
    
    scanHistory.unshift(historyItem);
    safeStorage.setItem('checkreel_scan_history', JSON.stringify(scanHistory));
    loadScanHistory();
}

function incrementScanCount() {
    const currentCount = parseInt(safeStorage.getItem('checkreel_scans_used') || '0');
    safeStorage.setItem('checkreel_scans_used', (currentCount + 1).toString());
}

function updateTierDisplay() {
    const userTier = safeStorage.getItem('checkreel_tier') || 'free';
    const scansUsed = parseInt(safeStorage.getItem('checkreel_scans_used') || '0');
    const tierBadge = document.getElementById('tierBadge');
    const scansLeft = document.getElementById('scansLeft');
    
    const limits = {
        free: { limit: 3, name: getTranslation('free-trial') },
        plus: { limit: 20, name: getTranslation('plus-tier') },
        premium: { limit: 40, name: getTranslation('premium-tier') }
    };
    
    const tierInfo = limits[userTier];
    const remaining = Math.max(0, tierInfo.limit - scansUsed);
    
    if (tierBadge) {
        tierBadge.textContent = tierInfo.name;
        tierBadge.className = `tier-badge tier-${userTier}`;
    }
    
    if (scansLeft) {
        scansLeft.textContent = `${remaining} ${getTranslation('scans-left')}`;
    }
}

function updateUserCounter() {
    const randomUsers = Math.floor(Math.random() * 500) + 2500;
    const userEl = document.getElementById('statUsers');
    if (userEl) {
        userEl.textContent = randomUsers.toLocaleString();
    }
}

function updateScansCounter() {
    const scansUsed = parseInt(safeStorage.getItem('checkreel_scans_used') || '0');
    const scansEl = document.getElementById('statScansUsed');
    if (scansEl) {
        scansEl.textContent = scansUsed;
    }
}

function loadScanHistory() {
    const savedHistory = safeStorage.getItem('checkreel_scan_history');
    if (savedHistory) {
        try {
            scanHistory = JSON.parse(savedHistory);
        } catch (e) {
            scanHistory = [];
        }
    }
    
    const historyList = document.getElementById('historyList');
    if (historyList && scanHistory.length > 0) {
        historyList.innerHTML = '';
        scanHistory.slice(0, 5).forEach(item => {
            const historyItem = document.createElement('div');
            historyItem.className = 'history-item';
            
            const platformText = item.platforms.map(p => getTranslation(p)).join(', ');
            const regionText = getTranslation(item.region);
            
            historyItem.innerHTML = `
                <div>
                    <div class="file-name">${item.fileName}</div>
                    <div class="history-date">${item.date}</div>
                </div>
                <div>
                    <span class="platform-tag">${platformText}</span> | 
                    <span class="region-tag">${regionText}</span> | 
                    <span class="score-tag">${getTranslation('score')}: ${item.score}</span>
                </div>
            `;
            historyList.appendChild(historyItem);
        });
    }
}

function filterHistory(filter) {
    document.querySelectorAll('.history-tab').forEach(tab => tab.classList.remove('active'));
    document.querySelector(`[data-filter="${filter}"]`).classList.add('active');
    
    // Filter logic would go here
    loadScanHistory();
}

function closeInsightModal() {
    document.getElementById('insightModal').style.display = 'none';
}

// Toggle scan history section
function toggleHistorySection() {
    const historyContent = document.getElementById('historyContent');
    const historyToggle = document.getElementById('historyToggle');
    
    if (historyContent.classList.contains('expanded')) {
        historyContent.classList.remove('expanded');
        historyToggle.classList.remove('expanded');
    } else {
        historyContent.classList.add('expanded');
        historyToggle.classList.add('expanded');
    }
}

// Add event listeners for history tabs
document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.history-tab').forEach(tab => {
        tab.addEventListener('click', function() {
            const filter = this.getAttribute('data-filter');
            filterHistory(filter);
        });
    });
});

// Complete language content including scan results translations
const DASHBOARD_TRANSLATIONS = {
    en: {
        'choose-plan': 'Choose Your Plan',
        'free-trial': 'Free Trial',
        'plus-tier': 'Plus',
        'premium-tier': 'Premium',
        'per-month': 'mo',
        'free-scans': '3 scans',
        'plus-scans': '20 scans/month',
        'premium-scans': '40 scans/month',
        'free-features': 'Basic compliance check<br>Standard results',
        'plus-features': 'Enhanced compliance check<br>Detailed insights<br>Scan history<br>Priority support',
        'premium-features': 'Full compliance suite<br>Advanced analytics<br>Team features<br>White-label reports<br>API access<br>Dedicated support',
        'selection-alert': 'Please select a region and platform before uploading content for analysis',
        'select-region': '🌍 Select Region',
        'select-platform': '📱 Select Target Platform',
        'upload-content': '📁 Upload Content to Check',
        'drop-here': 'Drop your content here',
        'click-browse': 'or click to browse files',
        'start-check': 'Start Content Check',
        'analyzing': 'Analyzing...',
        'scan-history-title': 'Scan History',
        'all-scans': 'All Scans',
        'by-region': 'By Region',
        'by-platform': 'By Platform',
        'compliance-report': 'Compliance Report',
        'issues-found': 'Issues Found',
        'recommendations': 'Recommendations',
        'active-users': 'Active Users',
        'content-scanned': 'Content Scanned',
        'success-rate': 'Success Rate',
        'platforms': 'Platforms',
        'scans-used': 'Scans Used (Testing)',
        'scans-left': 'scans left',
        'recommended': 'RECOMMENDED',
        'middle-east': 'Middle East',
        'global': 'Global',
        'europe': 'Europe',
        'mena': 'MENA',
        'tiktok': 'TikTok',
        'youtube': 'YouTube',
        'instagram': 'Instagram',
        'facebook': 'Facebook',
        'twitter': 'Twitter',
        'snapchat': 'Snapchat',
        'score': 'Score',
        'majorIssues': 'Major Issues - Do Not Post',
        'minorIssues': 'Minor Issues - Review Recommended',
        'noIssues': 'Perfect! Ready to Post',
        'useTrendingHashtags': 'Use trending hashtags for {platform}',
        'bestPostingTime': 'Best posting time for {region}: 7-9 PM local',
        'audioLevelsExceed': 'Audio levels exceed {platform} limits',
        'contentViolateGuidelines': 'Content may violate {region} community guidelines',
        'secure-payment': 'Secure payment powered by Stripe. Cancel anytime.',
        'whats-included': 'What\'s Included',
        'feature-enhanced': 'Enhanced compliance checking',
        'feature-insights': 'Detailed content insights', 
        'feature-history': 'Complete scan history',
        'feature-support': 'Priority customer support',
        'feature-compliance': 'Full compliance suite',
        'feature-analytics': 'Advanced analytics',
        'feature-team': 'Team collaboration features',
        'feature-reports': 'White-label reports',
        'feature-api': 'API access',
        'feature-dedicated': 'Dedicated account manager',
        'upgrade-to': 'Upgrade to',
        'unlock-features': 'Unlock premium features and boost your content success!',
        'maybe-later': 'Maybe Later',
        'subscribe-now': 'Subscribe Now',
        'remove-file': 'Remove File',
        countries: {
            "middle-east": {
                uae: "United Arab Emirates",
                saudi: "Saudi Arabia",
                qatar: "Qatar", 
                kuwait: "Kuwait",
                bahrain: "Bahrain",
                oman: "Oman",
                iraq: "Iraq",
                yemen: "Yemen", 
                palestine: "Palestine",
                lebanon: "Lebanon",
                jordan: "Jordan",
                syria: "Syria",
                turkey: "Turkey",
                iran: "Iran"
            },
            "global": {
                usa: "United States",
                uk: "United Kingdom", 
                canada: "Canada",
                australia: "Australia",
                newzealand: "New Zealand",
                japan: "Japan",
                southkorea: "South Korea",
                singapore: "Singapore",
                india: "India",
                brazil: "Brazil",
                mexico: "Mexico",
                argentina: "Argentina", 
                china: "China",
                russia: "Russia",
                southafrica: "South Africa",
                indonesia: "Indonesia"
            },
            "europe": {
                france: "France",
                germany: "Germany",
                italy: "Italy",
                spain: "Spain",
                netherlands: "Netherlands",
                sweden: "Sweden",
                norway: "Norway",
                denmark: "Denmark",
                finland: "Finland",
                belgium: "Belgium",
                switzerland: "Switzerland",
                austria: "Austria",
                portugal: "Portugal",
                greece: "Greece",
                poland: "Poland",
                czech: "Czech Republic",
                ireland: "Ireland",
                hungary: "Hungary",
                slovakia: "Slovakia",
                romania: "Romania",
                bulgaria: "Bulgaria",
                estonia: "Estonia",
                latvia: "Latvia",
                lithuania: "Lithuania"
            },
            "mena": {
                egypt: "Egypt",
                morocco: "Morocco",
                tunisia: "Tunisia",
                algeria: "Algeria",
                libya: "Libya",
                sudan: "Sudan",
                palestine: "Palestine",
                jordan: "Jordan",
                lebanon: "Lebanon",
                syria: "Syria",
                iraq: "Iraq",
                yemen: "Yemen",
                mauritania: "Mauritania",
                djibouti: "Djibouti",
                comoros: "Comoros",
                somalia: "Somalia",
                saudi: "Saudi Arabia",
                uae: "United Arab Emirates",
                kuwait: "Kuwait",
                bahrain: "Bahrain",
                oman: "Oman"
            }
        }
    },
    fr: {
        'choose-plan': 'Choisissez votre plan',
        'free-trial': 'Essai gratuit',
        'plus-tier': 'Plus',
        'premium-tier': 'Premium',
        'per-month': 'mois',
        'free-scans': '3 analyses',
        'plus-scans': '20 analyses/mois',
        'premium-scans': '40 analyses/mois',
        'free-features': 'Vérification de conformité de base<br>Résultats standards',
        'plus-features': 'Vérification de conformité améliorée<br>Informations détaillées<br>Historique des analyses<br>Support prioritaire',
        'premium-features': 'Suite de conformité complète<br>Analyses avancées<br>Fonctionnalités d\'équipe<br>Rapports en marque blanche<br>Accès API<br>Support dédié',
        'selection-alert': 'Veuillez sélectionner une région et une plateforme avant de télécharger le contenu pour analyse',
        'select-region': '🌍 Sélectionner la région',
        'select-platform': '📱 Sélectionner la plateforme cible',
        'upload-content': '📁 Télécharger le contenu à vérifier',
        'drop-here': 'Déposez votre contenu ici',
        'click-browse': 'ou cliquez pour parcourir les fichiers',
        'start-check': 'Commencer la vérification du contenu',
        'analyzing': 'Analyse en cours...',
        'scan-history-title': 'Historique des analyses',
        'all-scans': 'Toutes les analyses',
        'by-region': 'Par région',
        'by-platform': 'Par plateforme',
        'compliance-report': 'Rapport de conformité',
        'issues-found': 'Problèmes trouvés',
        'recommendations': 'Recommandations',
        'active-users': 'Utilisateurs actifs',
        'content-scanned': 'Contenu analysé',
        'success-rate': 'Taux de réussite',
        'platforms': 'Plateformes',
        'scans-used': 'Analyses utilisées (Test)',
        'scans-left': 'analyses restantes',
        'recommended': 'RECOMMANDÉ',
        'middle-east': 'Moyen-Orient',
        'global': 'Global',
        'europe': 'Europe',
        'mena': 'MENA',
        'tiktok': 'TikTok',
        'youtube': 'YouTube',
        'instagram': 'Instagram',
        'facebook': 'Facebook',
        'twitter': 'Twitter',
        'snapchat': 'Snapchat',
        'score': 'Score',
        'majorIssues': 'Problèmes majeurs - Ne pas publier',
        'minorIssues': 'Problèmes mineurs - Révision recommandée',
        'noIssues': 'Parfait! Prêt à publier',
        'useTrendingHashtags': 'Utilisez des hashtags tendance pour {platform}',
        'bestPostingTime': 'Meilleur moment pour publier au {region}: 19h-21h heure locale',
        'audioLevelsExceed': 'Les niveaux audio dépassent les limites {platform}',
        'contentViolateGuidelines': 'Le contenu peut violer les directives communautaires du {region}',
        'secure-payment': 'Paiement sécurisé par Stripe. Annulez à tout moment.',
        'whats-included': 'Ce qui est inclus',
        'feature-enhanced': 'Vérification de conformité améliorée',
        'feature-insights': 'Insights de contenu détaillés',
        'feature-history': 'Historique complet des analyses',
        'feature-support': 'Support client prioritaire',
        'feature-compliance': 'Suite de conformité complète',
        'feature-analytics': 'Analyses avancées',
        'feature-team': 'Fonctionnalités de collaboration',
        'feature-reports': 'Rapports en marque blanche',
        'feature-api': 'Accès API',
        'feature-dedicated': 'Gestionnaire de compte dédié',
        'upgrade-to': 'Mettre à niveau vers',
        'unlock-features': 'Débloquez les fonctionnalités premium et boostez votre succès!',
        'maybe-later': 'Peut-être plus tard',
        'subscribe-now': 'S\'abonner maintenant',
        'remove-file': 'Supprimer le fichier',
        countries: {
            "middle-east": {
                uae: "Émirats Arabes Unis",
                saudi: "Arabie Saoudite",
                qatar: "Qatar",
                kuwait: "Koweït",
                bahrain: "Bahreïn",
                oman: "Oman",
                iraq: "Irak",
                yemen: "Yémen",
                palestine: "Palestine",
                lebanon: "Liban",
                jordan: "Jordanie",
                syria: "Syrie",
                turkey: "Turquie",
                iran: "Iran"
            },
            "global": {
                usa: "États-Unis",
                uk: "Royaume-Uni",
                canada: "Canada",
                australia: "Australie",
                newzealand: "Nouvelle-Zélande",
                japan: "Japon",
                southkorea: "Corée du Sud",
                singapore: "Singapour",
                india: "Inde",
                brazil: "Brésil",
                mexico: "Mexique",
                argentina: "Argentine",
                china: "Chine",
                russia: "Russie",
                southafrica: "Afrique du Sud",
                indonesia: "Indonésie"
            },
            "europe": {
                france: "France",
                germany: "Allemagne",
                italy: "Italie",
                spain: "Espagne",
                netherlands: "Pays-Bas",
                sweden: "Suède",
                norway: "Norvège",
                denmark: "Danemark",
                finland: "Finlande",
                belgium: "Belgique",
                switzerland: "Suisse",
                austria: "Autriche",
                portugal: "Portugal",
                greece: "Grèce",
                poland: "Pologne",
                czech: "République Tchèque",
                ireland: "Irlande",
                hungary: "Hongrie",
                slovakia: "Slovaquie",
                romania: "Roumanie",
                bulgaria: "Bulgarie",
                estonia: "Estonie",
                latvia: "Lettonie",
                lithuania: "Lituanie"
            },
            "mena": {
                egypt: "Égypte",
                morocco: "Maroc",
                tunisia: "Tunisie",
                algeria: "Algérie",
                libya: "Libye",
                sudan: "Soudan",
                palestine: "Palestine",
                jordan: "Jordanie",
                lebanon: "Liban",
                syria: "Syrie",
                iraq: "Irak",
                yemen: "Yémen",
                mauritania: "Mauritanie",
                djibouti: "Djibouti",
                comoros: "Comores",
                somalia: "Somalie",
                saudi: "Arabie Saoudite",
                uae: "Émirats Arabes Unis",
                kuwait: "Koweït",
                bahrain: "Bahreïn",
                oman: "Oman"
            }
        }
    },
    ar: {
        'choose-plan': 'اختر خطتك',
        'free-trial': 'تجربة مجانية',
        'plus-tier': 'بلس',
        'premium-tier': 'بريميوم',
        'per-month': 'شهر',
        'free-scans': '3 فحوصات',
        'plus-scans': '20 فحص/شهر',
        'premium-scans': '40 فحص/شهر',
        'free-features': 'فحص امتثال أساسي<br>نتائج قياسية',
        'plus-features': 'فحص امتثال محسّن<br>رؤى مفصلة<br>سجل الفحوصات<br>دعم ذو أولوية',
        'premium-features': 'مجموعة امتثال كاملة<br>تحليلات متقدمة<br>ميزات الفريق<br>تقارير بعلامة تجارية خاصة<br>الوصول إلى API<br>دعم مخصص',
        'selection-alert': 'يرجى اختيار منطقة ومنصة قبل تحميل المحتوى للتحليل',
        'select-region': '🌍 اختر المنطقة',
        'select-platform': '📱 اختر المنصة المستهدفة',
        'upload-content': '📁 ارفع المحتوى للفحص',
        'drop-here': 'اسقط محتواك هنا',
        'click-browse': 'أو انقر لاستعراض الملفات',
        'start-check': 'ابدأ فحص المحتوى',
        'analyzing': 'جاري التحليل...',
        'scan-history-title': 'سجل الفحوصات',
        'all-scans': 'جميع الفحوصات',
        'by-region': 'حسب المنطقة',
        'by-platform': 'حسب المنصة',
        'compliance-report': 'تقرير الامتثال',
        'issues-found': 'المشاكل المكتشفة',
        'recommendations': 'التوصيات',
        'active-users': 'المستخدمون النشطون',
        'content-scanned': 'المحتوى المفحوص',
        'success-rate': 'معدل النجاح',
        'platforms': 'المنصات',
        'scans-used': 'الفحوصات المستخدمة (اختبار)',
        'scans-left': 'فحوصات متبقية',
        'recommended': 'موصى به',
        'middle-east': 'الشرق الأوسط',
        'global': 'عالمي',
        'europe': 'أوروبا',
        'mena': 'منطقة الشرق الأوسط وشمال أفريقيا',
        'tiktok': 'تيك توك',
        'youtube': 'يوتيوب',
        'instagram': 'إنستغرام',
        'facebook': 'فيسبوك',
        'twitter': 'تويتر',
        'snapchat': 'سناب شات',
        'score': 'النتيجة',
        'majorIssues': 'مشاكل كبيرة - لا تنشر',
        'minorIssues': 'مشاكل بسيطة - يُنصح بالمراجعة',
        'noIssues': 'مثالي! جاهز للنشر',
        'useTrendingHashtags': 'استخدم الهاشتاجات الرائجة لـ {platform}',
        'bestPostingTime': 'أفضل وقت للنشر في {region}: 7-9 مساءً بالتوقيت المحلي',
        'audioLevelsExceed': 'مستويات الصوت تتجاوز حدود {platform}',
        'contentViolateGuidelines': 'قد يخالف المحتوى إرشادات مجتمع {region}',
        'secure-payment': 'دفع آمن بواسطة Stripe. إلغاء في أي وقت.',
        'whats-included': 'ما هو مشمول',
        'feature-enhanced': 'فحص امتثال محسن',
        'feature-insights': 'رؤى مفصلة للمحتوى',
        'feature-history': 'سجل كامل للفحوصات',
        'feature-support': 'دعم عملاء ذو أولوية',
        'feature-compliance': 'مجموعة امتثال كاملة',
        'feature-analytics': 'تحليلات متقدمة',
        'feature-team': 'ميزات التعاون الجماعي',
        'feature-reports': 'تقارير بعلامة تجارية خاصة',
        'feature-api': 'وصول API',
        'feature-dedicated': 'مدير حساب مخصص',
        'upgrade-to': 'الترقية إلى',
        'unlock-features': 'افتح الميزات المميزة وعزز نجاح محتواك!',
        'maybe-later': 'ربما لاحقاً',
        'subscribe-now': 'اشترك الآن',
        'remove-file': 'إزالة الملف',
        countries: {
            "middle-east": {
                uae: "الإمارات العربية المتحدة",
                saudi: "المملكة العربية السعودية",
                qatar: "قطر",
                kuwait: "الكويت",
                bahrain: "البحرين",
                oman: "عُمان",
                iraq: "العراق",
                yemen: "اليمن",
                palestine: "فلسطين",
                lebanon: "لبنان",
                jordan: "الأردن",
                syria: "سوريا",
                turkey: "تركيا",
                iran: "إيران"
            },
            "global": {
                usa: "الولايات المتحدة",
                uk: "المملكة المتحدة",
                canada: "كندا",
                australia: "أستراليا",
                newzealand: "نيوزيلندا",
                japan: "اليابان",
                southkorea: "كوريا الجنوبية",
                singapore: "سنغافورة",
                india: "الهند",
                brazil: "البرازيل",
                mexico: "المكسيك",
                argentina: "الأرجنتين",
                china: "الصين",
                russia: "روسيا",
                southafrica: "جنوب أفريقيا",
                indonesia: "إندونيسيا"
            },
            "europe": {
                france: "فرنسا",
                germany: "ألمانيا",
                italy: "إيطاليا",
                spain: "إسبانيا",
                netherlands: "هولندا",
                sweden: "السويد",
                norway: "النرويج",
                denmark: "الدنمارك",
                finland: "فنلندا",
                belgium: "بلجيكا",
                switzerland: "سويسرا",
                austria: "النمسا",
                portugal: "البرتغال",
                greece: "اليونان",
                poland: "بولندا",
                czech: "جمهورية التشيك",
                ireland: "أيرلندا",
                hungary: "المجر",
                slovakia: "سلوفاكيا",
                romania: "رومانيا",
                bulgaria: "بلغاريا",
                estonia: "إستونيا",
                latvia: "لاتفيا",
                lithuania: "ليتوانيا"
            },
            "mena": {
                egypt: "مصر",
                morocco: "المغرب",
                tunisia: "تونس",
                algeria: "الجزائر",
                libya: "ليبيا",
                sudan: "السودان",
                palestine: "فلسطين",
                jordan: "الأردن",
                lebanon: "لبنان",
                syria: "سوريا",
                iraq: "العراق",
                yemen: "اليمن",
                mauritania: "موريتانيا",
                djibouti: "جيبوتي",
                comoros: "جزر القمر",
                somalia: "الصومال",
                saudi: "المملكة العربية السعودية",
                uae: "الإمارات العربية المتحدة",
                kuwait: "الكويت",
                bahrain: "البحرين",
                oman: "عُمان"
            }
        }
    }
};

// Language switching function
function setLanguage(lang) {
    currentLanguage = lang;
    
    // Update language buttons
    document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.classList.toggle('active', btn.textContent === lang.toUpperCase());
    });
    
    // Update RTL for Arabic
    if (lang === 'ar') {
        document.body.setAttribute('dir', 'rtl');
        document.documentElement.setAttribute('dir', 'rtl');
    } else {
        document.body.removeAttribute('dir');
        document.documentElement.removeAttribute('dir');
    }
    
    // Apply all translations
    applyDashboardTranslations(lang);
    
    // Save language preference
    safeStorage.setItem('checkreel_language', lang);
}

// Get translation with placeholder replacement
function getTranslation(key, placeholders = {}) {
    const translations = DASHBOARD_TRANSLATIONS[currentLanguage] || DASHBOARD_TRANSLATIONS['en'];
    let text = translations[key] || key;
    
    // Replace placeholders
    Object.keys(placeholders).forEach(placeholder => {
        text = text.replace(`{${placeholder}}`, placeholders[placeholder]);
    });
    
    return text;
}

// Apply dashboard translations
function applyDashboardTranslations(lang) {
    const translations = DASHBOARD_TRANSLATIONS[lang] || DASHBOARD_TRANSLATIONS['en'];
    
    Object.keys(translations).forEach(key => {
        const element = document.getElementById(key);
        if (element) {
            if (key.includes('features')) {
                element.innerHTML = translations[key];
            } else {
                element.textContent = translations[key];
            }
        }
    });
    
    // Update dynamic content and buttons
    const removeFileBtn = document.getElementById('removeFile');
    if (removeFileBtn) removeFileBtn.textContent = getTranslation('remove-file');
    
    const maybeLaterlBtn = document.getElementById('maybe-later');
    if (maybeLaterlBtn) maybeLaterlBtn.textContent = getTranslation('maybe-later');
    
    const subscribeBtn = document.getElementById('subscribe-now');
    if (subscribeBtn) subscribeBtn.textContent = getTranslation('subscribe-now');
    
    // Update file upload text
    const dropHereEl = document.getElementById('drop-here');
    if (dropHereEl) dropHereEl.textContent = getTranslation('drop-here');
    
    const clickBrowseEl = document.getElementById('click-browse');
    if (clickBrowseEl) clickBrowseEl.textContent = getTranslation('click-browse');
    
    // Update scan button text
    const startCheckEl = document.getElementById('start-check');
    if (startCheckEl) startCheckEl.textContent = getTranslation('start-check');
    
    // Update alerts and dynamic messages
    const selectionAlertEl = document.getElementById('selection-alert');
    if (selectionAlertEl) selectionAlertEl.textContent = getTranslation('selection-alert');
    
    // Update payment modal content if visible
    const upgradeToEl = document.getElementById('upgrade-to');
    if (upgradeToEl) upgradeToEl.textContent = getTranslation('upgrade-to');
    
    const unlockFeaturesEl = document.getElementById('unlock-features');
    if (unlockFeaturesEl) unlockFeaturesEl.textContent = getTranslation('unlock-features');
    
    const securePaymentEl = document.getElementById('secure-payment');
    if (securePaymentEl) securePaymentEl.textContent = getTranslation('secure-payment');
    
    // Add country modal translations
    const countryModalTitle = document.getElementById('countryModalTitle');
    const countrySearch = document.getElementById('countrySearch');
    
    if (countryModalTitle && currentModalRegion) {
        const regionName = getTranslation(currentModalRegion);
        countryModalTitle.textContent = `Select Country - ${regionName}`;
    }
    
    if (countrySearch) {
        const searchPlaceholders = {
            en: 'Search countries...',
            fr: 'Rechercher des pays...',
            ar: 'البحث عن البلدان...'
        };
        countrySearch.placeholder = searchPlaceholders[lang] || searchPlaceholders['en'];
    }
    
    // Refresh country list if modal is open
    if (currentModalRegion && document.getElementById('countryModal').style.display === 'block') {
        populateCountries(currentModalRegion);
    }
    
    // Update scan history platform/region tags
    updateScanHistoryTranslations();
    updateTierDisplay();
}

// Update scan history translations
function updateScanHistoryTranslations() {
    document.querySelectorAll('[data-translate]').forEach(element => {
        const key = element.getAttribute('data-translate');
        if (key === 'score') {
            const scoreMatch = element.textContent.match(/Score: (\d+)/);
            if (scoreMatch) {
                element.textContent = `${getTranslation('score')}: ${scoreMatch[1]}`;
            }
        } else {
            element.textContent = getTranslation(key);
        }
    });
}

// Language change handler - listen for changes from lang-loader.js
window.addEventListener('languageChanged', function(event) {
    currentLanguage = event.detail.language;
    applyDashboardTranslations(currentLanguage);
    
    if (currentLanguage === 'ar') {
        document.body.setAttribute('dir', 'rtl');
        document.documentElement.setAttribute('dir', 'rtl');
    } else {
        document.body.removeAttribute('dir');
        document.documentElement.removeAttribute('dir');
    }
    
    // Refresh scan history with new translations
    loadScanHistory();
});

// Initialize dashboard with language persistence
document.addEventListener('DOMContentLoaded', function() {
    currentLanguage = safeStorage.getItem('checkreel_language') || 'en';
    
    // Check payment status first
    checkPaymentStatus();
    
    if (window.loadLanguageContent) {
        window.loadLanguageContent(currentLanguage);
    }
    
    setTimeout(() => {
        applyDashboardTranslations(currentLanguage);
        
        if (currentLanguage === 'ar') {
            document.body.setAttribute('dir', 'rtl');
            document.documentElement.setAttribute('dir', 'rtl');
        } else {
            document.body.removeAttribute('dir');
            document.documentElement.removeAttribute('dir');
        }
        
        // Update language button states
        document.querySelectorAll('.lang-btn').forEach(btn => {
            btn.classList.toggle('active', btn.textContent === currentLanguage.toUpperCase());
        });
    }, 100);
    
    initializeUpload();
    updateTierDisplay();
    updateUserCounter();
    updateScansCounter();
    loadScanHistory();
    
    // Show selection alert initially since nothing is selected
    updateSelectionAlert();
});

console.log('✅ Dashboard fully loaded with complete multilingual support');
</script>
</body>
</html>
