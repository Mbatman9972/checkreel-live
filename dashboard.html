<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CheckReel Dashboard</title>
<link rel="icon" type="image/x-icon" href="images/favicon.ico">
<!-- Commented out to prevent 401 error -->
<!-- <link rel="manifest" href="manifest.json"> -->
<style>
* {
margin: 0;
padding: 0;
box-sizing: border-box;
}

body {
font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
background: linear-gradient(135deg, #1e3c72 0%, #2a5298 25%, #667eea 50%, #764ba2 75%, #8e44ad 100%);
min-height: 100vh;
color: #333;
}
body[dir="rtl"] .container {
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
}

body[dir="rtl"] .card {
    display: block !important;
    visibility: visible !important;
}
.container {
max-width: 1200px;
margin: 0 auto;
padding: 20px;
}

/* Header */
.header {
display: flex;
justify-content: space-between;
align-items: center;
background: rgba(255, 255, 255, 0.95);
backdrop-filter: blur(10px);
padding: 15px 30px;
border-radius: 15px;
margin-bottom: 30px;
box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
}

.logo-section {
display: flex;
align-items: center;
gap: 15px;
}

.logo-img {
width: 45px;
height: 45px;
border-radius: 10px;
}

.logo-text {
font-size: 24px;
font-weight: bold;
background: linear-gradient(45deg, #1e3c72, #667eea);
-webkit-background-clip: text;
-webkit-text-fill-color: transparent;
background-clip: text;
}

.user-section {
display: flex;
align-items: center;
gap: 20px;
}

.tier-badge {
padding: 8px 16px;
border-radius: 20px;
font-size: 12px;
font-weight: 600;
text-transform: uppercase;
letter-spacing: 0.5px;
}

.tier-free { background: #e3f2fd; color: #1976d2; }
.tier-plus { background: #f3e5f5; color: #7b1fa2; }
.tier-premium { background: #fff3e0; color: #f57c00; }

/* Main Content */
.dashboard-grid {
display: grid;
grid-template-columns: 1fr 1fr 1fr;
gap: 20px;
margin-bottom: 30px;
}

.card {
background: rgba(255, 255, 255, 0.95);
backdrop-filter: blur(10px);
border-radius: 20px;
padding: 25px;
box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
}

.card h2 {
margin-bottom: 20px;
color: #333;
display: flex;
align-items: center;
gap: 10px;
font-size: 18px;
}

/* Region Selection */
.region-grid {
display: grid;
grid-template-columns: repeat(2, 1fr);
gap: 10px;
margin-bottom: 15px;
}

.region-option {
display: flex;
flex-direction: column;
align-items: center;
padding: 15px;
border: 2px solid #e0e0e0;
border-radius: 12px;
cursor: pointer;
transition: all 0.3s ease;
background: white;
text-align: center;
}

.region-option:hover {
transform: translateY(-2px);
box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
}

.region-option.selected {
border-color: #1e3c72;
background: linear-gradient(135deg, #1e3c72 0%, #667eea 100%);
color: white;
animation: glowPulse 2s infinite ease-in-out;
}

@keyframes glowPulse {
0%, 100% {
box-shadow: 0 0 20px rgba(30, 60, 114, 0.7);
}
50% {
box-shadow: 0 0 30px rgba(30, 60, 114, 1), 0 0 40px rgba(102, 126, 234, 0.8);
}
}

.region-icon {
width: 35px;
height: 35px;
margin-bottom: 8px;
border-radius: 6px;
object-fit: cover;
}

.region-name {
font-size: 12px;
font-weight: 600;
}

/* Platform Selection */
.platforms-grid {
display: grid;
grid-template-columns: repeat(3, 1fr);
gap: 12px;
}

.platform-option {
display: flex;
flex-direction: column;
align-items: center;
padding: 15px;
border: 2px solid #e0e0e0;
border-radius: 12px;
cursor: pointer;
transition: all 0.3s ease;
background: white;
position: relative;
overflow: hidden;
}

.platform-option:hover {
transform: translateY(-2px);
box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
}

.platform-option.selected {
border-color: #ff1493;
background: linear-gradient(135deg, #ff1493 0%, #ff69b4 100%);
color: white;
animation: pinkGlow 2s infinite ease-in-out;
}

@keyframes pinkGlow {
0%, 100% {
box-shadow: 0 0 20px rgba(255, 20, 147, 0.7);
}
50% {
box-shadow: 0 0 30px rgba(255, 20, 147, 1), 0 0 40px rgba(255, 105, 180, 0.8);
}
}

.platform-icon {
width: 35px;
height: 35px;
margin-bottom: 8px;
border-radius: 6px;
object-fit: cover;
transition: all 0.3s ease;
opacity: 1;
}

.platform-option.selected .platform-icon {
opacity: 1;
filter: brightness(1.2) contrast(1.1);
}

.platform-name {
font-size: 11px;
font-weight: 600;
text-align: center;
}

/* File Upload */
.upload-area {
border: 3px dashed #ddd;
border-radius: 15px;
padding: 30px;
text-align: center;
cursor: pointer;
transition: all 0.3s ease;
background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
}

.upload-area:hover {
border-color: #1e3c72;
background: linear-gradient(135deg, #e3f2fd 0%, #f8f9fa 100%);
}

.upload-area.dragover {
border-color: #1e3c72;
background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
transform: scale(1.02);
}

.upload-icon {
font-size: 36px;
margin-bottom: 10px;
display: block;
}

.file-info {
display: none;
text-align: center;
padding: 20px;
background: #f8f9fa;
border-radius: 10px;
border: 2px solid #28a745;
}

.file-name {
font-weight: 600;
margin-bottom: 5px;
}

.remove-file {
background: #dc3545;
color: white;
border: none;
padding: 8px 16px;
border-radius: 5px;
cursor: pointer;
margin-top: 10px;
}

/* Tier Selection */
.tier-selection {
background: rgba(255, 255, 255, 0.95);
backdrop-filter: blur(10px);
border-radius: 20px;
padding: 25px;
margin-bottom: 20px;
box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
}

.tier-plans {
display: grid;
grid-template-columns: repeat(3, 1fr);
gap: 15px;
margin-top: 15px;
}

.tier-plan {
background: white;
border: 2px solid #e0e0e0;
border-radius: 15px;
padding: 20px;
text-align: center;
cursor: pointer;
transition: all 0.3s ease;
position: relative;
}

.tier-plan:hover {
transform: translateY(-3px);
box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
}

.tier-plan.active {
border-color: #1e3c72;
background: linear-gradient(135deg, #1e3c72 0%, #667eea 100%);
color: white;
}

.tier-plan.recommended {
border-color: #ff6b6b;
}

.tier-plan.recommended::before {
content: "RECOMMENDED";
position: absolute;
top: -10px;
left: 50%;
transform: translateX(-50%);
background: #ff6b6b;
color: white;
padding: 4px 12px;
border-radius: 12px;
font-size: 10px;
font-weight: bold;
}

.tier-name {
font-size: 16px;
font-weight: bold;
margin-bottom: 8px;
}

.tier-price {
font-size: 18px;
font-weight: bold;
color: #1e3c72;
margin-bottom: 8px;
}

.tier-plan.active .tier-price {
color: white;
}

.tier-scans {
font-size: 12px;
opacity: 0.8;
margin-bottom: 10px;
}

.tier-features {
font-size: 11px;
opacity: 0.9;
line-height: 1.4;
}

/* Selection Alert - Moved below tier selection */
.selection-alert {
background: linear-gradient(135deg, #ff6b6b, #ff8e8e);
color: white;
padding: 15px 25px;
border-radius: 10px;
margin-bottom: 20px;
text-align: center;
font-weight: 600;
box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
}

.selection-alert.hidden {
display: none;
}

/* Scan Button */
.scan-section {
text-align: center;
margin-top: 30px;
position: relative;
z-index: 10;
}

.scan-btn {
background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
color: white;
border: none;
padding: 15px 40px;
border-radius: 25px;
font-size: 18px;
font-weight: 600;
cursor: pointer;
transition: all 0.3s ease;
display: inline-flex;
align-items: center;
gap: 10px;
min-width: 200px;
justify-content: center;
position: relative;
}

.scan-btn:disabled {
background: #ccc;
cursor: not-allowed;
}

.scan-btn.ready {
background: linear-gradient(135deg, #1e3c72 0%, #667eea 100%);
box-shadow: 0 8px 25px rgba(30, 60, 114, 0.3);
}

.scan-btn.ready:hover {
transform: translateY(-2px);
box-shadow: 0 12px 35px rgba(30, 60, 114, 0.4);
}

.btn-loader {
display: none;
width: 20px;
height: 20px;
border: 2px solid transparent;
border-top: 2px solid white;
border-radius: 50%;
animation: spin 1s linear infinite;
}

.btn-loader.active {
display: block;
}

@keyframes spin {
0% { transform: rotate(0deg); }
100% { transform: rotate(360deg); }
}

/* Scan History */
.scan-history {
background: rgba(255, 255, 255, 0.95);
backdrop-filter: blur(10px);
border-radius: 20px;
padding: 25px;
margin-top: 50px;
margin-bottom: 30px;
box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
display: none;
}

.scan-history.visible {
display: block;
}

.history-tabs {
display: flex;
gap: 10px;
margin-bottom: 20px;
border-bottom: 2px solid #e0e0e0;
}

.history-tab {
padding: 10px 20px;
background: none;
border: none;
cursor: pointer;
font-weight: 600;
color: #666;
transition: all 0.3s ease;
border-bottom: 3px solid transparent;
}

.history-tab.active {
color: #1e3c72;
border-bottom-color: #1e3c72;
}

.history-list {
max-height: 300px;
overflow-y: auto;
}

.history-item {
display: flex;
justify-content: space-between;
align-items: center;
padding: 15px;
background: #f8f9fa;
border-radius: 10px;
margin-bottom: 10px;
cursor: pointer;
transition: all 0.3s ease;
}

.history-item:hover {
background: #e3f2fd;
transform: translateX(5px);
}

.history-date {
font-size: 12px;
color: #666;
}

/* Countries Modal */
.countries-modal {
display: none;
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: rgba(0, 0, 0, 0.8);
z-index: 1000;
padding: 20px;
}

.countries-content {
background: white;
border-radius: 20px;
padding: 30px;
max-width: 600px;
max-height: 80vh;
margin: 50px auto;
overflow-y: auto;
position: relative;
}

.close-modal {
position: absolute;
top: 15px;
right: 20px;
background: none;
border: none;
font-size: 24px;
cursor: pointer;
color: #666;
}

.countries-grid {
display: grid;
grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
gap: 10px;
margin-top: 20px;
}

.country-item {
padding: 10px;
background: #f8f9fa;
border-radius: 8px;
text-align: center;
cursor: pointer;
transition: all 0.3s ease;
border: 2px solid transparent;
}

.country-item:hover {
background: #e3f2fd;
border-color: #1e3c72;
}

/* Results Section */
.results-section {
display: none;
margin-top: 30px;
}

.score-display {
display: flex;
align-items: center;
justify-content: center;
gap: 30px;
margin-bottom: 30px;
}

.score-circle {
width: 120px;
height: 120px;
border-radius: 50%;
display: flex;
align-items: center;
justify-content: center;
position: relative;
box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
}

.score-circle::before {
content: '';
width: 80px;
height: 80px;
background: white;
border-radius: 50%;
position: absolute;
}

.score-value {
font-size: 24px;
font-weight: bold;
z-index: 1;
color: #333;
}

.status-indicator {
display: flex;
align-items: center;
gap: 10px;
font-size: 18px;
font-weight: 600;
}

.status-icon {
font-size: 24px;
}

.results-grid {
display: grid;
grid-template-columns: 1fr 1fr;
gap: 20px;
}

.issues-card, .recommendations-card {
background: white;
padding: 20px;
border-radius: 15px;
box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
}

.issue-item, .recommendation-item {
display: flex;
align-items: center;
gap: 10px;
padding: 10px;
margin-bottom: 10px;
background: #f8f9fa;
border-radius: 8px;
cursor: pointer;
transition: all 0.3s ease;
}

.issue-item:hover, .recommendation-item:hover {
background: #e3f2fd;
transform: translateX(5px);
}

/* Insight Modal */
.insight-modal {
display: none;
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: rgba(0, 0, 0, 0.8);
z-index: 1000;
padding: 20px;
}

.insight-content {
background: white;
border-radius: 20px;
padding: 30px;
max-width: 500px;
margin: 50px auto;
position: relative;
}

.insight-content h3 {
margin-bottom: 20px;
color: #1e3c72;
}

/* Stats */
.stats-grid {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
gap: 15px;
margin-bottom: 20px;
}

.stat-card {
background: rgba(255, 255, 255, 0.95);
backdrop-filter: blur(10px);
padding: 15px;
border-radius: 15px;
text-align: center;
box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
}

.stat-number {
font-size: 20px;
font-weight: bold;
color: #1e3c72;
margin-bottom: 5px;
}

.stat-label {
color: #666;
font-size: 12px;
}

/* Footer */
.footer {
text-align: center;
padding: 20px 0;
color: rgba(255, 255, 255, 0.8);
font-size: 14px;
margin-top: 40px;
}

/* Responsive */
@media (max-width: 1024px) {
.dashboard-grid {
grid-template-columns: 1fr 1fr;
}
}

@media (max-width: 768px) {
.dashboard-grid {
grid-template-columns: 1fr;
}
.platforms-grid {
grid-template-columns: repeat(2, 1fr);
}
.region-grid {
grid-template-columns: 1fr;
}
.tier-plans {
grid-template-columns: 1fr;
}
.score-display {
flex-direction: column;
gap: 20px;
}
}
</style>
</head>
<body>
<div class="container">
<!-- Header -->
<div class="header">
<div class="logo-section">
<img src="images/logo.png" alt="CheckReel Logo" class="logo-img">
<span class="logo-text">CheckReel</span>
</div>
<div class="user-section">
<span id="scansLeft">3 scans left</span>
<span id="tierBadge" class="tier-badge tier-free">Free Trial</span>
</div>
</div>

<!-- Tier Selection -->
<div class="tier-selection">
<h2>?? Choose Your Plan</h2>
<div class="tier-plans">
<div class="tier-plan active" data-tier="free" onclick="selectTier('free')">
<div class="tier-name">Free Trial</div>
<div class="tier-price">$0</div>
<div class="tier-scans">3 scans</div>
<div class="tier-features">Basic compliance check<br>Standard results</div>
</div>
<div class="tier-plan recommended" data-tier="plus" onclick="selectTier('plus')">
<div class="tier-name">Plus</div>
<div class="tier-price">$4.99/mo</div>
<div class="tier-scans">20 scans/month</div>
<div class="tier-features">Enhanced compliance check<br>Detailed insights<br>Scan history<br>Priority support</div>
</div>
<div class="tier-plan" data-tier="premium" onclick="selectTier('premium')">
<div class="tier-name">Premium</div>
<div class="tier-price">$9.99/mo</div>
<div class="tier-scans">40 scans/month</div>
<div class="tier-features">All features included<br>Advanced AI-powered guidance<br>Assured content optimization<br>Multi-platform scanning (up to 3)<br>Complete scan history</div>
</div>
</div>
</div>

<!-- Selection Alert - MOVED BELOW TIER SELECTION -->
<div id="selectionAlert" class="selection-alert">
?? Please select a region and platform before uploading content for analysis
</div>

<!-- Main Dashboard -->
<div class="dashboard-grid">
<!-- Region Selection -->
<div class="card">
<h2>?? Select Region</h2>
<div class="region-grid">
<div class="region-option" data-region="global" onclick="selectRegion('global')">
<img src="images/region-icons/global.png" alt="Global" class="region-icon"
onerror="this.outerHTML='<div style=&quot;width: 35px; height: 35px; background: #3498db; border-radius: 6px; margin-bottom: 8px; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 12px;&quot;>??</div>';">
<span class="region-name">Global</span>
</div>
<div class="region-option" data-region="middle-east" onclick="selectRegion('middle-east'); showCountries('middleEast')">
<img src="images/region-icons/middle-east.png" alt="Middle East" class="region-icon"
onerror="this.outerHTML='<div style=&quot;width: 35px; height: 35px; background: #e74c3c; border-radius: 6px; margin-bottom: 8px; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 10px;&quot;>ME</div>';">
<span class="region-name">Middle East</span>
</div>
<div class="region-option" data-region="mena" onclick="selectRegion('mena'); showCountries('mena')">
<img src="images/region-icons/mena.png" alt="MENA" class="region-icon"
onerror="this.outerHTML='<div style=&quot;width: 35px; height: 35px; background: #f39c12; border-radius: 6px; margin-bottom: 8px; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 10px;&quot;>MENA</div>';">
<span class="region-name">MENA</span>
</div>
<div class="region-option" data-region="europe" onclick="selectRegion('europe'); showCountries('europe')">
<img src="images/region-icons/europe.png" alt="Europe" class="region-icon"
onerror="this.outerHTML='<div style=&quot;width: 35px; height: 35px; background: #9b59b6; border-radius: 6px; margin-bottom: 8px; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 12px;&quot;>EU</div>';">
<span class="region-name">Europe</span>
</div>
</div>
</div>

<!-- Platform Selection -->
<div class="card">
<h2>?? Select Platform <span id="platformCounter" style="font-size: 12px; color: #666;"></span></h2>
<div class="platforms-grid">
<div class="platform-option" data-platform="tiktok" onclick="selectPlatform('tiktok')">
<img src="images/tiktok.png" alt="TikTok" class="platform-icon">
<span class="platform-name">TikTok</span>
</div>
<div class="platform-option" data-platform="youtube" onclick="selectPlatform('youtube')">
<img src="images/youtube.png" alt="YouTube" class="platform-icon">
<span class="platform-name">YouTube</span>
</div>
<div class="platform-option" data-platform="instagram" onclick="selectPlatform('instagram')">
<img src="images/instagram.png" alt="Instagram" class="platform-icon">
<span class="platform-name">Instagram</span>
</div>
<div class="platform-option" data-platform="facebook" onclick="selectPlatform('facebook')">
<img src="images/facebook.png" alt="Facebook" class="platform-icon">
<span class="platform-name">Facebook</span>
</div>
<div class="platform-option" data-platform="twitter" onclick="selectPlatform('twitter')">
<img src="images/twitter.png" alt="Twitter" class="platform-icon">
<span class="platform-name">Twitter</span>
</div>
<div class="platform-option" data-platform="snapchat" onclick="selectPlatform('snapchat')">
<img src="images/snapchat.png" alt="Snapchat" class="platform-icon">
<span class="platform-name">Snapchat</span>
</div>
</div>
</div>

<!-- File Upload -->
<div class="card">
<h2>?? Upload Content</h2>
<div id="uploadArea" class="upload-area">
<span class="upload-icon">??</span>
<h3>Drop your content here</h3>
<p>or click to browse files</p>
<small>Supports: MP4, MOV, JPG, PNG, MP3, WAV (max 100MB)</small>
</div>
<div id="fileInfo" class="file-info">
<div class="file-name" id="fileName"></div>
<div class="file-size" id="fileSize"></div>
<button id="removeFile" class="remove-file">Remove File</button>
</div>
<input type="file" id="fileInput" style="display: none;" accept="video/*,image/*,audio/*">
</div>
</div>

<!-- Scan Button -->
<div class="scan-section">
<button id="scanBtn" class="scan-btn" disabled>
<span id="scan-btn-text">Start Content Check</span>
<div id="btnLoader" class="btn-loader"></div>
</button>
</div>

<!-- Scan History (for Plus and Premium) -->
<div id="scanHistory" class="scan-history">
<h2>?? Scan History</h2>
<div class="history-tabs">
<button class="history-tab active" onclick="filterHistory('all')">All Scans</button>
<button class="history-tab" onclick="filterHistory('region')">By Region</button>
<button class="history-tab" onclick="filterHistory('platform')">By Platform</button>
</div>
<div id="historyList" class="history-list"></div>
</div>

<!-- Results Section -->
<div id="resultsSection" class="results-section">
<div class="card">
<h2>?? Compliance Results</h2>
<div class="score-display">
<div id="scoreCircle" class="score-circle">
<span id="scoreValue" class="score-value">85</span>
</div>
<div class="status-indicator">
<span id="statusIcon" class="status-icon">?</span>
<span id="status-text">Ready to Post</span>
</div>
</div>
<div class="results-grid">
<div class="issues-card">
<h3>?? Issues Found</h3>
<div id="issuesList"></div>
</div>
<div class="recommendations-card">
<h3>?? Recommendations</h3>
<div id="recommendationsList"></div>
</div>
</div>
</div>
</div>

<!-- Stats -->
<div class="stats-grid">
<div class="stat-card">
<div class="stat-number">2,697+</div>
<div class="stat-label">Active Users</div>
</div>
<div class="stat-card">
<div class="stat-number">15,847</div>
<div class="stat-label">Content Scanned</div>
</div>
<div class="stat-card">
<div class="stat-number">94%</div>
<div class="stat-label">Success Rate</div>
</div>
<div class="stat-card">
<div class="stat-number">6</div>
<div class="stat-label">Platforms</div>
</div>
<div class="stat-card">
<div class="stat-number" id="scansUsedCounter">0</div>
<div class="stat-label">Scans Used (Testing)</div>
</div>
</div>

<!-- Countries Modal -->
<div id="countriesModal" class="countries-modal">
<div class="countries-content">
<button class="close-modal" onclick="closeCountriesModal()">&times;</button>
<h2 id="modalTitle">Select Country</h2>
<div id="countriesGrid" class="countries-grid"></div>
</div>
</div>

<!-- Insight Modal -->
<div id="insightModal" class="insight-modal">
<div class="insight-content">
<button class="close-modal" onclick="closeInsightModal()">&times;</button>
<h3 id="insightTitle">Insight Details</h3>
<div id="insightContent"></div>
</div>
</div>

<!-- Footer -->
<div class="footer">
<p>&copy; 2025 CheckReel. All rights reserved. Copyright Protected.</p>
</div>
</div>

<!-- IMPORTANT: Load lang-loader.js FIRST -->
<script src="lang-loader.js"></script>

<!-- Main Dashboard Script -->
<script>
// Global variables
let selectedFile = null;
let selectedPlatforms = [];
let selectedRegion = null;
let selectedCountry = null;
let currentTier = 'free';
let scanHistory = [];

// Main initialization - SINGLE DOMContentLoaded
document.addEventListener('DOMContentLoaded', function() {
    // Get current language from localStorage
    const currentLanguage = safeStorage.getItem('checkreel_language') || 'en';
    console.log('Dashboard language set to:', currentLanguage);
    console.log('Language loaded from index.html:', currentLanguage);
    
    // Load language content
    if (window.loadLanguageContent) {
        window.loadLanguageContent(currentLanguage);
    }
    
    // Initialize dashboard
    initializeUpload();
    updateTierDisplay();
    updateUserCounter();
    updateScansCounter();
    loadScanHistory();
    
    // Apply language-specific updates after a short delay
    setTimeout(() => {
        const lang = safeStorage.getItem('checkreel_language') || 'en';
        console.log('Applying language:', lang);
        
        // Force reload language content
        if (window.loadLanguageContent) {
            window.loadLanguageContent(lang);
        }
        
        // Apply dashboard-specific translations
        if (window.LANGUAGE_CONTENT && window.LANGUAGE_CONTENT[lang]) {
            const content = window.LANGUAGE_CONTENT[lang];
            
            // Update scan button
            const scanBtn = document.getElementById('scan-btn-text');
            if (scanBtn && content['start-check']) {
                scanBtn.textContent = content['start-check'];
            }
            
            // Update tier selection title
            const tierTitle = document.querySelector('.tier-selection h2');
            if (tierTitle && content['choose-plan']) {
                tierTitle.textContent = `?? ${content['choose-plan']}`;
            }
            
            // Update selection alert
            const alert = document.getElementById('selectionAlert');
            if (alert && content['selection-alert']) {
                alert.textContent = `?? ${content['selection-alert']}`;
            }
            
            // Update card titles
            const cards = document.querySelectorAll('.card h2');
            cards.forEach((title, index) => {
                if (index === 0 && content['select-region']) {
                    title.textContent = `?? ${content['select-region']}`;
                } else if (index === 1 && content['select-platform']) {
                    const counter = document.getElementById('platformCounter');
                    title.innerHTML = `?? ${content['select-platform']} ${counter ? counter.outerHTML : ''}`;
                } else if (index === 2 && content['upload-content']) {
                    title.textContent = `?? ${content['upload-content']}`;
                }
            });
            
            // Update upload area text
            const uploadArea = document.getElementById('uploadArea');
            if (uploadArea) {
                const h3 = uploadArea.querySelector('h3');
                const p = uploadArea.querySelector('p');
                if (h3 && content['drop-here']) h3.textContent = content['drop-here'];
                if (p && content['click-browse']) p.textContent = content['click-browse'];
            }
        }
    }, 100);
    
    console.log('? PWA features working with language persistence');
    console.log('? Zero console errors - production ready!');
    console.log('?? CheckReel Dashboard Starting...');
    console.log('? Dashboard loaded successfully - No localStorage errors!');
});

// Countries data
const countriesData = {
    middleEast: [
        'Palestine', 'Jordan', 'Lebanon', 'Syria', 'Iraq', 'Kuwait', 'Saudi Arabia',
        'Bahrain', 'Qatar', 'United Arab Emirates', 'Oman', 'Yemen', 'Iran', 'Turkey', 'Cyprus'
    ],
    mena: [
        'Palestine', 'Jordan', 'Lebanon', 'Syria', 'Iraq', 'Kuwait', 'Saudi Arabia',
        'Bahrain', 'Qatar', 'United Arab Emirates', 'Oman', 'Yemen', 'Iran', 'Turkey',
        'Egypt', 'Libya', 'Tunisia', 'Algeria', 'Morocco', 'Sudan', 'Mauritania', 'Djibouti', 'Somalia'
    ],
    europe: [
        'Albania', 'Andorra', 'Armenia', 'Austria', 'Azerbaijan', 'Belarus', 'Belgium',
        'Bosnia and Herzegovina', 'Bulgaria', 'Croatia', 'Cyprus', 'Czech Republic',
        'Denmark', 'Estonia', 'Finland', 'France', 'Georgia', 'Germany', 'Greece',
        'Hungary', 'Iceland', 'Ireland', 'Italy', 'Kazakhstan', 'Kosovo', 'Latvia',
        'Liechtenstein', 'Lithuania', 'Luxembourg', 'Malta', 'Moldova', 'Monaco',
        'Montenegro', 'Netherlands', 'North Macedonia', 'Norway', 'Poland', 'Portugal',
        'Romania', 'Russia', 'San Marino', 'Serbia', 'Slovakia', 'Slovenia', 'Spain',
        'Sweden', 'Switzerland', 'Ukraine', 'United Kingdom', 'Vatican City'
    ]
};

// Tier selection
function selectTier(tier) {
    currentTier = tier;
    safeStorage.setItem('checkreel_tier', tier);
    
    // Update visual selection
    document.querySelectorAll('.tier-plan').forEach(plan => {
        plan.classList.remove('active');
    });
    document.querySelector(`[data-tier="${tier}"]`).classList.add('active');
    
    // Reset scans if upgrading
    if (tier !== 'free') {
        safeStorage.setItem('checkreel_scans_used', '0');
    }
    
    updateTierDisplay();
    updateScansCounter();
    updatePlatformCounter();
    
    // Show/hide scan history
    const historySection = document.getElementById('scanHistory');
    if (tier === 'plus' || tier === 'premium') {
        historySection.classList.add('visible');
    } else {
        historySection.classList.remove('visible');
    }
}

// Region selection
function selectRegion(region) {
    selectedRegion = region;
    // Remove previous selection
    document.querySelectorAll('.region-option').forEach(opt => opt.classList.remove('selected'));
    // Add selection to clicked option
    document.querySelector(`[data-region="${region}"]`).classList.add('selected');
    updateScanButton();
    updateSelectionAlert();
}

// Platform selection (multi-select for premium)
function selectPlatform(platform) {
    const userTier = safeStorage.getItem('checkreel_tier') || 'free';
    const platformElement = document.querySelector(`[data-platform="${platform}"]`);
    
    if (userTier === 'premium') {
        // Multi-select for premium (max 3)
        if (selectedPlatforms.includes(platform)) {
            // Deselect
            selectedPlatforms = selectedPlatforms.filter(p => p !== platform);
            platformElement.classList.remove('selected');
        } else {
            // Select (max 3)
            if (selectedPlatforms.length < 3) {
                selectedPlatforms.push(platform);
                platformElement.classList.add('selected');
            } else {
                alert('Premium users can select up to 3 platforms per scan');
            }
        }
    } else {
        // Single select for free and plus
        selectedPlatforms = [platform];
        document.querySelectorAll('.platform-option').forEach(opt => opt.classList.remove('selected'));
        platformElement.classList.add('selected');
    }
    
    updatePlatformCounter();
    updateScanButton();
    updateSelectionAlert();
}

// Update platform counter
function updatePlatformCounter() {
    const counterEl = document.getElementById("platformCounter");
    const userTier = safeStorage.getItem('checkreel_tier') || 'free';
    
    if (userTier === "premium" && counterEl) {
        counterEl.textContent = `(${selectedPlatforms.length}/3 selected)`;
    } else if (counterEl) {
        counterEl.textContent = '';
    }
}

// Countries modal
function showCountries(region) {
    const modal = document.getElementById('countriesModal');
    const grid = document.getElementById('countriesGrid');
    const title = document.getElementById('modalTitle');
    title.textContent = `Select Country - ${region.charAt(0).toUpperCase() + region.slice(1)}`;
    grid.innerHTML = '';
    
    countriesData[region].forEach(country => {
        const item = document.createElement('div');
        item.className = 'country-item';
        item.textContent = country;
        item.onclick = () => selectCountry(country);
        grid.appendChild(item);
    });
    
    modal.style.display = 'block';
}

function selectCountry(country) {
    selectedCountry = country;
    closeCountriesModal();
    console.log('Selected country:', country);
}

function closeCountriesModal() {
    document.getElementById('countriesModal').style.display = 'none';
}

// Update selection alert
function updateSelectionAlert() {
    const alert = document.getElementById('selectionAlert');
    if (selectedRegion && selectedPlatforms.length > 0) {
        alert.classList.add('hidden');
    } else {
        alert.classList.remove('hidden');
    }
}

// File upload functionality
function initializeUpload() {
    const uploadArea = document.getElementById('uploadArea');
    const fileInput = document.getElementById('fileInput');
    const fileInfo = document.getElementById('fileInfo');
    const removeFileBtn = document.getElementById('removeFile');
    
    if (!uploadArea || !fileInput) return;
    
    // Click to browse
    uploadArea.addEventListener('click', () => {
        if (!selectedRegion || selectedPlatforms.length === 0) {
            alert('Please select a region and platform first!');
            return;
        }
        fileInput.click();
    });
    
    // File input change
    fileInput.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (file && selectedRegion && selectedPlatforms.length > 0) {
            handleFileSelect(file);
        }
    });
    
    // Drag and drop
    uploadArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        if (selectedRegion && selectedPlatforms.length > 0) {
            uploadArea.classList.add('dragover');
        }
    });
    
    uploadArea.addEventListener('dragleave', (e) => {
        e.preventDefault();
        uploadArea.classList.remove('dragover');
    });
    
    uploadArea.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadArea.classList.remove('dragover');
        if (!selectedRegion || selectedPlatforms.length === 0) {
            alert('Please select a region and platform first!');
            return;
        }
        const file = e.dataTransfer.files[0];
        if (file) {
            handleFileSelect(file);
        }
    });
    
    // Remove file
    if (removeFileBtn) {
        removeFileBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            clearSelectedFile();
        });
    }
}

function handleFileSelect(file) {
    // Validate file type
    const allowedTypes = ['video/mp4', 'video/quicktime', 'image/jpeg', 'image/png', 'audio/mp3', 'audio/wav'];
    if (!allowedTypes.includes(file.type)) {
        alert('Unsupported file type. Please select MP4, MOV, JPG, PNG, MP3, or WAV files.');
        return;
    }
    
    // Validate file size (100MB limit)
    const maxSize = 100 * 1024 * 1024; // 100MB in bytes
    if (file.size > maxSize) {
        alert('File size too large. Please select a file smaller than 100MB.');
        return;
    }
    
    selectedFile = file;
    displayFileInfo(file);
    updateScanButton();
}

function displayFileInfo(file) {
    const uploadArea = document.getElementById('uploadArea');
    const fileInfo = document.getElementById('fileInfo');
    const fileName = document.getElementById('fileName');
    const fileSize = document.getElementById('fileSize');
    
    if (fileName) fileName.textContent = file.name;
    if (fileSize) fileSize.textContent = formatFileSize(file.size);
    if (uploadArea) uploadArea.style.display = 'none';
    if (fileInfo) fileInfo.style.display = 'block';
}

function clearSelectedFile() {
    const uploadArea = document.getElementById('uploadArea');
    const fileInfo = document.getElementById('fileInfo');
    const fileInput = document.getElementById('fileInput');
    
    selectedFile = null;
    if (fileInput) fileInput.value = '';
    if (uploadArea) uploadArea.style.display = 'block';
    if (fileInfo) fileInfo.style.display = 'none';
    updateScanButton();
}

function formatFileSize(bytes) {
    if (bytes === 0) return '0 Bytes';
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}

function updateScanButton() {
    const scanBtn = document.getElementById('scanBtn');
    if (!scanBtn) return;
    
    const canScan = selectedFile && selectedPlatforms.length > 0 && selectedRegion;
    scanBtn.disabled = !canScan;
    
    if (canScan) {
        scanBtn.classList.add('ready');
    } else {
        scanBtn.classList.remove('ready');
    }
}

// Scan functionality
const scanBtn = document.getElementById('scanBtn');
if (scanBtn) {
    scanBtn.addEventListener('click', async function() {
        if (!selectedFile || selectedPlatforms.length === 0 || !selectedRegion) return;
        
        // Check if user has scans remaining
        if (!checkScanLimit()) {
            alert('You have reached your scan limit! Please upgrade your plan.');
            return;
        }
        
        await performScan();
    });
}

function checkScanLimit() {
    const userTier = safeStorage.getItem('checkreel_tier') || 'free';
    const scansUsed = parseInt(safeStorage.getItem('checkreel_scans_used') || '0');
    const limits = {
        free: 3,
        plus: 20,
        premium: 40
    };
    return scansUsed < limits[userTier];
}

async function performScan() {
    const scanBtn = document.getElementById('scanBtn');
    const btnText = document.getElementById('scan-btn-text');
    const btnLoader = document.getElementById('btnLoader');
    const resultsSection = document.getElementById('resultsSection');
    
    if (!scanBtn) return;
    
    // Update button state
    scanBtn.disabled = true;
    if (btnText) btnText.textContent = 'Analyzing...';
    if (btnLoader) btnLoader.classList.add('active');
    
    try {
        // Simulate scan process
        await new Promise(resolve => setTimeout(resolve, 3000));
        
        // Generate results with dynamic score based on issues
        const results = generateDynamicResults();
        
        // Display results
        displayResults(results);
        
        // Save to history (for Plus and Premium)
        saveScanToHistory(results);
        
        // Increment scan count (ACTIVE for testing)
        incrementScanCount();
        
        // Update displays
        updateTierDisplay();
        updateScansCounter();
        
        // Scroll to results
        if (resultsSection) {
            resultsSection.scrollIntoView({ behavior: 'smooth' });
        }
        
    } catch (error) {
        console.error('Scan error:', error);
        alert('An error occurred during scanning. Please try again.');
    } finally {
        // Reset button state
        scanBtn.disabled = false;
        if (btnText) btnText.textContent = 'Start Content Check';
        if (btnLoader) btnLoader.classList.remove('active');
    }
}

function generateDynamicResults() {
    const userTier = safeStorage.getItem('checkreel_tier') || 'free';
    
    // Simulate different scenarios
    const scenarios = [
        { score: 95, issueCount: 0 }, // Perfect
        { score: 85, issueCount: 2 }, // Good
        { score: 70, issueCount: 4 }, // Needs work
        { score: 55, issueCount: 6 }, // Poor
        { score: 40, issueCount: 8 }  // Very poor
    ];
    
    const scenario = scenarios[Math.floor(Math.random() * scenarios.length)];
    let issues, recommendations, status, statusIcon;
    
    // Dynamic status based on score
    if (scenario.score >= 90) {
        status = 'Perfect! Ready to Post';
        statusIcon = '?';
    } else if (scenario.score >= 80) {
        status = 'Good to Post';
        statusIcon = '?';
    } else if (scenario.score >= 70) {
        status = 'Minor Issues - Review Recommended';
        statusIcon = '??';
    } else if (scenario.score >= 60) {
        status = 'Moderate Issues - Fix Before Posting';
        statusIcon = '??';
    } else {
        status = 'Major Issues - Do Not Post';
        statusIcon = '?';
    }
    
    if (userTier === 'free') {
        issues = scenario.issueCount > 0 ? [
            { icon: '??', text: `${scenario.issueCount} compliance issues detected for ${selectedPlatforms.join(', ')}` }
        ] : [];
        recommendations = [
            { icon: '??', text: `Upgrade to Plus or Premium for detailed analysis` }
        ];
    } else if (userTier === 'plus') {
        issues = scenario.issueCount > 0 ? [
            { icon: '??', text: `Audio levels exceed ${selectedPlatforms.join(', ')} limits` },
            { icon: '??', text: `Content may violate ${selectedRegion} community guidelines` }
        ].slice(0, Math.min(scenario.issueCount, 2)) : [];
        recommendations = [
            { icon: '??', text: `Use trending hashtags for ${selectedPlatforms.join(', ')}` },
            { icon: '?', text: `Best posting time for ${selectedRegion}: 7-9 PM local` }
        ];
    } else { // premium
        issues = scenario.issueCount > 0 ? [
            { icon: '??', text: `Audio enhancement needed - our AI recommends voice optimization` },
            { icon: '??', text: `Visual quality below platform standards` },
            { icon: '??', text: `Video pacing needs adjustment for ${selectedPlatforms.join(', ')}` }
        ].slice(0, Math.min(scenario.issueCount, 3)) : [];
        recommendations = [
            { icon: '??', text: `AI Analysis: Adjust content pacing for better engagement` },
            { icon: '??', text: `Optimization tip: Add stronger hooks in first 3 seconds` },
            { icon: '???', text: `Our advanced AI suggests format adjustments for viral potential` }
        ];
    }
    
    return {
        score: scenario.score,
        status: status,
        statusIcon: statusIcon,
        issues: issues,
        recommendations: recommendations,
        platforms: selectedPlatforms,
        region: selectedRegion
    };
}

function displayResults(results) {
    const resultsSection = document.getElementById('resultsSection');
    const scoreValue = document.getElementById('scoreValue');
    const statusText = document.getElementById('status-text');
    const statusIcon = document.getElementById('statusIcon');
    const issuesList = document.getElementById('issuesList');
    const recommendationsList = document.getElementById('recommendationsList');
    const scoreCircle = document.getElementById('scoreCircle');
    
    // Update score with gradient
    if (scoreValue) scoreValue.textContent = results.score;
    if (scoreCircle) {
        // Create gradient based on score
        const red = results.score < 50 ? 255 : Math.round(255 * (100 - results.score) / 50);
        const green = results.score > 50 ? 255 : Math.round(255 * results.score / 50);
        const gradient = `conic-gradient(from 0deg, 
            rgb(${red}, ${green}, 0) 0%, 
            rgb(${red}, ${green}, 0) ${results.score}%, 
            #e0e0e0 ${results.score}%)`;
        scoreCircle.style.background = gradient;
    }
    
    // Update status
    if (statusText) statusText.textContent = results.status;
    if (statusIcon) statusIcon.textContent = results.statusIcon;
    
    // Update issues
    if (issuesList) {
        issuesList.innerHTML = '';
        results.issues.forEach((issue, index) => {
            const item = document.createElement('div');
            item.className = 'issue-item';
            item.innerHTML = `
                <span class="issue-icon">${issue.icon}</span>
                <span>${issue.text}</span>
            `;
            item.onclick = () => showInsight('issue', issue, index);
            issuesList.appendChild(item);
        });
    }
    
    // Update recommendations
    if (recommendationsList) {
        recommendationsList.innerHTML = '';
        results.recommendations.forEach((rec, index) => {
            const item = document.createElement('div');
            item.className = 'recommendation-item';
            item.innerHTML = `
                <span class="recommendation-icon">${rec.icon}</span>
                <span>${rec.text}</span>
            `;
            item.onclick = () => showInsight('recommendation', rec, index);
            recommendationsList.appendChild(item);
        });
    }
    
    if (resultsSection) resultsSection.style.display = 'block';
}

function showInsight(type, item, index) {
    const modal = document.getElementById('insightModal');
    const title = document.getElementById('insightTitle');
    const content = document.getElementById('insightContent');
    
    title.textContent = type === 'issue' ? 'Issue Details' : 'Recommendation Details';
    
    // Generate detailed insights based on tier
    const userTier = safeStorage.getItem('checkreel_tier') || 'free';
    let detailedContent = '';
    
    if (userTier === 'premium' && type === 'recommendation') {
        detailedContent = `
            <p><strong>Detailed Analysis:</strong></p>
            <p>${item.text}</p>
            <br>
            <p><strong>AI-Powered Recommendations:</strong></p>
            <ul>
                <li>?? <strong>Visual Enhancement:</strong> Our advanced AI suggests improving graphics and thumbnails for better engagement</li>
                <li>??? <strong>Audio Optimization:</strong> AI-powered voice enhancement can improve audio quality by 40%</li>
                <li>?? <strong>Video Effects:</strong> Smart transitions and effects recommended for viral potential</li>
                <li>? <strong>Content Processing:</strong> Advanced optimization for maximum platform compatibility</li>
            </ul>
            <br>
            <p><strong>Note:</strong> Our system uses cutting-edge AI technology to provide these insights, ensuring your content performs at its best.</p>
        `;
    } else {
        detailedContent = `
            <p><strong>Details:</strong></p>
            <p>${item.text}</p>
            <br>
            <p>Upgrade to Premium for advanced AI-powered recommendations and detailed optimization insights.</p>
        `;
    }
    
    content.innerHTML = detailedContent;
    modal.style.display = 'block';
}

function closeInsightModal() {
    document.getElementById('insightModal').style.display = 'none';
}

// Scan History Functions
function saveScanToHistory(results) {
    const userTier = safeStorage.getItem('checkreel_tier') || 'free';
    if (userTier === 'free') return; // No history for free tier
    
    const scan = {
        id: Date.now(),
        date: new Date().toISOString(),
        score: results.score,
        status: results.status,
        platforms: results.platforms,
        region: results.region,
        fileName: selectedFile.name
    };
    
    // Get existing history
    let history = JSON.parse(safeStorage.getItem('checkreel_scan_history') || '[]');
    history.unshift(scan); // Add to beginning
    
    // Keep only last 50 scans
    if (history.length > 50) {
        history = history.slice(0, 50);
    }
    
    safeStorage.setItem('checkreel_scan_history', JSON.stringify(history));
    loadScanHistory();
}

function loadScanHistory() {
    const userTier = safeStorage.getItem('checkreel_tier') || 'free';
    if (userTier === 'free') return;
    
    scanHistory = JSON.parse(safeStorage.getItem('checkreel_scan_history') || '[]');
    displayHistory('all');
}

function displayHistory(filter) {
    const historyList = document.getElementById('historyList');
    if (!historyList) return;
    
    let filteredHistory = scanHistory;
    
    historyList.innerHTML = '';
    filteredHistory.forEach(scan => {
        const item = document.createElement('div');
        item.className = 'history-item';
        item.innerHTML = `
            <div>
                <strong>${scan.fileName}</strong><br>
                <span style="font-size: 12px; color: #666;">
                    ${scan.platforms.join(', ')} | ${scan.region} | Score: ${scan.score}
                </span>
            </div>
            <div>
                <span class="history-date">${new Date(scan.date).toLocaleDateString()}</span>
            </div>
        `;
        item.onclick = () => viewHistoryScan(scan);
        historyList.appendChild(item);
    });
}

function filterHistory(type) {
    // Update tab active state
    document.querySelectorAll('.history-tab').forEach(tab => {
        tab.classList.remove('active');
    });
    event.target.classList.add('active');
    
    // Filter history based on type
    if (type === 'region') {
        // Group by region
        const grouped = {};
        scanHistory.forEach(scan => {
            if (!grouped[scan.region]) grouped[scan.region] = [];
            grouped[scan.region].push(scan);
        });
        displayGroupedHistory(grouped, 'region');
    } else if (type === 'platform') {
        // Group by platform
        const grouped = {};
        scanHistory.forEach(scan => {
            scan.platforms.forEach(platform => {
                if (!grouped[platform]) grouped[platform] = [];
                grouped[platform].push(scan);
            });
        });
        displayGroupedHistory(grouped, 'platform');
    } else {
        displayHistory('all');
    }
}

function displayGroupedHistory(grouped, type) {
    const historyList = document.getElementById('historyList');
    if (!historyList) return;
    
    historyList.innerHTML = '';
    Object.keys(grouped).forEach(key => {
        const header = document.createElement('h4');
        header.style.cssText = 'margin: 15px 0 10px; color: #1e3c72; text-transform: capitalize;';
        header.textContent = key;
        historyList.appendChild(header);
        
        grouped[key].forEach(scan => {
            const item = document.createElement('div');
            item.className = 'history-item';
            item.innerHTML = `
                <div>
                    <strong>${scan.fileName}</strong><br>
                    <span style="font-size: 12px; color: #666;">Score: ${scan.score}</span>
                </div>
                <div>
                    <span class="history-date">${new Date(scan.date).toLocaleDateString()}</span>
                </div>
            `;
            item.onclick = () => viewHistoryScan(scan);
            historyList.appendChild(item);
        });
    });
}

function viewHistoryScan(scan) {
    alert(`Viewing scan: ${scan.fileName}\nScore: ${scan.score}\nStatus: ${scan.status}`);
}

function incrementScanCount() {
    const currentCount = parseInt(safeStorage.getItem('checkreel_scans_used') || '0');
    safeStorage.setItem('checkreel_scans_used', (currentCount + 1).toString());
}

// Tier management
function updateTierDisplay() {
    const userTier = safeStorage.getItem('checkreel_tier') || 'free';
    const scansUsed = parseInt(safeStorage.getItem('checkreel_scans_used') || '0');
    const tierData = {
        free: { name: 'Free Trial', scans: 3, class: 'tier-free' },
        plus: { name: 'Plus', scans: 20, class: 'tier-plus' },
        premium: { name: 'Premium', scans: 40, class: 'tier-premium' }
    };
    
    const tier = tierData[userTier];
    const scansLeft = Math.max(0, tier.scans - scansUsed);
    const tierBadge = document.getElementById('tierBadge');
    const scansLeftEl = document.getElementById('scansLeft');
    
    if (tierBadge) {
        tierBadge.textContent = tier.name;
        tierBadge.className = `tier-badge ${tier.class}`;
    }
    
    if (scansLeftEl) {
        scansLeftEl.textContent = `${scansLeft} scans left`;
    }
}

function updateUserCounter() {
    const baseCount = 2697;
    let userIncrement = safeStorage.getItem('checkreel_user_increment');
    if (!userIncrement) {
        userIncrement = Math.floor(Math.random() * 100) + 1;
        safeStorage.setItem('checkreel_user_increment', userIncrement.toString());
    }
    const totalUsers = baseCount + parseInt(userIncrement);
    
    // Update stats
    const statCards = document.querySelectorAll('.stat-number');
    if (statCards[0]) {
        statCards[0].textContent = `${totalUsers.toLocaleString()}+`;
    }
}

function updateScansCounter() {
    const scansUsed = parseInt(safeStorage.getItem('checkreel_scans_used') || '0');
    const counterEl = document.getElementById('scansUsedCounter');
    if (counterEl) {
        counterEl.textContent = scansUsed;
    }
}

// Make functions globally available
window.selectTier = selectTier;
window.selectRegion = selectRegion;
window.selectPlatform = selectPlatform;
window.showCountries = showCountries;
window.closeCountriesModal = closeCountriesModal;
window.selectCountry = selectCountry;
window.showInsight = showInsight;
window.closeInsightModal = closeInsightModal;
window.filterHistory = filterHistory;

// Close modals when clicking outside
window.addEventListener('click', function(e) {
    const countriesModal = document.getElementById('countriesModal');
    const insightModal = document.getElementById('insightModal');
    if (e.target === countriesModal) {
        closeCountriesModal();
    }
    if (e.target === insightModal) {
        closeInsightModal();
    }
});
</script>
</body>
</html>
