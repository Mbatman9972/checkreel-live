label reports<br>API access<br>Dedicated support',
        'selection-alert': 'Please select a region and platform before uploading content for analysis',
        'select-region': '🌍 Select Region',
        'select-platform': '📱 Select Target Platform',
        'upload-content': ' Upload Content to Check',
        'drop-here': 'Drop your content here',
        'click-browse': 'or click to browse files',
        'start-check': 'Start Content Check',
        'analyzing': 'Analyzing...',
        'scan-history-title': 'Scan History',
        'all-scans': 'All Scans',
        'by-region': 'By Region',
        'by-platform': 'By Platform',
        'compliance-report': 'Compliance Report',
        'issues-found': 'Issues Found',
        'recommendations': 'Recommendations',
        'active-users': 'Active Users',
        'content-scanned': 'Content Scanned',
        'success-rate': 'Success Rate',
        'platforms': 'Platforms',
        'scans-used': 'Scans Used (Testing)',
        'scans-left': 'scans left',
        'recommended': 'RECOMMENDED',
        'middle-east': 'Middle East',
        'global': 'Global',
        'europe': 'Europe',
        'mena': 'MENA',
        'tiktok': 'TikTok',
        'youtube': 'YouTube',
        'instagram': 'Instagram',
        'facebook': 'Facebook',
        'twitter': 'Twitter',
        'snapchat': 'Snapchat',
        'score': 'Score',
        'majorIssues': 'Major Issues - Do Not Post',
        'minorIssues': 'Minor Issues - Review Recommended',
        'noIssues': 'Perfect! Ready to Post',
        'useTrendingHashtags': 'Use trending hashtags for {platform}',
        'bestPostingTime': 'Best posting time for {region}: 7-9 PM local',
        'audioLevelsExceed': 'Audio levels exceed {platform} limits',
        'contentViolateGuidelines': 'Content may violate {region} community guidelines'
    },
    fr: {
        'choose-plan': 'Choisissez votre plan',
        'free-trial': 'Essai gratuit',
        'plus-tier': 'Plus',
        'premium-tier': 'Premium',
        'per-month': 'mois',
        'free-scans': '3 analyses',
        'plus-scans': '20 analyses/mois',
        'premium-scans': '40 analyses/mois',
        'free-features': 'Vérification de conformité de base<br>Résultats standards',
        'plus-features': 'Vérification de conformité améliorée<br>Informations détaillées<br>Historique des analyses<br>Support prioritaire',
        'premium-features': 'Suite de conformité complète<br>Analyses avancées<br>Fonctionnalités d\'équipe<br>Rapports en marque blanche<br>Accès API<br>Support dédié',
        'selection-alert': 'Veuillez sélectionner une région et une plateforme avant de télécharger le contenu pour analyse',
        'select-region': ' Sélectionner la région',
        'select-platform': ' Sélectionner la plateforme cible',
        'upload-content': ' Télécharger le contenu à vérifier',
        'drop-here': 'Déposez votre contenu ici',
        'click-browse': 'ou cliquez pour parcourir les fichiers',
        'start-check': 'Commencer la vérification du contenu',
        'analyzing': 'Analyse en cours...',
        'scan-history-title': 'Historique des analyses',
        'all-scans': 'Toutes les analyses',
        'by-region': 'Par région',
        'by-platform': 'Par plateforme',
        'compliance-report': 'Rapport de conformité',
        'issues-found': 'Problèmes trouvés',
        'recommendations': 'Recommandations',
        'active-users': 'Utilisateurs actifs',
        'content-scanned': 'Contenu analysé',
        'success-rate': 'Taux de réussite',
        'platforms': 'Plateformes',
        'scans-used': 'Analyses utilisées (Test)',
        'scans-left': 'analyses restantes',
        'recommended': 'RECOMMANDÉ',
        'middle-east': 'Moyen-Orient',
        'global': 'Global',
        'europe': 'Europe',
        'mena': 'MENA',
        'tiktok': 'TikTok',
        'youtube': 'YouTube',
        'instagram': 'Instagram',
        'facebook': 'Facebook',
        'twitter': 'Twitter',
        'snapchat': 'Snapchat',
        'score': 'Score',
        'majorIssues': 'Problèmes majeurs - Ne pas publier',
        'minorIssues': 'Problèmes mineurs - Révision recommandée',
        'noIssues': 'Parfait! Prêt à publier',
        'useTrendingHashtags': 'Utilisez des hashtags tendance pour {platform}',
        'bestPostingTime': 'Meilleur moment pour publier au {region}: 19h-21h heure locale',
        'audioLevelsExceed': 'Les niveaux audio dépassent les limites {platform}',
        'contentViolateGuidelines': 'Le contenu peut violer les directives communautaires du {region}'
    },
    ar: {
        'choose-plan': 'اختر خطتك',
        'free-trial': 'تجربة مجانية',
        'plus-tier': 'بلس',
        'premium-tier': 'بريميوم',
        'per-month': 'شهر',
        'free-scans': '3 فحوصات',
        'plus-scans': '20 فحص/شهر',
        'premium-scans': '40 فحص/شهر',
        'free-features': 'فحص امتثال أساسي<br>نتائج قياسية',
        'plus-features': 'فحص امتثال محسّن<br>رؤى مفصلة<br>سجل الفحوصات<br>دعم ذو أولوية',
        'premium-features': 'مجموعة امتثال كاملة<br>تحليلات متقدمة<br>ميزات الفريق<br>تقارير بعلامة تجارية خاصة<br>الوصول إلى API<br>دعم مخصص',
        'selection-alert': 'يرجى اختيار منطقة ومنصة قبل تحميل المحتوى للتحليل',
        'select-region': ' اختر المنطقة',
        'select-platform': ' اختر المنصة المستهدفة',
        'upload-content': ' ارفع المحتوى للفحص',
        'drop-here': 'اسقط محتواك هنا',
        'click-browse': 'أو انقر لاستعراض الملفات',
        'start-check': 'ابدأ فحص المحتوى',
        'analyzing': 'جاري التحليل...',
        'scan-history-title': 'سجل الفحوصات',
        'all-scans': 'جميع الفحوصات',
        'by-region': 'حسب المنطقة',
        'by-platform': 'حسب المنصة',
        'compliance-report': 'تقرير الامتثال',
        'issues-found': 'المشاكل المكتشفة',
        'recommendations': 'التوصيات',
        'active-users': 'المستخدمون النشطون',
        'content-scanned': 'المحتوى المفحوص',
        'success-rate': 'معدل النجاح',
        'platforms': 'المنصات',
        'scans-used': 'الفحوصات المستخدمة (اختبار)',
        'scans-left': 'فحوصات متبقية',
        'recommended': 'موصى به',
        'middle-east': 'الشرق الأوسط',
        'global': 'عالمي',
        'europe': 'أوروبا',
        'mena': 'منطقة الشرق الأوسط وشمال أفريقيا',
        'tiktok': 'تيك توك',
        'youtube': 'يوتيوب',
        'instagram': 'إنستغرام',
        'facebook': 'فيسبوك',
        'twitter': 'تويتر',
        'snapchat': 'سناب شات',
        'score': 'النتيجة',
        'majorIssues': 'مشاكل كبيرة - لا تنشر',
        'minorIssues': 'مشاكل بسيطة - يُنصح بالمراجعة',
        'noIssues': 'مثالي! جاهز للنشر',
        'useTrendingHashtags': 'استخدم الهاشتاجات الرائجة لـ {platform}',
        'bestPostingTime': 'أفضل وقت للنشر في {region}: 7-9 مساءً بالتوقيت المحلي',
        'audioLevelsExceed': 'مستويات الصوت تتجاوز حدود {platform}',
        'contentViolateGuidelines': 'قد يخالف المحتوى إرشادات مجتمع {region}'
    }
};

// Language switching function
function setLanguage(lang) {
    currentLanguage = lang;
    
    // Update language buttons
    document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.classList.toggle('active', btn.textContent === lang.toUpperCase());
    });
    
    // Update RTL for Arabic
    if (lang === 'ar') {
        document.body.setAttribute('dir', 'rtl');
        document.documentElement.setAttribute('dir', 'rtl');
    } else {
        document.body.removeAttribute('dir');
        document.documentElement.removeAttribute('dir');
    }
    
    // Apply all translations
    applyDashboardTranslations(lang);
    
    // Save language preference
    safeStorage.setItem('checkreel_language', lang);
}

// Get translation with placeholder replacement
function getTranslation(key, placeholders = {}) {
    const translations = DASHBOARD_TRANSLATIONS[currentLanguage] || DASHBOARD_TRANSLATIONS['en'];
    let text = translations[key] || key;
    
    // Replace placeholders
    Object.keys(placeholders).forEach(placeholder => {
        text = text.replace(`{${placeholder}}`, placeholders[placeholder]);
    });
    
    return text;
}

// Apply dashboard translations
function applyDashboardTranslations(lang) {
    const translations = DASHBOARD_TRANSLATIONS[lang] || DASHBOARD_TRANSLATIONS['en'];
    
    Object.keys(translations).forEach(key => {
        const element = document.getElementById(key);
        if (element) {
            if (key.includes('features')) {
                element.innerHTML = translations[key];
            } else {
                element.textContent = translations[key];
            }
        }
    });
    
    // Update scan history platform/region tags
    updateScanHistoryTranslations();
    updateTierDisplay();
}

// Update scan history translations
function updateScanHistoryTranslations() {
    document.querySelectorAll('[data-translate]').forEach(element => {
        const key = element.getAttribute('data-translate');
        if (key === 'score') {
            const scoreMatch = element.textContent.match(/Score: (\d+)/);
            if (scoreMatch) {
                element.textContent = `${getTranslation('score')}: ${scoreMatch[1]}`;
            }
        } else {
            element.textContent = getTranslation(key);
        }
    });
}

// Initialize dashboard with language persistence
document.addEventListener('DOMContentLoaded', function() {
    currentLanguage = safeStorage.getItem('checkreel_language') || 'en';
    
    if (window.loadLanguageContent) {
        window.loadLanguageContent(currentLanguage);
    }
    
    setTimeout(() => {
        applyDashboardTranslations(currentLanguage);
        
        if (currentLanguage === 'ar') {
            document.body.setAttribute('dir', 'rtl');
            document.documentElement.setAttribute('dir', 'rtl');
        } else {
            document.body.removeAttribute('dir');
            document.documentElement.removeAttribute('dir');
        }
        
        // Update language button states
        document.querySelectorAll('.lang-btn').forEach(btn => {
            btn.classList.toggle('active', btn.textContent === currentLanguage.toUpperCase());
        });
    }, 100);
    
    initializeUpload();
    updateTierDisplay();
    updateUserCounter();
    updateScansCounter();
    loadScanHistory();
});

// Add all your existing functions here...
function selectTier(tier) {
    currentTier = tier;
    safeStorage.setItem('checkreel_tier', tier);
    
    document.querySelectorAll('.tier-plan').forEach(plan => {
        plan.classList.remove('active');
    });
    document.querySelector(`[data-tier="${tier}"]`).classList.add('active');
    
    if (tier !== 'free') {
        safeStorage.setItem('checkreel_scans_used', '0');
    }
    
    updateTierDisplay();
    updateScansCounter();
    updatePlatformCounter();
    
    const historySection = document.getElementById('scanHistory');
    if (tier === 'plus' || tier === 'premium') {
        historySection.classList.add('visible');
    } else {
        historySection.classList.remove('visible');
    }
}

function selectRegion(region) {
    selectedRegion = region;
    document.querySelectorAll('.region-option').forEach(opt => opt.classList.remove('selected'));
    document.querySelector(`[data-region="${region}"]`).classList.add('selected');
    updateScanButton();
    updateSelectionAlert();
}

function selectPlatform(platform) {
    const userTier = safeStorage.getItem('checkreel_tier') || 'free';
    const platformElement = document.querySelector(`[data-platform="${platform}"]`);
    
    if (userTier === 'premium') {
        if (selectedPlatforms.includes(platform)) {
            selectedPlatforms = selectedPlatforms.filter(p => p !== platform);
            platformElement.classList.remove('selected');
        } else {
            if (selectedPlatforms.length < 3) {
                selectedPlatforms.push(platform);
                platformElement.classList.add('selected');
            } else {
                alert('Premium users can select up to 3 platforms per scan');
            }
        }
    } else {
        selectedPlatforms = [platform];
        document.querySelectorAll('.platform-option').forEach(opt => opt.classList.remove('selected'));
        platformElement.classList.add('selected');
    }
    
    updatePlatformCounter();
    updateScanButton();
    updateSelectionAlert();
}

function updatePlatformCounter() {
    const counterEl = document.getElementById("platformCounter");
    const userTier = safeStorage.getItem('checkreel_tier') || 'free';
    
    if (userTier === "premium" && counterEl) {
        counterEl.textContent = `(${selectedPlatforms.length}/3 selected)`;
    } else if (counterEl) {
        counterEl.textContent = '';
    }
}

function updateSelectionAlert() {
    const alert = document.getElementById('selectionAlert');
    if (selectedRegion && selectedPlatforms.length > 0) {
        alert.classList.add('hidden');
    } else {
        alert.classList.remove('hidden');
    }
}

function initializeUpload() {
    const uploadArea = document.getElementById('uploadArea');
    const fileInput = document.getElementById('fileInput');
    const fileInfo = document.getElementById('fileInfo');
    const removeFileBtn = document.getElementById('removeFile');
    
    if (!uploadArea || !fileInput) return;
    
    uploadArea.addEventListener('click', () => {
        if (!selectedRegion || selectedPlatforms.length === 0) {
            alert(getTranslation('selection-alert'));
            return;
        }
        fileInput.click();
    });
    
    fileInput.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (file && selectedRegion && selectedPlatforms.length > 0) {
            handleFileSelect(file);
        }
    });
    
    uploadArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        if (selectedRegion && selectedPlatforms.length > 0) {
            uploadArea.classList.add('dragover');
        }
    });
    
    uploadArea.addEventListener('dragleave', (e) => {
        e.preventDefault();
        uploadArea.classList.remove('dragover');
    });
    
    uploadArea.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadArea.classList.remove('dragover');
        if (!selectedRegion || selectedPlatforms.length === 0) {
            alert(getTranslation('selection-alert'));
            return;
        }
        const file = e.dataTransfer.files[0];
        if (file) {
            handleFileSelect(file);
        }
    });
    
    if (removeFileBtn) {
        removeFileBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            clearSelectedFile();
        });
    }
}

function handleFileSelect(file) {
    const allowedTypes = ['video/mp4', 'video/quicktime', 'image/jpeg', 'image/png', 'audio/mp3', 'audio/wav'];
    if (!allowedTypes.includes(file.type)) {
        alert('Unsupported file type. Please select MP4, MOV, JPG, PNG, MP3, or WAV files.');
        return;
    }
    
    const maxSize = 100 * 1024 * 1024;
    if (file.size > maxSize) {
        alert('File size too large. Please select a file smaller than 100MB.');
        return;
    }
    
    selectedFile = file;
    displayFileInfo(file);
    updateScanButton();
}

function displayFileInfo(file) {
    const uploadArea = document.getElementById('uploadArea');
    const fileInfo = document.getElementById('fileInfo');
    const fileName = document.getElementById('fileName');
    const fileSize = document.getElementById('fileSize');
    
    if (fileName) fileName.textContent = file.name;
    if (fileSize) fileSize.textContent = formatFileSize(file.size);
    if (uploadArea) uploadArea.style.display = 'none';
    if (fileInfo) fileInfo.style.display = 'block';
}

function clearSelectedFile() {
    const uploadArea = document.getElementById('uploadArea');
    const fileInfo = document.getElementById('fileInfo');
    const fileInput = document.getElementById('fileInput');
    
    selectedFile = null;
    if (fileInput) fileInput.value = '';
    if (uploadArea) uploadArea.style.display = 'block';
    if (fileInfo) fileInfo.style.display = 'none';
    updateScanButton();
}

function formatFileSize(bytes) {
    if (bytes === 0) return '0 Bytes';
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}

function updateScanButton() {
    const scanBtn = document.getElementById('scanBtn');
    if (!scanBtn) return;
    
    const canScan = selectedFile && selectedPlatforms.length > 0 && selectedRegion;
    scanBtn.disabled = !canScan;
    
    if (canScan) {
        scanBtn.classList.add('ready');
    } else {
        scanBtn.classList.remove('ready');
    }
}

function updateTierDisplay() {
    const userTier = safeStorage.getItem('checkreel_tier') || 'free';
    const scansUsed = parseInt(safeStorage.getItem('checkreel_scans_used') || '0');
    const tierBadge = document.getElementById('tierBadge');
    const scansLeft = document.getElementById('scansLeft');
    
    const limits = {
        free: { limit: 3, name: getTranslation('free-trial') },
        plus: { limit: 20, name: getTranslation('plus-tier') },
        premium: { limit: 40, name: getTranslation('premium-tier') }
    };
    
    const tierInfo = limits[userTier];
    const remaining = Math.max(0, tierInfo.limit - scansUsed);
    
    if (tierBadge) {
        tierBadge.textContent = tierInfo.name;
        tierBadge.className = `tier-badge tier-${userTier}`;
    }
    
    if (scansLeft) {
        scansLeft.textContent = `${remaining} ${getTranslation('scans-left')}`;
    }
}

function updateUserCounter() {
    const randomUsers = Math.floor(Math.random() * 500) + 2500;
    const userEl = document.getElementById('statUsers');
    if (userEl) {
        userEl.textContent = randomUsers.toLocaleString();
    }
}

function updateScansCounter() {
    const scansUsed = parseInt(safeStorage.getItem('checkreel_scans_used') || '0');
    const scansEl = document.getElementById('statScansUsed');
    if (scansEl) {
        scansEl.textContent = scansUsed;
    }
}

function loadScanHistory() {
    const savedHistory = safeStorage.getItem('checkreel_scan_history');
    if (savedHistory) {
        try {
            scanHistory = JSON.parse(savedHistory);
        } catch (e) {
            scanHistory = [];
        }
    }
    
    const historyList = document.getElementById('historyList');
    if (historyList && scanHistory.length > 0) {
        historyList.innerHTML = '';
        scanHistory.slice(0, 5).forEach(item => {
            const historyItem = document.createElement('div');
            historyItem.className = 'history-item';
            
            const platformText = item.platforms.map(p => getTranslation(p)).join(', ');
            const regionText = getTranslation(item.region);
            
            historyItem.innerHTML = `
                <div>
                    <div class="file-name">${item.fileName}</div>
                    <div class="history-date">${item.date}</div>
                </div>
                <div>
                    <span class="platform-tag">${platformText}</span> | 
                    <span class="region-tag">${regionText}</span> | 
                    <span class="score-tag">${getTranslation('score')}: ${item.score}</span>
                </div>
            `;
            historyList.appendChild(historyItem);
        });
    }
}

function closeInsightModal() {
    document.getElementById('insightModal').style.display = 'none';
}

// Language change handler - listen for changes from lang-loader.js
window.addEventListener('languageChanged', function(event) {
    currentLanguage = event.detail.language;
    applyDashboardTranslations(currentLanguage);
    
    if (currentLanguage === 'ar') {
        document.body.setAttribute('dir', 'rtl');
        document.documentElement.setAttribute('dir', 'rtl');
    } else {
        document.body.removeAttribute('dir');
        document.documentElement.removeAttribute('dir');
    }
    
    loadScanHistory();
});

console.log(' Dashboard fully loaded with complete multilingual support');
</script>
</body>
</html>
