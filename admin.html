<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CheckReel Admin Control Room</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#667eea">
    <style>
        /* (all original CSS unchanged) */
    </style>
</head>
<body>
    <!-- (all original markup unchanged) -->

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="tier.js"></script>

    <script>
    /* translations object and other JS parts unchanged until initializeCharts */

    // Language translations (unchanged)
    const languages = {
        /* full EN and AR objects as in original */
    };

    // Global variables
    let currentLanguage = 'en';
    let charts = {};
    let liveMode = false;
    let updateInterval;

    document.addEventListener('DOMContentLoaded', function() {
        const savedLanguage = localStorage.getItem('checkReelLanguage') || 'en';
        updateLanguage(savedLanguage);
        initializeCharts();
        initializePWA();
        setupEventListeners();
        startLiveUpdates();
    });

    function setupEventListeners() {
        const languageSelector = document.getElementById('languageSelector');
        if (languageSelector) {                           // guard added
            languageSelector.addEventListener('change', function(e) {
                updateLanguage(e.target.value);
            });
        }

        const controlToggle = document.getElementById('controlToggle');
        if (controlToggle) {
            controlToggle.addEventListener('click', function() {
                toggleLiveMode();
            });
        }

        const tierUpgradeForm = document.getElementById('tierUpgradeForm');
        if (tierUpgradeForm) {
            tierUpgradeForm.addEventListener('submit', handleTierUpgrade);
        }
    }

    /* other functions unchanged until initializeCharts */

    function initializeCharts() {
        if (typeof Chart === 'undefined') {
            setTimeout(initializeCharts, 100);
            return;
        }
        try {
            const revenueCtx = document.getElementById('revenueChart');
            if (revenueCtx) {
                charts.revenue = new Chart(revenueCtx, {
                    type: 'line',
                    data: {
                        labels: ['00:00','04:00','08:00','12:00','16:00','20:00','24:00'],
                        datasets: [{
                            label: 'Revenue ($)',
                            data: [850,920,1100,1247,1180,1320,1400],
                            borderColor: '#4CAF50',
                            backgroundColor: 'rgba(76,175,80,0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4,
                            pointBackgroundColor: '#4CAF50',
                            pointBorderColor: 'white',
                            pointBorderWidth: 2,
                            pointRadius: 6
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            x: {
                                ticks: { color: 'rgba(255,255,255,0.8)' },
                                grid: { color: 'rgba(255,255,255,0.1)' }
                            },
                            y: {
                                ticks: {
                                    color: 'rgba(255,255,255,0.8)',
                                    callback: function(value) {
                                        return '$' + value;   // fixed currency prefix
                                    }
                                },
                                grid: { color: 'rgba(255,255,255,0.1)' }
                            }
                        }
                    }
                });
            }

            /* platformChart and violationsChart original code unchanged */

        } catch (error) {
            console.error('Error initializing charts:', error);
        }
    }

    function updateLiveData() {
        const kpiCards = document.querySelectorAll('.kpi-value');
        kpiCards.forEach(function(card) {
            const currentValue = parseInt(card.textContent.replace(/[^0-9]/g, ''));
            const change = Math.floor(Math.random() * 20) - 10;
            const newValue = Math.max(0, currentValue + change);

            if (card.textContent.includes('$')) {            // fixed condition
                card.textContent = '$' + newValue.toLocaleString(); // fixed assignment
            } else if (card.textContent.includes('%')) {
                card.textContent = (newValue / 100).toFixed(1) + '%';
            } else if (card.textContent.includes('ms')) {
                card.textContent = newValue + 'ms';
            } else {
                card.textContent = newValue.toLocaleString();
            }
        });

        if (charts.revenue) {
            const newData = charts.revenue.data.datasets[0].data.map(() =>
                Math.floor(Math.random() * 500) + 800
            );
            charts.revenue.data.datasets[0].data = newData;
            charts.revenue.update('none');
        }
    }

    /* rest of JS unchanged */

    </script>
</body>
</html>
