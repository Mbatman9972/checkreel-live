</style>
</head>
<body>
    <header class="header">
        <div class="logo-section">
            <div class="logo" id="logoClick">🎯 CheckReel Control Room</div>
            <div id="pwaStatus" style="color: rgba(255,255,255,0.7); font-size: 0.9rem;"></div>
        </div>
        <div class="header-controls">
            <select id="languageSelector" class="language-selector">
                <option value="en">🇺🇸 English</option>
                <option value="ar">🇸🇦 العربية</option>
            </select>
            <button id="controlToggle" class="control-toggle">⚡ Live Mode</button>
            <button id="adminToggle" class="control-toggle">🔑 Admin</button>
            <button id="installPWA" class="pwa-install" style="display: none;">📱 Install App</button>
        </div>
    </header>

    <div class="status-bar">
        <div class="status-item">
            <div class="status-indicator online"></div>
            <span id="systemStatus" data-i18n="systemStatus">System Status: Online</span>
        </div>
        <div class="status-item">
            <div class="status-indicator online"></div>
            <span id="apiStatus" data-i18n="apiStatus">API: Healthy</span>
        </div>
        <div class="status-item">
            <div class="status-indicator warning"></div>
            <span data-i18n="queueStatus">Queue: 847 pending</span>
        </div>
        <div class="status-item">
            <div class="status-indicator online"></div>
            <span data-i18n="dbStatus">Database: Connected</span>
        </div>
    </div>

    <div class="main-container">
        <div class="dashboard-content">
            <div id="adminSection">
                <h3 class="section-title">
                    <span>🔑</span>
                    <span>Admin Panel - Tier Management</span>
                </h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                    <div>
                        <h4 style="color: var(--text-primary); margin-bottom: 1rem; font-weight: 700;">Plus Tier Management</h4>
                        <input type="email" id="plusEmailInput" placeholder="user@example.com" style="width: 100%; padding: 1rem; margin-bottom: 0.75rem; border-radius: 16px; border: 1px solid var(--glass-border); background: var(--glass-bg); color: var(--text-primary); backdrop-filter: var(--blur-lg);">
                        <button onclick="addTierUser('plus')" style="background: var(--accent-gradient); border: none; color: white; padding: 0.75rem 1.5rem; border-radius: 12px; cursor: pointer; font-weight: 600; transition: all 0.3s ease;">Add Plus User</button>
                    </div>
                    <div>
                        <h4 style="color: var(--text-primary); margin-bottom: 1rem; font-weight: 700;">Premium Tier Management</h4>
                        <input type="email" id="premiumEmailInput" placeholder="user@example.com" style="width: 100%; padding: 1rem; margin-bottom: 0.75rem; border-radius: 16px; border: 1px solid var(--glass-border); background: var(--glass-bg); color: var(--text-primary); backdrop-filter: var(--blur-lg);">
                        <button onclick="addTierUser('premium')" style="background: var(--accent-gradient); border: none; color: white; padding: 0.75rem 1.5rem; border-radius: 12px; cursor: pointer; font-weight: 600; transition: all 0.3s ease;">Add Premium User</button>
                    </div>
                </div>
            </div>

            <div class="kpi-grid">
                <div class="kpi-card">
                    <div class="kpi-header">
                        <h4 class="kpi-title" id="kpiTitle1" data-i18n="todayRevenue">Today's Revenue</h4>
                        <div class="kpi-icon">💰</div>
                    </div>
                    <div class="kpi-value" id="kpiValue1">$1,247</div>
                    <div class="kpi-change positive">↗ +18.4% <span style="font-size: 0.7rem;">vs yesterday</span></div>
                </div>

                <div class="kpi-card">
                    <div class="kpi-header">
                        <h4 class="kpi-title" id="kpiTitle2" data-i18n="activeScans">Active Scans</h4>
                        <div class="kpi-icon">🔍</div>
                    </div>
                    <div class="kpi-value" id="kpiValue2">2,845</div>
                    <div class="kpi-change positive">↗ +12.3% <span style="font-size: 0.7rem;">this hour</span></div>
                </div>

                <div class="kpi-card">
                    <div class="kpi-header">
                        <h4 class="kpi-title" data-i18n="violationsDetected">Violations Detected</h4>
                        <div class="kpi-icon">⚠️</div>
                    </div>
                    <div class="kpi-value">89</div>
                    <div class="kpi-change negative">↘ -5.2% <span style="font-size: 0.7rem;">vs last hour</span></div>
                </div>

                <div class="kpi-card">
                    <div class="kpi-header">
                        <h4 class="kpi-title" id="kpiTitle3" data-i18n="activeUsers">Paying Subscribers</h4>
                        <div class="kpi-icon">👥</div>
                    </div>
                    <div class="kpi-value" id="kpiValue3">Loading...</div>
                    <div class="kpi-change positive">↗ Live Count <span style="font-size: 0.7rem;">from database</span></div>
                </div>

                <div class="kpi-card">
                    <div class="kpi-header">
                        <h4 class="kpi-title" data-i18n="responseTime">Avg Response Time</h4>
                        <div class="kpi-icon">⚡</div>
                    </div>
                    <div class="kpi-value">143ms</div>
                    <div class="kpi-change positive">↗ -12ms <span style="font-size: 0.7rem;">improved</span></div>
                </div>

                <div class="kpi-card">
                    <div class="kpi-header">
                        <h4 class="kpi-title" id="kpiTitle4" data-i18n="accuracy">AI Accuracy</h4>
                        <div class="kpi-icon">🎯</div>
                    </div>
                    <div class="kpi-value" id="kpiValue4">97.2%</div>
                    <div class="kpi-change positive">↗ +0.3% <span style="font-size: 0.7rem;">this week</span></div>
                </div>
            </div>

            <div class="user-tier-management">
                <h3 class="section-title">
                    <span>⚡</span>
                    <span data-i18n="userTierManagement">User Tier Management</span>
                </h3>
                <form class="tier-upgrade-form" id="tierUpgradeForm">
                    <div class="form-group">
                        <label class="form-label" for="userEmail" data-i18n="userEmail">User Email</label>
                        <input type="email" class="form-input" id="userEmail" placeholder="user@example.com" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="tierSelect" data-i18n="selectTier">Select Tier</label>
                        <select class="form-select" id="tierSelect" required>
                            <option value="" data-i18n="chooseTier">Choose tier...</option>
                            <option value="plus">Plus - $4.99/mo (20 scans)</option>
                            <option value="premium">Premium - $9.99/mo (40 scans)</option>
                        </select>
                    </div>
                    <button type="submit" class="btn-upgrade" id="upgradeBtn">
                        <span>⚡</span>
                        <span data-i18n="upgradeTier">Upgrade Tier</span>
                    </button>
                </form>
            </div>

            <div class="charts-grid">
                <div class="chart-container">
                    <div class="chart-header">
                        <h3 class="chart-title">📊 <span data-i18n="revenueChart">Revenue Analytics</span></h3>
                        <div class="chart-controls">
                            <button class="chart-btn active" onclick="updateChart('24h')">24H</button>
                            <button class="chart-btn" onclick="updateChart('7d')">7D</button>
                            <button class="chart-btn" onclick="updateChart('30d')">30D</button>
                            <button class="chart-btn" onclick="updateChart('1y')">1Y</button>
                        </div>
                    </div>
                    <div class="control-display">
                        <div class="kpi-value" id="revenueValue">$24,847</div>
                        <div class="metric-label">Total Revenue</div>
                        <div class="metric-trend">+12.5%</div>
                    </div>
                </div>

                <div class="chart-container">
                    <div class="chart-header">
                        <h3 class="chart-title">📱 <span data-i18n="platformChart">Platform Distribution</span></h3>
                    </div>
                    <div class="control-display">
                        <div class="platform-grid">
                            <div class="platform-box">
                                <div class="platform-icon"><img src="tiktok.png" alt="TikTok" style="width: 24px; height: 24px;"></div>
                                <div class="platform-name">TikTok</div>
                                <div class="platform-count" id="tiktokCount">1,247</div>
                            </div>
                            <div class="platform-box">
                                <div class="platform-icon"><img src="instagram.png" alt="Instagram" style="width: 24px; height: 24px;"></div>
                                <div class="platform-name">Instagram</div>
                                <div class="platform-count" id="instaCount">892</div>
                            </div>
                            <div class="platform-box">
                                <div class="platform-icon"><img src="youtube.png" alt="YouTube" style="width: 24px; height: 24px;"></div>
                                <div class="platform-name">YouTube</div>
                                <div class="platform-count" id="youtubeCount">634</div>
                            </div>
                            <div class="platform-box">
                                <div class="platform-icon"><img src="facebook.png" alt="Facebook" style="width: 24px; height: 24px;"></div>
                                <div class="platform-name">Facebook</div>
                                <div class="platform-count" id="facebookCount">423</div>
                            </div>
                            <div class="platform-box">
                                <div class="platform-icon"><img src="twitter.png" alt="Twitter" style="width: 24px; height: 24px;"></div>
                                <div class="platform-name">Twitter</div>
                                <div class="platform-count" id="twitterCount">287</div>
                            </div>
                            <div class="platform-box">
                                <div class="platform-icon"><img src="snapchat.png" alt="Snapchat" style="width: 24px; height: 24px;"></div>
                                <div class="platform-name">Snapchat</div>
                                <div class="platform-count" id="snapchatCount">156</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="chart-container">
                <div class="chart-header">
                    <h3 class="chart-title">⚡ <span data-i18n="violationsChart">Real-time Violations Detection</span></h3>
                    <div class="chart-controls">
                        <button class="chart-btn active" onclick="updateViolationsChart('live')">Live</button>
                        <button class="chart-btn" onclick="updateViolationsChart('hourly')">Hourly</button>
                        <button class="chart-btn" onclick="updateViolationsChart('daily')">Daily</button>
                    </div>
                </div>
                <div class="control-display">
                    <div class="kpi-value" id="violationsValue">89</div>
                    <div class="metric-label">Active Violations</div>
                    <div class="metric-trend">Live Monitoring</div>
                </div>
            </div>

            <div class="analytics-grid">
                <div class="analytics-card">
                    <h3 class="analytics-title">⚡ <span data-i18n="performanceMetrics">Performance Metrics</span></h3>
                    <div class="metric-item">
                        <span class="metric-label" data-i18n="copyright">Copyright</span>
                        <span class="metric-value">24.0%</span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label" data-i18n="avgScanTime">Avg Scan Time</span>
                        <span class="metric-value">2.3s</span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label" data-i18n="successRate">Success Rate</span>
                        <span class="metric-value">99.8%</span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label" data-i18n="throughput">Throughput</span>
                        <span class="metric-value">1,247/min</span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label" data-i18n="errorRate">Error Rate</span>
                        <span class="metric-value">0.2%</span>
                    </div>
                </div>

                <div class="analytics-card">
                    <h3 class="analytics-title">🌍 <span data-i18n="geographic">Geographic Distribution</span></h3>
                    <div class="metric-item">
                        <span class="metric-label" data-i18n="northAmerica">North America</span>
                        <span class="metric-value">42.3%</span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label" data-i18n="europe">Europe</span>
                        <span class="metric-value">28.7%</span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label" data-i18n="asia">Asia</span>
                        <span class="metric-value">21.5%</span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label" data-i18n="other">Other</span>
                        <span class="metric-value">7.5%</span>
                    </div>
                </div>

                <div class="analytics-card">
                    <h3 class="analytics-title">🛡️ <span data-i18n="contentCategories">Content Categories</span></h3>
                    <div class="metric-item">
                        <span class="metric-label" data-i18n="inappropriate">Inappropriate Language</span>
                        <span class="metric-value">34.2%</span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label" data-i18n="violence">Violence/Gore</span>
                        <span class="metric-value">18.7%</span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label" data-i18n="spam">Spam/Scam</span>
                        <span class="metric-value">23.1%</span>
                    </div>
                </div>

                <div class="analytics-card">
                    <h3 class="analytics-title">📊 <span data-i18n="scanHistory">Recent Scan History</span></h3>
                    <div class="scan-list" id="dashboardScanHistory">
                        <div class="rules-loading" data-i18n="loadingScans">Loading recent scans...</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="sidebar">
            <div class="sidebar-section">
                <h3 class="sidebar-title">⚡ <span data-i18n="controlActions">Control Actions</span></h3>
                <div class="quick-action" onclick="showScanHistory()">
                    <div class="action-icon">📊</div>
                    <div class="action-text" data-i18n="scanHistory">Scan History</div>
                </div>
                <div class="quick-action" onclick="showPlatformRules()">
                    <div class="action-icon">📋</div>
                    <div class="action-text" data-i18n="platformGuidelines">Platform Rules</div>
                </div>
                <div class="quick-action" onclick="showSystemSettings()">
                    <div class="action-icon">⚙️</div>
                    <div class="action-text" data-i18n="settings">System Settings</div>
                </div>
                <div class="quick-action" onclick="showSupportCenter()">
                    <div class="action-icon">🆘</div>
                    <div class="action-text" data-i18n="support">Support Center</div>
                </div>
                <div class="quick-action" onclick="activateEmergencyMode()">
                    <div class="action-icon">🚨</div>
                    <div class="action-text" data-i18n="emergency">Emergency Mode</div>
                </div>
            </div>

            <div class="sidebar-section">
                <h3 class="sidebar-title">🚨 <span data-i18n="criticalAlerts">Critical Alerts</span></h3>
                <div class="alert-item critical">
                    <div class="alert-icon">🔴</div>
                    <div class="alert-details">
                        <div class="alert-text">High violation rate detected</div>
                        <div class="alert-time">2 minutes ago</div>
                    </div>
                </div>
                <div class="alert-item warning">
                    <div class="alert-icon">🟡</div>
                    <div class="alert-details">
                        <div class="alert-text">API response time spike</div>
                        <div class="alert-time">5 minutes ago</div>
                    </div>
                </div>
                <div class="alert-item info">
                    <div class="alert-icon">🔵</div>
                    <div class="alert-details">
                        <div class="alert-text">Traffic surge: +67% users</div>
                        <div class="alert-time">12 minutes ago</div>
                    </div>
                </div>
            </div>

            <div class="sidebar-section">
                <h3 class="sidebar-title">📡 <span data-i18n="liveActivity">Live Activity</span></h3>
                <div class="activity-item">
                    <div class="activity-icon">🎵</div>
                    <div class="activity-details">
                        <div class="activity-text">TikTok: Music copyright claim</div>
                        <div class="activity-time">Just now</div>
                    </div>
                </div>
                <div class="activity-item">
                    <div class="activity-icon">📷</div>
                    <div class="activity-details">
                        <div class="activity-text">Instagram: Story flagged</div>
                        <div class="activity-time">1 min ago</div>
                    </div>
                </div>
                <div class="activity-item">
                    <div class="activity-icon">🎥</div>
                    <div class="activity-details">
                        <div class="activity-text">YouTube: Age-inappropriate content</div>
                        <div class="activity-time">3 min ago</div>
                    </div>
                </div>
                <div class="activity-item">
                    <div class="activity-icon">⭐</div>
                    <div class="activity-details">
                        <div class="activity-text">New Premium user registered</div>
                        <div class="activity-time">5 min ago</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="toast" id="toast">
        <span class="toast-icon" id="toastIcon"></span>
        <span class="toast-message" id="toastMessage"></span>
    </div>

    <!-- Control Action Modals -->
    <div class="control-modal" id="emergencyModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>🚨 Emergency Mode</h2>
                <button class="close-btn" onclick="closeModal('emergencyModal')">Close</button>
            </div>
            <div>
                <div style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); padding: 1rem; border-radius: 12px; margin-bottom: 2rem; text-align: center;">
                    <h3 style="color: white; margin: 0; font-weight: 800;"> CRITICAL SYSTEM CONTROLS </h3>
                    <p style="color: rgba(255,255,255,0.9); margin: 0.5rem 0 0 0; font-size: 0.9rem;">Use only during system emergencies. All actions are logged and monitored.</p>
                </div>

                <!-- System Override Controls -->
                <div style="background: var(--glass-bg); padding: 1.5rem; border-radius: 16px; margin-bottom: 1.5rem; border-left: 4px solid #ef4444;">
                    <h4 style="color: var(--text-primary); margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                         <span data-i18n="systemOverride">System Override Controls</span>
                    </h4>
                    <div style="display: grid; gap: 1rem;">
                        <div class="emergency-control">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <strong style="color: var(--text-primary);" data-i18n="forceStopScans">Force Stop All Scanning Operations</strong>
                                    <div style="color: var(--text-secondary); font-size: 0.85rem;">Immediately halt all content processing across all platforms</div>
                                </div>
                                <label class="emergency-toggle">
                                    <input type="checkbox" id="stopScans" onchange="toggleEmergencyMode(this, \"stopScans\")">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        <div class="emergency-control">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <strong style="color: var(--text-primary);" data-i18n="killConnections">Kill Active API Connections</strong>
                                    <div style="color: var(--text-secondary); font-size: 0.85rem;">Terminate all external platform integrations</div>
                                </div>
                                <label class="emergency-toggle">
                                    <input type="checkbox" id="killAPI" onchange="toggleEmergencyMode(this, \"killAPI\")">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        <div class="emergency-control">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <strong style="color: var(--text-primary);" data-i18n="maintenanceMode">Database Maintenance Mode</strong>
                                    <div style="color: var(--text-secondary); font-size: 0.85rem;">Put system into read-only maintenance state</div>
                                </div>
                                <label class="emergency-toggle">
                                    <input type="checkbox" id="maintenanceDB" onchange="toggleEmergencyMode(this, \"maintenanceDB\")">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Crisis Response Features -->
                <div style="background: var(--glass-bg); padding: 1.5rem; border-radius: 16px; margin-bottom: 1.5rem; border-left: 4px solid #f59e0b;">
                    <h4 style="color: var(--text-primary); margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                         <span data-i18n="crisisResponse">Crisis Response Features</span>
                    </h4>
                    <div style="display: grid; gap: 1rem;">
                        <div class="emergency-control">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <strong style="color: var(--text-primary);" data-i18n="bypassLimits">Rate Limiting Bypass</strong>
                                    <div style="color: var(--text-secondary); font-size: 0.85rem;">Override normal API rate limits during emergencies</div>
                                </div>
                                <label class="emergency-toggle">
                                    <input type="checkbox" id="bypassLimits" onchange="toggleEmergencyMode(this, \"bypassLimits\")">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        <div class="emergency-control">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <strong style="color: var(--text-primary);" data-i18n="priorityQueue">Priority Queue Management</strong>
                                    <div style="color: var(--text-secondary); font-size: 0.85rem;">Process only critical/urgent scans</div>
                                </div>
                                <label class="emergency-toggle">
                                    <input type="checkbox" id="priorityQueue" onchange="toggleEmergencyMode(this, \"priorityQueue\")">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        <div class="emergency-control">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <strong style="color: var(--text-primary);" data-i18n="resourceOverride">Resource Allocation Override</strong>
                                    <div style="color: var(--text-secondary); font-size: 0.85rem;">Redirect system resources to essential functions</div>
                                </div>
                                <label class="emergency-toggle">
                                    <input type="checkbox" id="resourceOverride" onchange="toggleEmergencyMode(this, \"resourceOverride\")">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Admin Emergency Powers -->
                <div style="background: var(--glass-bg); padding: 1.5rem; border-radius: 16px; margin-bottom: 1.5rem; border-left: 4px solid #8b5cf6;">
                    <h4 style="color: var(--text-primary); margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                         <span data-i18n="adminPowers">Admin Emergency Powers</span>
                    </h4>
                    <div style="display: grid; gap: 1rem;">
                        <div class="emergency-control">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <strong style="color: var(--text-primary);" data-i18n="bulkSuspension">Bulk User Suspension</strong>
                                    <div style="color: var(--text-secondary); font-size: 0.85rem;">Quickly disable problematic accounts</div>
                                </div>
                                <label class="emergency-toggle">
                                    <input type="checkbox" id="bulkSuspend" onchange="toggleEmergencyMode(this, \"bulkSuspend\")">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        <div class="emergency-control">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <strong style="color: var(--text-primary);" data-i18n="contentBlocks">Platform-wide Content Blocks</strong>
                                    <div style="color: var(--text-secondary); font-size: 0.85rem;">Immediately block specific content types</div>
                                </div>
                                <label class="emergency-toggle">
                                    <input type="checkbox" id="contentBlocks" onchange="toggleEmergencyMode(this, \"contentBlocks\")">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        <div class="emergency-control">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <strong style="color: var(--text-primary);" data-i18n="emergencyAlerts">Emergency Notifications</strong>
                                    <div style="color: var(--text-secondary); font-size: 0.85rem;">Send alerts to all administrators/stakeholders</div>
                                </div>
                                <label class="emergency-toggle">
                                    <input type="checkbox" id="emergencyAlerts" onchange="toggleEmergencyMode(this, \"emergencyAlerts\")">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- System Recovery Tools -->
                <div style="background: var(--glass-bg); padding: 1.5rem; border-radius: 16px; margin-bottom: 1.5rem; border-left: 4px solid #10b981;">
                    <h4 style="color: var(--text-primary); margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                         <span data-i18n="systemRecovery">System Recovery Tools</span>
                    </h4>
                    <div style="display: grid; gap: 1rem;">
                        <div class="emergency-control">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <strong style="color: var(--text-primary);" data-i18n="clearCache">Cache Clearing</strong>
                                    <div style="color: var(--text-secondary); font-size: 0.85rem;">Clear all system caches to resolve issues</div>
                                </div>
                                <label class="emergency-toggle">
                                    <input type="checkbox" id="clearCache" onchange="toggleEmergencyMode(this, \"clearCache\")">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        <div class="emergency-control">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <strong style="color: var(--text-primary);" data-i18n="restartServices">Service Restart</strong>
                                    <div style="color: var(--text-secondary); font-size: 0.85rem;">Restart core services without full system reboot</div>
                                </div>
                                <label class="emergency-toggle">
                                    <input type="checkbox" id="restartServices" onchange="toggleEmergencyMode(this, \"restartServices\")">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        <div class="emergency-control">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <strong style="color: var(--text-primary);" data-i18n="rollbackConfig">Rollback Functionality</strong>
                                    <div style="color: var(--text-secondary); font-size: 0.85rem;">Revert to last known good configuration</div>
                                </div>
                                <label class="emergency-toggle">
                                    <input type="checkbox" id="rollbackConfig" onchange="toggleEmergencyMode(this, \"rollbackConfig\")">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Emergency Status Display -->
                <div style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(220, 38, 38, 0.05) 100%); padding: 1.5rem; border-radius: 16px; border: 1px solid rgba(239, 68, 68, 0.3);">
                    <h4 style="color: var(--text-primary); margin-bottom: 1rem;"> Emergency Status</h4>
                    <div id="emergencyStatus" style="color: var(--text-secondary); font-family: monospace; font-size: 0.9rem; line-height: 1.6;">
                        All systems operating normally. No emergency modes active.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="admin-config.js"></script>
    <script src="tier.js"></script>
    <script>
        // GLOBAL VARIABLES - PROPERLY DECLARED
        var currentLanguage = "en";
        var logoClickCount = 0;
        var isAdminMode = false;

        // LANGUAGE SYSTEM - COMPREHENSIVE ARABIC SUPPORT
        var languages = {
            en: {
                systemStatus: "System Status: Online",
                apiStatus: "API: Healthy",
                queueStatus: "Queue: 847 pending",
                dbStatus: "Database: Connected",
                todayRevenue: "Today's Revenue",
                activeScans: "Active Scans",
                violationsDetected: "Violations Detected",
                activeUsers: "Paying Subscribers",
                responseTime: "Avg Response Time",
                accuracy: "AI Accuracy",
                userTierManagement: "User Tier Management",
                userEmail: "User Email",
                selectTier: "Select Tier",
                chooseTier: "Choose tier...",
                upgradeTier: "Upgrade Tier",
                revenueChart: "Revenue Analytics",
                platformChart: "Platform Distribution",
                violationsChart: "Real-time Violations Detection",
                performanceMetrics: "Performance Metrics",
                copyright: "Copyright",
                avgScanTime: "Avg Scan Time",
                successRate: "Success Rate",
                throughput: "Throughput",
                errorRate: "Error Rate",
                geographic: "Geographic Distribution",
                northAmerica: "North America",
                europe: "Europe",
                asia: "Asia",
                other: "Other",
                contentCategories: "Content Categories",
                inappropriate: "Inappropriate Language",
                violence: "Violence/Gore",
                spam: "Spam/Scam",
                scanHistory: "Recent Scan History",
                loadingScans: "Loading recent scans...",
                controlActions: "Control Actions",
                scanHistoryAction: "Scan History",
                platformGuidelines: "Platform Rules",
                settings: "System Settings",
                support: "Support Center",
                emergency: "Emergency Mode",
                criticalAlerts: "Critical Alerts",
                liveActivity: "Live Activity",
                closeBtn: "Close",
                loadingData: "Loading data...",
                errorLoading: "Error loading data",
                adminPanel: "Admin Panel - Tier Management",
                plusTier: "Plus Tier Management",
                premiumTier: "Premium Tier Management",
                addUser: "Add User",
                liveMode: "Live Mode",
                admin: "Admin",
                // Control Actions specific translations
                platformRulesManagement: "Platform Rules Management",
                addNewRule: "Add New Rule",
                editRule: "Edit Rule",
                saveRule: "Save Rule",
                cancel: "Cancel",
                platform: "Platform",
                category: "Category",
                ruleText: "Rule Text",
                sourceUrl: "Source URL",
                adminNotes: "Admin Notes",
                selectPlatform: "Select Platform",
                enterRuleDescription: "Enter the rule description...",
                internalNotes: "Internal notes...",
                allPlatforms: "All Platforms",
                allCategories: "All Categories",
                allStatus: "All Status",
                export: "Export",
                edit: "Edit",
                enable: "Enable",
                disable: "Disable",
                delete: "Delete",
                active: "Active",
                inactive: "Inactive",
                source: "Source",
                notes: "Notes",
                violenceContent: "Violence & Dangerous Content",
                youthSafety: "Youth Safety",
                hateSpeech: "Hate Speech",
                nudityContent: "Nudity & Sexual Content",
                clean: "Clean",
                violation: "Violation",
                optional: "optional",
                required: "required"
            },
            ar: {
                systemStatus: "حالة النظام: متصل",
                apiStatus: "واجهة البرمجة: سليمة",
                queueStatus: "الطابور: ٨٤٧ معلق",
                dbStatus: "قاعدة البيانات: متصلة",
                todayRevenue: "إيرادات اليوم",
                activeScans: "الفحوصات النشطة",
                violationsDetected: "الانتهاكات المكتشفة",
                activeUsers: "المشتركون الدافعون",
                responseTime: "متوسط وقت الاستجابة",
                accuracy: "دقة الذكاء الاصطناعي",
                userTierManagement: "إدارة مستويات المستخدمين",
                userEmail: "بريد المستخدم الإلكتروني",
                selectTier: "اختر المستوى",
                chooseTier: "اختر مستوى...",
                upgradeTier: "ترقية المستوى",
                revenueChart: "تحليلات الإيرادات",
                platformChart: "توزيع المنصات",
                violationsChart: "اكتشاف الانتهاكات في الوقت الفعلي",
                performanceMetrics: "مقاييس الأداء",
                copyright: "حقوق التأليف والنشر",
                avgScanTime: "متوسط وقت الفحص",
                successRate: "معدل النجاح",
                throughput: "الإنتاجية",
                errorRate: "معدل الخطأ",
                geographic: "التوزيع الجغرافي",
                northAmerica: "أمريكا الشمالية",
                europe: "أوروبا",
                asia: "آسيا",
                other: "أخرى",
                contentCategories: "فئات المحتوى",
                inappropriate: "لغة غير مناسبة",
                violence: "عنف/دماء",
                spam: "رسائل مزعجة/احتيال",
                scanHistory: "سجل الفحص الحديث",
                loadingScans: "جاري تحميل الفحوصات الحديثة...",
                controlActions: "إجراءات التحكم",
                scanHistoryAction: "سجل الفحص",
                platformGuidelines: "قواعد المنصة",
                settings: "إعدادات النظام",
                support: "مركز الدعم",
                emergency: "وضع الطوارئ",
                criticalAlerts: "تنبيهات حرجة",
                liveActivity: "النشاط المباشر",
                closeBtn: "إغلاق",
                loadingData: "جاري تحميل البيانات...",
                errorLoading: "خطأ في تحميل البيانات",
                adminPanel: "لوحة الإدارة - إدارة المستويات",
                plusTier: "إدارة المستوى الإضافي",
                premiumTier: "إدارة المستوى المميز",
                addUser: "إضافة مستخدم",
                liveMode: "الوضع المباشر",
                admin: "إدارة",
                // Control Actions specific translations in Arabic
                platformRulesManagement: "إدارة قواعد المنصة",
                addNewRule: "إضافة قاعدة جديدة",
                editRule: "تعديل القاعدة",
                saveRule: "حفظ القاعدة",
                cancel: "إلغاء",
                platform: "المنصة",
                category: "الفئة",
                ruleText: "نص القاعدة",
                sourceUrl: "رابط المصدر",
                adminNotes: "ملاحظات الإدارة",
                selectPlatform: "اختر المنصة",
                enterRuleDescription: "أدخل وصف القاعدة...",
                internalNotes: "ملاحظات داخلية...",
                allPlatforms: "جميع المنصات",
                allCategories: "جميع الفئات",
                allStatus: "جميع الحالات",
                export: "تصدير",
                edit: "تعديل",
                enable: "تفعيل",
                disable: "تعطيل",
                delete: "حذف",
                active: "نشط",
                inactive: "غير نشط",
                source: "المصدر",
                notes: "ملاحظات",
                violenceContent: "العنف والمحتوى الخطير",
                youthSafety: "سلامة الشباب",
                hateSpeech: "خطاب الكراهية",
                nudityContent: "العري والمحتوى الجنسي",
                clean: "نظيف",
                violation: "انتهاك",
                optional: "اختياري",
                required: "مطلوب"
            }
        };

        // COMPREHENSIVE LANGUAGE UPDATE FUNCTION
        function updateLanguage() {
            var lang = languages[currentLanguage];
            var isRTL = currentLanguage === "ar";
            
            // Update body direction
            document.body.dir = isRTL ? "rtl" : "ltr";
            document.body.className = isRTL ? "rtl" : "";
            
            // Update all elements with data-i18n attributes
            document.querySelectorAll('[data-i18n]').forEach(function(element) {
                var key = element.getAttribute('data-i18n');
                if (lang[key]) {
                    element.textContent = lang[key];
                }
            });
            
            // Update status bar items
            var systemStatusEl = document.getElementById("systemStatus");
            var apiStatusEl = document.getElementById("apiStatus");
            if (systemStatusEl) systemStatusEl.textContent = lang.systemStatus;
            if (apiStatusEl) apiStatusEl.textContent = lang.apiStatus;
            
            // Update control toggle buttons
            var controlToggle = document.getElementById("controlToggle");
            var adminToggle = document.getElementById("adminToggle");
            if (controlToggle) controlToggle.textContent = (isRTL ? "⚡ " : "⚡ ") + lang.liveMode;
            if (adminToggle) adminToggle.textContent = (isRTL ? "🔑 " : "🔑 ") + lang.admin;
            
            // Update KPI values (convert numbers to Arabic if needed)
            if (isRTL) {
                convertNumbersToArabic();
            } else {
                convertNumbersToEnglish();
            }
            
            // Update admin section if visible
            var adminSection = document.getElementById("adminSection");
            if (adminSection && adminSection.classList.contains("active")) {
                updateAdminSectionLanguage(lang, isRTL);
            }
            
            // Update modal content - CRITICAL ADDITION
            updateModalLanguage(lang, isRTL);
            
            // Update Control Actions modals content
            updateControlActionsLanguage(lang, isRTL);
        }
        
        function convertNumbersToArabic() {
            var arabicNumbers = ['٠', '١', '٢', '٣', '٤', '٥', '٦', '٧', '٨', '٩'];
            var elements = document.querySelectorAll('.kpi-value, .metric-value, .platform-count');
            
            elements.forEach(function(element) {
                if (element.textContent) {
                    var text = element.textContent;
                    for (var i = 0; i < 10; i++) {
                        text = text.replace(new RegExp(i, 'g'), arabicNumbers[i]);
                    }
                    element.textContent = text;
                }
            });
        }
        
        function convertNumbersToEnglish() {
            var arabicNumbers = ['٠', '١', '٢', '٣', '٤', '٥', '٦', '٧', '٨', '٩'];
            var elements = document.querySelectorAll('.kpi-value, .metric-value, .platform-count');
            
            elements.forEach(function(element) {
                if (element.textContent) {
                    var text = element.textContent;
                    for (var i = 0; i < 10; i++) {
                        text = text.replace(new RegExp(arabicNumbers[i], 'g'), i);
                    }
                    element.textContent = text;
                }
            });
        }
        
        function updateAdminSectionLanguage(lang, isRTL) {
            var plusHeader = document.querySelector('#adminSection h4:first-of-type');
            var premiumHeader = document.querySelector('#adminSection h4:last-of-type');
            var plusBtn = document.querySelector('#adminSection button:first-of-type');
            var premiumBtn = document.querySelector('#adminSection button:last-of-type');
            
            if (plusHeader) plusHeader.textContent = lang.plusTier;
            if (premiumHeader) premiumHeader.textContent = lang.premiumTier;
            if (plusBtn) plusBtn.textContent = lang.addUser + " Plus";
            if (premiumBtn) premiumBtn.textContent = lang.addUser + " Premium";
        }
        
        function updateModalLanguage(lang, isRTL) {
            // Update modal headers
            var scanModalHeader = document.querySelector('#scanHistoryModal h2');
            var rulesModalHeader = document.querySelector('#platformRulesModal h2');
            var settingsModalHeader = document.querySelector('#systemSettingsModal h2');
            var supportModalHeader = document.querySelector('#supportCenterModal h2');
            var emergencyModalHeader = document.querySelector('#emergencyModal h2');
            
            if (scanModalHeader) scanModalHeader.textContent = "📊 " + lang.scanHistoryAction;
            if (rulesModalHeader) rulesModalHeader.textContent = "📋 " + lang.platformGuidelines;
            if (settingsModalHeader) settingsModalHeader.textContent = "⚙️ " + lang.settings;
            if (supportModalHeader) supportModalHeader.textContent = "🆘 " + lang.support;
            if (emergencyModalHeader) emergencyModalHeader.textContent = "🚨 " + lang.emergency;
            
            // Update close buttons
            document.querySelectorAll('.close-btn').forEach(function(btn) {
                btn.textContent = lang.closeBtn;
            });
            
            // Update loading messages
            document.querySelectorAll('.rules-loading').forEach(function(element) {
                if (element.textContent.includes('Loading')) {
                    element.textContent = lang.loadingData;
                }
            });
        }

        // NEW FUNCTION: Update Control Actions Language
        function updateControlActionsLanguage(lang, isRTL) {
            // Update Platform Rules modal content
            var platformRulesContent = document.getElementById("platformRulesContent");
            if (platformRulesContent && platformRulesContent.innerHTML.includes("Platform Rules Management")) {
                // Update Platform Rules Management text
                var h3Elements = platformRulesContent.querySelectorAll('h3');
                h3Elements.forEach(function(h3) {
                    if (h3.textContent.includes("Platform Rules Management")) {
                        h3.textContent = lang.platformRulesManagement;
                    }
                });
                
                // Update Add Rule button
                var addRuleBtn = platformRulesContent.querySelector('button[onclick="addNewRule()"]');
                if (addRuleBtn) {
                    addRuleBtn.innerHTML = '+ ' + lang.addNewRule;
                }
                
                // Update filter dropdowns
                var platformFilter = document.getElementById("rulesplatformFilter");
                if (platformFilter) {
                    var options = platformFilter.options;
                    if (options[0]) options[0].textContent = lang.allPlatforms;
                }
                
                var categoryFilter = document.getElementById("categoryFilter");
                if (categoryFilter) {
                    var options = categoryFilter.options;
                    if (options[0]) options[0].textContent = lang.allCategories;
                    if (options[1]) options[1].textContent = lang.violenceContent;
                    if (options[2]) options[2].textContent = lang.youthSafety;
                    if (options[3]) options[3].textContent = lang.hateSpeech;
                    if (options[4]) options[4].textContent = lang.nudityContent;
                }
                
                // Update export button
                var exportBtn = platformRulesContent.querySelector('button[onclick="exportRules()"]');
                if (exportBtn) {
                    exportBtn.innerHTML = '📄 ' + lang.export;
                }
            }
            
            // Update Scan History modal content
            var scanHistoryModal = document.getElementById("scanHistoryModal");
            if (scanHistoryModal) {
                var platformFilter = scanHistoryModal.querySelector('#platformFilter');
                if (platformFilter) {
                    var options = platformFilter.options;
                    if (options[0]) options[0].textContent = lang.allPlatforms;
                }
                
                var statusFilter = scanHistoryModal.querySelector('#statusFilter');
                if (statusFilter) {
                    var options = statusFilter.options;
                    if (options[0]) options[0].textContent = lang.allStatus;
                    if (options[1]) options[1].textContent = lang.clean;
                    if (options[2]) options[2].textContent = lang.violation;
                }
                
                var exportScanBtn = scanHistoryModal.querySelector('button[onclick="exportScanHistory()"]');
                if (exportScanBtn) {
                    exportScanBtn.innerHTML = '📄 ' + lang.export + ' CSV';
                }
            }
            
            // Update Rule Edit Modal if exists
            var ruleEditModal = document.getElementById("ruleEditModal");
            if (ruleEditModal) {
                var ruleModalTitle = document.getElementById("ruleModalTitle");
                if (ruleModalTitle && ruleModalTitle.textContent.includes("Add New Rule")) {
                    ruleModalTitle.textContent = lang.addNewRule;
                } else if (ruleModalTitle && ruleModalTitle.textContent.includes("Edit Rule")) {
                    ruleModalTitle.textContent = lang.editRule;
                }
                
                // Update form labels in rule modal
                var labels = ruleEditModal.querySelectorAll('label');
                labels.forEach(function(label) {
                    var text = label.textContent.toLowerCase();
                    if (text.includes('platform')) {
                        label.textContent = lang.platform + ':';
                    } else if (text.includes('category')) {
                        label.textContent = lang.category + ':';
                    } else if (text.includes('rule text')) {
                        label.textContent = lang.ruleText + ':';
                    } else if (text.includes('source url')) {
                        label.textContent = lang.sourceUrl + ' (' + lang.optional + '):';
                    } else if (text.includes('admin notes')) {
                        label.textContent = lang.adminNotes + ' (' + lang.optional + '):';
                    }
                });
                
                // Update placeholders
                var ruleTextArea = document.getElementById("ruleText");
                if (ruleTextArea) {
                    ruleTextArea.placeholder = lang.enterRuleDescription;
                }
                
                var adminNotesArea = document.getElementById("ruleAdminNotes");
                if (adminNotesArea) {
                    adminNotesArea.placeholder = lang.internalNotes;
                }
                
                // Update platform select options
                var rulePlatform = document.getElementById("rulePlatform");
                if (rulePlatform) {
                    var options = rulePlatform.options;
                    if (options[0]) options[0].textContent = lang.selectPlatform;
                }
                
                // Update category options  
                var ruleCategory = document.getElementById("ruleCategory");
                if (ruleCategory) {
                    var options = ruleCategory.options;
                    if (options[0]) options[0].textContent = lang.violenceContent;
                    if (options[1]) options[1].textContent = lang.youthSafety;
                    if (options[2]) options[2].textContent = lang.hateSpeech;
                    if (options[3]) options[3].textContent = lang.nudityContent;
                }
                
                // Update buttons
                var saveBtn = ruleEditModal.querySelector('button[onclick="saveRule()"]');
                if (saveBtn) {
                    saveBtn.textContent = lang.saveRule;
                }
                
                var cancelBtn = ruleEditModal.querySelector('button[onclick="closeRuleModal()"]');
                if (cancelBtn) {
                    cancelBtn.textContent = lang.cancel;
                }
            }
            
            // Update status badges
            document.querySelectorAll('.status-clean').forEach(function(badge) {
                badge.textContent = lang.clean;
            });
            
            document.querySelectorAll('.status-violation').forEach(function(badge) {
                badge.textContent = lang.violation;
            });
        }

        // TOAST NOTIFICATION SYSTEM
        function showToast(message, type) {
            type = type || 'success';
            var toast = document.getElementById('toast');
            var toastIcon = document.getElementById('toastIcon');
            var toastMessage = document.getElementById('toastMessage');
            
            if (toast && toastIcon && toastMessage) {
                toastMessage.textContent = message;
                toastIcon.textContent = type === 'success' ? '✅' : '❌';
                toast.className = 'toast show ' + type;
                
                setTimeout(function() {
                    toast.className = 'toast';
                }, 3000);
            }
        }

        // KPI LOADING FUNCTIONS
        function loadKPIs() {
            console.log('Loading KPIs...');
            
            setTimeout(function() {
                var kpiValue1 = document.getElementById("kpiValue1");
                var kpiValue2 = document.getElementById("kpiValue2");
                var kpiValue4 = document.getElementById("kpiValue4");
                
                if (kpiValue1) kpiValue1.textContent = "$24,891";
                if (kpiValue2) kpiValue2.textContent = "156,234";
                if (kpiValue4) kpiValue4.textContent = "97.8%";
                
                console.log('Static KPIs updated');
            }, 1000);
            
            loadPayingCount();
            loadSupabaseAnalytics();
        }

        // FIXED SUPABASE FUNCTION - SINGLE IMPLEMENTATION
        async function loadPayingCount() {
            console.log('Loading paying subscriber count from Supabase...');
            
            var kpiValue3 = document.getElementById("kpiValue3");
            if (kpiValue3) {
                kpiValue3.innerHTML = '<div class="spinner"></div>';
            }
            
            try {
                const response = await fetch(ADMIN_SUPABASE_URL + '/rest/v1/subscriptions?select=count&tier=in.(plus,premium)', {
                    method: 'GET',
                    headers: {
                        'Authorization': 'Bearer ' + SUPABASE_KEY,
                        'apikey': SUPABASE_KEY,
                        'Prefer': 'count=exact'
                    }
                });
                
                if (response.ok) {
                    const contentRange = response.headers.get('Content-Range');
                    const count = contentRange ? contentRange.split('/')[1] : '0';
                    
                    if (kpiValue3) {
                        kpiValue3.textContent = count.toString();
                        showToast('Paying subscriber count loaded: ' + count);
                    }
                    console.log('Supabase subscriber count:', count);
                } else {
                    throw new Error('Supabase query failed: ' + response.status);
                }
            } catch (error) {
                console.error('Supabase Error:', error);
                if (kpiValue3) kpiValue3.textContent = "Error";
                showToast('Failed to load subscriber count', 'error');
            }
        }

        // SUPABASE TIER MANAGEMENT
        async function addTierUser(tier) {
            console.log('Adding tier user to Supabase:', tier);
            
            var emailInput = document.getElementById(tier + "EmailInput");
            if (!emailInput) {
                alert("Email input not found");
                return;
            }
            
            var email = emailInput.value.trim();
            if (!email) {
                alert("Please enter an email address");
                return;
            }
            
            if (!email.includes('@')) {
                alert("Please enter a valid email address");
                return;
            }
            
            try {
                const subscription = await fetch(ADMIN_SUPABASE_URL + '/rest/v1/subscriptions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + SUPABASE_KEY,
                        'apikey': SUPABASE_KEY,
                        'Prefer': 'resolution=merge-duplicates'
                    },
                    body: JSON.stringify({
                        email: email,
                        tier: tier,
                        status: 'active',
                        created_at: new Date().toISOString()
                    })
                });
                
                if (subscription.ok) {
                    emailInput.value = "";
                    showToast('User ' + email + ' upgraded to ' + tier.toUpperCase() + ' successfully!');
                    loadPayingCount();
                } else {
                    throw new Error('Failed to create subscription');
                }
                
            } catch (error) {
                console.error('Supabase tier update error:', error);
                showToast('Failed to upgrade ' + email + ': ' + error.message, 'error');
            }
        }

        // SUPABASE ANALYTICS
        async function loadSupabaseAnalytics() {
            try {
                const scansResponse = await fetch(ADMIN_SUPABASE_URL + '/rest/v1/scans?select=count', {
                    method: 'GET',
                    headers: {
                        'Authorization': 'Bearer ' + SUPABASE_KEY,
                        'apikey': SUPABASE_KEY,
                        'Prefer': 'count=exact'
                    }
                });
                
                const scanCount = scansResponse.headers.get('Content-Range')?.split('/')[1] || 0;
                
                var kpiValue2 = document.getElementById("kpiValue2");
                if (kpiValue2) kpiValue2.textContent = scanCount.toLocaleString();
                
                console.log('Real-time analytics loaded from Supabase');
                
            } catch (error) {
                console.error('Analytics loading error:', error);
            }
        }

        // ADMIN PANEL TOGGLE
        function toggleAdmin() {
            var password = prompt("Enter admin password:");
            if (password === "MM7286CR") {
                isAdminMode = !isAdminMode;
                var adminSection = document.getElementById("adminSection");
                if (adminSection) {
                    if (isAdminMode) {
                        adminSection.classList.add("active");
                        showToast('Admin panel activated');
                    } else {
                        adminSection.classList.remove("active");
                        showToast('Admin panel deactivated');
                    }
                }
            } else if (password !== null) {
                showToast('Invalid admin password', 'error');
            }
        }

        // CHART CONTROL FUNCTIONS
        function updateChart(range) {
            console.log('Updating chart to range:', range);
            
            var buttons = document.querySelectorAll('.chart-btn');
            buttons.forEach(function(btn) { 
                btn.classList.remove('active'); 
            });
            event.target.classList.add('active');
            
            var revenueValue = document.getElementById('revenueValue');
            if (revenueValue) {
                switch(range) {
                    case '24h': revenueValue.textContent = '$24,847'; break;
                    case '7d': revenueValue.textContent = '$172,943'; break;
                    case '30d': revenueValue.textContent = '$687,234'; break;
                    case '1y': revenueValue.textContent = '$8,234,567'; break;
                }
            }
            
            showToast('Chart updated to ' + range + ' view');
        }

        function updateViolationsChart(type) {
            console.log('Updating violations chart to type:', type);
            
            var buttons = document.querySelectorAll('.chart-btn');
            buttons.forEach(function(btn) { 
                btn.classList.remove('active'); 
            });
            event.target.classList.add('active');
            
            var violationsValue = document.getElementById('violationsValue');
            if (violationsValue) {
                switch(type) {
                    case 'live': violationsValue.textContent = '89'; break;
                    case 'hourly': violationsValue.textContent = '247'; break;
                    case 'daily': violationsValue.textContent = '1,432'; break;
                }
            }
            
            showToast('Violations chart updated to ' + type + ' view');
        }

        // FORM HANDLERS
        function handleTierUpgradeForm(e) {
            e.preventDefault();
            console.log('Tier upgrade form submitted');
            
            var userEmail = document.getElementById('userEmail');
            var tierSelect = document.getElementById('tierSelect');
            
            if (userEmail && tierSelect && userEmail.value && tierSelect.value) {
                var selectedEmail = userEmail.value;
                var selectedTier = tierSelect.value;
                
                addTierUser(selectedTier);
                userEmail.value = '';
                tierSelect.value = '';
            } else {
                alert('Please fill in all fields');
            }
        }

        // EVENT LISTENERS SETUP
        function setupEventListeners() {
            console.log('Setting up event listeners...');
            
            var logoClick = document.getElementById("logoClick");
            if (logoClick) {
                logoClick.addEventListener("click", function() {
                    logoClickCount++;
                    console.log('Logo clicked:', logoClickCount);
                    
                    if (logoClickCount >= 5) {
                        var adminToggle = document.getElementById("adminToggle");
                        if (adminToggle) {
                            adminToggle.style.display = "block";
                            showToast('Admin button revealed! Click to access admin panel.');
                        }
                        logoClickCount = 0;
                    }
                });
            }

            var languageSelector = document.getElementById("languageSelector");
            if (languageSelector) {
                languageSelector.addEventListener("change", function() {
                    currentLanguage = this.value;
                    updateLanguage();
                    localStorage.setItem("checkreel_language", currentLanguage);
                    showToast('Language changed to ' + (currentLanguage === 'en' ? 'English' : 'العربية'));
                });
            }

            var adminToggle = document.getElementById("adminToggle");
            if (adminToggle) {
                adminToggle.addEventListener("click", toggleAdmin);
            }

            var tierUpgradeForm = document.getElementById('tierUpgradeForm');
            if (tierUpgradeForm) {
                tierUpgradeForm.addEventListener('submit', handleTierUpgradeForm);
            }
            
            console.log('Event listeners setup completed');
        }

        // AUTO-REFRESH FUNCTIONS
        function startAutoRefresh() {
            setInterval(function() {
                console.log('Auto-refreshing paying count...');
                loadPayingCount();
            }, 30000);
            
            setInterval(function() {
                console.log('Auto-refreshing KPIs...');
                loadKPIs();
            }, 60000);
        }

        // INITIALIZATION FUNCTIONS
        function initializeLanguage() {
            var savedLanguage = localStorage.getItem("checkreel_language");
            if (savedLanguage && languages[savedLanguage]) {
                currentLanguage = savedLanguage;
                var languageSelector = document.getElementById("languageSelector");
                if (languageSelector) {
                    languageSelector.value = currentLanguage;
                }
            }
            updateLanguage();
        }

        function initializeDashboard() {
            console.log('Initializing CheckReel Admin Dashboard...');
            
            showToast('CheckReel Admin Dashboard Loading...', 'success');
            
            initializeLanguage();
            loadKPIs();
            loadDashboardScanHistory();
            startAutoRefresh();
            
            console.log('Dashboard initialization completed');
            
            setTimeout(function() {
                showToast('CheckReel Admin Dashboard Ready - Supabase Connected!', 'success');
            }, 2000);
        }

        // DASHBOARD SCAN HISTORY FUNCTION
        async function loadDashboardScanHistory() {
            const dashboardScans = document.getElementById("dashboardScanHistory");
            if (!dashboardScans) return;
            
            try {
                const response = await fetch(ADMIN_SUPABASE_URL + "/rest/v1/scans?select=*&order=created_at.desc&limit=5", {
                    headers: {
                        "Authorization": "Bearer " + SUPABASE_KEY,
                        "apikey": SUPABASE_KEY,
                        "Content-Type": "application/json"
                    }
                });
                
                if (response.ok) {
                    const scans = await response.json();
                    displayDashboardScanHistory(scans);
                } else {
                    dashboardScans.innerHTML = "<div class=\"rules-loading\">No recent scans found.</div>";
                }
            } catch (error) {
                console.error("Dashboard scan history error:", error);
                dashboardScans.innerHTML = "<div class=\"rules-loading\">Loading failed.</div>";
            }
        }

        function displayDashboardScanHistory(scans) {
            const dashboardScans = document.getElementById("dashboardScanHistory");
            if (!scans.length) {
                dashboardScans.innerHTML = "<div class=\"rules-loading\">No recent scans available.</div>";
                return;
            }
            
            let html = "";
            scans.forEach(scan => {
                const statusBadge = scan.status === 'violation' ? 'status-violation' : 'status-clean';
                html += `<div class="metric-item">
                    <span class="metric-label">${scan.platform}</span>
                    <span class="status-badge ${statusBadge}">${scan.status}</span>
                </div>`;
            });
            
            dashboardScans.innerHTML = html;
        }

        // DOM READY EVENT LISTENERS
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM Content Loaded - Setting up CheckReel Admin Dashboard');
            setupEventListeners();
        });

        window.addEventListener("load", function() {
            console.log('Window Loaded - Initializing CheckReel Admin Dashboard');
            initializeDashboard();
        });

        // ERROR HANDLING
        window.addEventListener('error', function(e) {
            console.error('JavaScript Error:', e.error);
            showToast('An error occurred. Check console for details.', 'error');
        });

        // CONTROL ACTIONS FUNCTIONS
        async function showScanHistory() {
            console.log("Opening Scan History...");
            document.getElementById("scanHistoryModal").classList.add("active");
            await loadAdminScanHistory();
            updateLanguage(); // Re-apply language after modal opens
            showToast("Scan History opened - Live data loaded");
        }

        async function loadAdminScanHistory() {
            const scansList = document.getElementById("scanHistoryList");
            scansList.innerHTML = "<div class=\"rules-loading\">Loading scan history from database...</div>";
            
            try {
                const response = await fetch(ADMIN_SUPABASE_URL + "/rest/v1/scans?select=*&order=created_at.desc&limit=50", {
                    headers: {
                        "Authorization": "Bearer " + SUPABASE_KEY,
                        "apikey": SUPABASE_KEY,
                        "Content-Type": "application/json"
                    }
                });
                
                if (response.ok) {
                    const scans = await response.json();
                    displayAdminScanHistory(scans);
                } else {
                    scansList.innerHTML = "<div class=\"rules-loading\">Error loading scan history.</div>";
                }
            } catch (error) {
                console.error("Scan history loading error:", error);
                scansList.innerHTML = "<div class=\"rules-loading\">Database connection failed.</div>";
            }
        }

        function displayAdminScanHistory(scans) {
            const scansList = document.getElementById("scanHistoryList");
            let html = "<h3>Live Scan History - " + scans.length + " Recent Records:</h3>";
            
            scans.forEach(scan => {
                const results = JSON.parse(scan.results || "{}");
                const statusBadge = scan.status === 'violation' ? 'status-violation' : 'status-clean';
                html += `<div class="scan-item">
                    <div>
                        <strong>${scan.platform}</strong> - ${scan.region}<br>
                        <small>Risk Level: ${scan.risk_level} | Score: ${scan.compliance_score}</small><br>
                        <small>${results.violation_type || 'No violation'}: ${results.description || 'Clean scan'}</small>
                    </div>
                    <div class="status-badge ${statusBadge}">${scan.status}</div>
                    <div>${new Date(scan.created_at).toLocaleDateString()}</div>
                </div>`;
            });
            
            scansList.innerHTML = html;
        }

        async function showPlatformRules() {
            console.log("Opening Platform Rules...");
            document.getElementById("platformRulesModal").classList.add("active");
            await loadPlatformRules();
            updateLanguage(); // Re-apply language after modal opens
            showToast("Platform Rules opened - Live data loaded");
        }

        function showSystemSettings() {
            console.log("Opening System Settings...");
            document.getElementById("systemSettingsModal").classList.add("active");
            updateLanguage(); // Re-apply language after modal opens
            showToast("System Settings opened");
        }

        function showSupportCenter() {
            console.log("Opening Support Center...");
            document.getElementById("supportCenterModal").classList.add("active");
            updateLanguage(); // Re-apply language after modal opens
            showToast("Support Center opened");
        }

        function activateEmergencyMode() {
            console.log("Activating Emergency Mode...");
            document.getElementById("emergencyModal").classList.add("active");
            updateLanguage(); // Re-apply language after modal opens
            showToast("Emergency Mode activated - Use with caution!", "error");
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove("active");
        }

        async function loadPlatformRules() {
    const rulesContent = document.getElementById("platformRulesContent");
    if (!rulesContent) return;
    
    rulesContent.innerHTML = `
        <div style="margin-bottom: 2rem;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <h3 style="color: var(--text-primary); margin: 0;">Platform Rules Management</h3>
                <button onclick="addNewRule()" style="background: var(--accent-gradient); border: none; color: white; padding: 0.75rem 1.5rem; border-radius: 12px; cursor: pointer; font-weight: 600;">+ Add Rule</button>
            </div>
            
            <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap;">
                <select id="rulesplatformFilter" onchange="filterRules()" class="platform-rules-select">
                    <option value="">All Platforms</option>
                    <option value="TikTok">TikTok</option>
                    <option value="Instagram">Instagram</option>
                    <option value="YouTube">YouTube</option>
                    <option value="Facebook">Facebook</option>
                    <option value="X/Twitter">Twitter</option>
                    <option value="Snapchat">Snapchat</option>
                </select>
                <select id="categoryFilter" onchange="filterRules()" class="platform-rules-select">
                    <option value="">All Categories</option>
                    <option value="Violence & Dangerous Content">Violence & Dangerous Content</option>
                    <option value="Youth Safety">Youth Safety</option>
                    <option value="Hate Speech">Hate Speech</option>
                    <option value="Nudity & Sexual Content">Nudity & Sexual Content</option>
                </select>
                <button onclick="exportRules()" style="background: var(--secondary-gradient); border: none; color: white; padding: 0.5rem 1rem; border-radius: 12px; cursor: pointer; font-weight: 600;">📄 Export</button>
            </div>
        </div>
        
        <div id="rulesTableContainer" style="max-height: 400px; overflow-y: auto;">
            <div class="rules-loading">Loading platform rules...</div>
        </div>
        
        <!-- Add/Edit Rule Modal -->
        <div id="ruleEditModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 3000; padding: 20px;">
            <div style="background: var(--glass-bg); backdrop-filter: var(--blur-xl); border: 1px solid var(--glass-border); border-radius: 24px; padding: 2rem; max-width: 600px; margin: 50px auto; color: var(--text-primary);">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                    <h3 id="ruleModalTitle">Add New Rule</h3>
                    <button onclick="closeRuleModal()" style="background: none; border: none; color: var(--text-primary); font-size: 1.5rem; cursor: pointer;">&times;</button>
                </div>
                
                <div style="display: grid; gap: 1rem;">
                    <div>
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Platform:</label>
                        <select id="rulePlatform" required style="width: 100%; padding: 0.75rem; border-radius: 12px; border: 1px solid var(--glass-border); background: var(--glass-bg); color: var(--text-primary);">
                            <option value="">Select Platform</option>
                            <option value="TikTok">TikTok</option>
                            <option value="Instagram">Instagram</option>
                            <option value="YouTube">YouTube</option>
                            <option value="Facebook">Facebook</option>
                            <option value="X/Twitter">Twitter</option>
                            <option value="Snapchat">Snapchat</option>
                        </select>
                    </div>
                    
                    <div>
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Category:</label>
                        <select id="ruleCategory" style="width: 100%; padding: 0.75rem; border-radius: 12px; border: 1px solid var(--glass-border); background: var(--glass-bg); color: var(--text-primary);">
                            <option value="Violence & Dangerous Content">Violence & Dangerous Content</option>
                            <option value="Youth Safety">Youth Safety</option>
                            <option value="Hate Speech">Hate Speech</option>
                            <option value="Nudity & Sexual Content">Nudity & Sexual Content</option>
                        </select>
                    </div>
                    
                    <div>
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Rule Text:</label>
                        <textarea id="ruleText" required rows="4" style="width: 100%; padding: 0.75rem; border-radius: 12px; border: 1px solid var(--glass-border); background: var(--glass-bg); color: var(--text-primary); resize: vertical;" placeholder="Enter the rule description..."></textarea>
                    </div>
                    
                    <div>
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Source URL (optional):</label>
                        <input type="url" id="ruleSourceUrl" style="width: 100%; padding: 0.75rem; border-radius: 12px; border: 1px solid var(--glass-border); background: var(--glass-bg); color: var(--text-primary);" placeholder="https://...">
                    </div>
                    
                    <div>
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Admin Notes (optional):</label>
                        <textarea id="ruleAdminNotes" rows="2" style="width: 100%; padding: 0.75rem; border-radius: 12px; border: 1px solid var(--glass-border); background: var(--glass-bg); color: var(--text-primary); resize: vertical;" placeholder="Internal notes..."></textarea>
                    </div>
                    
                    <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                        <button onclick="saveRule()" style="flex: 1; background: var(--accent-gradient); border: none; color: white; padding: 0.75rem; border-radius: 12px; cursor: pointer; font-weight: 600;">Save Rule</button>
                        <button onclick="closeRuleModal()" style="flex: 1; background: var(--glass-bg); border: 1px solid var(--glass-border); color: var(--text-primary); padding: 0.75rem; border-radius: 12px; cursor: pointer; font-weight: 600;">Cancel</button>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    // Load rules data
    await loadRulesData();
}

        // Close modals when clicking outside
        window.addEventListener("click", function(event) {
            if (event.target.classList.contains("control-modal")) {
                event.target.classList.remove("active");
            }
        });

        console.log('CheckReel Premium Admin Dashboard v5.0 - Million Dollar Design - All Systems Operational');
        // Platform Rules Management Functions
let allRules = [];
let currentEditingRule = null;

async function loadRulesData() {
    const container = document.getElementById("rulesTableContainer");
    if (!container) return;
    
    try {
        const response = await fetch(ADMIN_SUPABASE_URL + "/rest/v1/platform_rules?select=*&order=platform,category,id", {
            headers: {
                "Authorization": "Bearer " + SUPABASE_KEY,
                "apikey": SUPABASE_KEY,
                "Content-Type": "application/json"
            }
        });
        
        if (response.ok) {
            allRules = await response.json();
            displayRulesTable(allRules);
        } else {
            container.innerHTML = `<div class="rules-loading">No rules found. <button onclick="addSampleRules()" style="background: var(--accent-gradient); border: none; color: white; padding: 0.5rem 1rem; border-radius: 8px; margin-left: 1rem;">Add Sample Rules</button></div>`;
        }
    } catch (error) {
        console.error("Rules loading error:", error);
        container.innerHTML = `<div class="rules-loading">Error loading rules. <button onclick="addSampleRules()" style="background: var(--accent-gradient); border: none; color: white; padding: 0.5rem 1rem; border-radius: 8px; margin-left: 1rem;">Add Sample Rules</button></div>`;
    }
}

function displayRulesTable(rules) {
    const container = document.getElementById("rulesTableContainer");
    if (!rules.length) {
        container.innerHTML = `<div class="rules-loading">No rules found. <button onclick="addSampleRules()" style="background: var(--accent-gradient); border: none; color: white; padding: 0.5rem 1rem; border-radius: 8px; margin-left: 1rem;">Add Sample Rules</button></div>`;
        return;
    }
    
    let html = `<div style="background: var(--glass-bg); border-radius: 16px; overflow: hidden;">`;
    
    rules.forEach(rule => {
        const isActive = rule.is_active;
        const statusColor = isActive ? '#10b981' : '#6b7280';
        const statusText = isActive ? 'Active' : 'Inactive';
        
        html += `
            <div class="scan-item" style="margin-bottom: 0; border-bottom: 1px solid var(--glass-border); border-radius: 0;">
                <div style="flex: 1;">
                    <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.5rem;">
                        <strong style="color: var(--text-primary); text-transform: capitalize;">${rule.platform}</strong>
                        <span style="background: rgba(59, 130, 246, 0.2); color: #3b82f6; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.8rem; font-weight: 600;">${rule.category || 'General'}</span>
                        <span style="color: ${statusColor}; font-size: 0.8rem; font-weight: 600;">${statusText}</span>
                    </div>
                    <div style="color: var(--text-secondary); margin-bottom: 0.5rem; line-height: 1.4;">${rule.rule_text}</div>
                    ${rule.source_url ? `<div style="font-size: 0.8rem; color: var(--text-muted);"><a href="${rule.source_url}" target="_blank" style="color: #3b82f6;">📎 Source</a></div>` : ''}
                    ${rule.admin_notes ? `<div style="font-size: 0.8rem; color: var(--text-muted); font-style: italic;">Notes: ${rule.admin_notes}</div>` : ''}
                </div>
                <div style="display: flex; flex-direction: column; gap: 0.5rem; align-items: flex-end;">
                    <div style="font-size: 0.8rem; color: var(--text-muted);">${new Date(rule.last_updated).toLocaleDateString()}</div>
                    <div style="display: flex; gap: 0.5rem;">
                        <button onclick="editRule(${rule.id})" style="background: var(--secondary-gradient); border: none; color: white; padding: 0.4rem 0.8rem; border-radius: 8px; cursor: pointer; font-size: 0.8rem;">Edit</button>
                        <button onclick="toggleRuleStatus(${rule.id}, ${!isActive})" style="background: ${isActive ? 'var(--danger-gradient)' : 'var(--accent-gradient)'}; border: none; color: white; padding: 0.4rem 0.8rem; border-radius: 8px; cursor: pointer; font-size: 0.8rem;">${isActive ? 'Disable' : 'Enable'}</button>
                        <button onclick="deleteRule(${rule.id})" style="background: #dc3545; border: none; color: white; padding: 0.4rem 0.8rem; border-radius: 8px; cursor: pointer; font-size: 0.8rem;">Delete</button>
                    </div>
                </div>
            </div>
        `;
    });
    
    html += `</div>`;
    container.innerHTML = html;
}

function filterRules() {
    const platformFilter = document.getElementById("rulesplatformFilter").value;
    const categoryFilter = document.getElementById("categoryFilter").value;
    
    let filteredRules = allRules;
    
    if (platformFilter) {
        filteredRules = filteredRules.filter(rule => rule.platform === platformFilter);
    }
    
    if (categoryFilter) {
        filteredRules = filteredRules.filter(rule => rule.category === categoryFilter);
    }
    
    displayRulesTable(filteredRules);
}

function addNewRule() {
    currentEditingRule = null;
    document.getElementById("ruleModalTitle").textContent = "Add New Rule";
    document.getElementById("rulePlatform").value = "";
    document.getElementById("ruleCategory").value = "Violence & Dangerous Content";
    document.getElementById("ruleText").value = "";
    document.getElementById("ruleSourceUrl").value = "";
    document.getElementById("ruleAdminNotes").value = "";
    document.getElementById("ruleEditModal").style.display = "block";
    updateLanguage(); // Apply language to newly shown modal
}

function editRule(ruleId) {
    const rule = allRules.find(r => r.id === ruleId);
    if (!rule) return;
    
    currentEditingRule = rule;
    document.getElementById("ruleModalTitle").textContent = "Edit Rule";
    document.getElementById("rulePlatform").value = rule.platform;
    document.getElementById("ruleCategory").value = rule.category || "Violence & Dangerous Content";
    document.getElementById("ruleText").value = rule.rule_text;
    document.getElementById("ruleSourceUrl").value = rule.source_url || "";
    document.getElementById("ruleAdminNotes").value = rule.admin_notes || "";
    document.getElementById("ruleEditModal").style.display = "block";
    updateLanguage(); // Apply language to newly shown modal
}

function closeRuleModal() {
    document.getElementById("ruleEditModal").style.display = "none";
    currentEditingRule = null;
}

async function saveRule() {
    const platform = document.getElementById("rulePlatform").value;
    const category = document.getElementById("ruleCategory").value;
    const ruleText = document.getElementById("ruleText").value;
    const sourceUrl = document.getElementById("ruleSourceUrl").value;
    const adminNotes = document.getElementById("ruleAdminNotes").value;
    
    if (!platform || !ruleText.trim()) {
        alert("Platform and Rule Text are required");
        return;
    }
    
    const ruleData = {
        platform,
        category,
        rule_text: ruleText.trim(),
        source_url: sourceUrl || null,
        admin_notes: adminNotes || null,
        is_active: true
    };
    
    try {
        let response;
        
        if (currentEditingRule) {
            // Update existing rule
            response = await fetch(ADMIN_SUPABASE_URL + `/rest/v1/platform_rules?id=eq.${currentEditingRule.id}`, {
                method: 'PATCH',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Bearer ' + SUPABASE_KEY,
                    'apikey': SUPABASE_KEY
                },
                body: JSON.stringify(ruleData)
            });
        } else {
            // Create new rule
            response = await fetch(ADMIN_SUPABASE_URL + '/rest/v1/platform_rules', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Bearer ' + SUPABASE_KEY,
                    'apikey': SUPABASE_KEY
                },
                body: JSON.stringify(ruleData)
            });
        }
        
        if (response.ok) {
            showToast(currentEditingRule ? 'Rule updated successfully' : 'Rule created successfully');
            closeRuleModal();
            await loadRulesData();
        } else {
            throw new Error('Failed to save rule');
        }
    } catch (error) {
        console.error('Save rule error:', error);
        showToast('Failed to save rule: ' + error.message, 'error');
    }
}

async function toggleRuleStatus(ruleId, newStatus) {
    try {
        const response = await fetch(ADMIN_SUPABASE_URL + `/rest/v1/platform_rules?id=eq.${ruleId}`, {
            method: 'PATCH',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': 'Bearer ' + SUPABASE_KEY,
                'apikey': SUPABASE_KEY
            },
            body: JSON.stringify({ is_active: newStatus })
        });
        
        if (response.ok) {
            showToast(`Rule ${newStatus ? 'enabled' : 'disabled'} successfully`);
            await loadRulesData();
        } else {
            throw new Error('Failed to update rule status');
        }
    } catch (error) {
        console.error('Toggle rule status error:', error);
        showToast('Failed to update rule status', 'error');
    }
}

async function deleteRule(ruleId) {
    if (!confirm('Are you sure you want to delete this rule?')) return;
    
    try {
        const response = await fetch(ADMIN_SUPABASE_URL + `/rest/v1/platform_rules?id=eq.${ruleId}`, {
            method: 'DELETE',
            headers: {
                'Authorization': 'Bearer ' + SUPABASE_KEY,
                'apikey': SUPABASE_KEY
            }
        });
        
        if (response.ok) {
            showToast('Rule deleted successfully');
            await loadRulesData();
        } else {
            throw new Error('Failed to delete rule');
        }
    } catch (error) {
        console.error('Delete rule error:', error);
        showToast('Failed to delete rule', 'error');
    }
}

async function addSampleRules() {
    const sampleRules = [
        { platform: 'TikTok', category: 'Violence & Dangerous Content', rule_text: 'Videos must be between 15 seconds and 10 minutes long', source_url: 'https://support.tiktok.com/en/using-tiktok/creating-videos/video-length' },
        { platform: 'TikTok', category: 'Youth Safety', rule_text: 'No violent or graphic content that could shock or disturb viewers', source_url: 'https://www.tiktok.com/community-guidelines' },
        { platform: 'Instagram', category: 'Nudity & Sexual Content', rule_text: 'Stories must be in 9:16 aspect ratio for optimal display', source_url: 'https://help.instagram.com/1631821640426723' },
        { platform: 'Instagram', category: 'Hate Speech', rule_text: 'Music clips longer than 30 seconds may be subject to copyright claims', source_url: 'https://help.instagram.com/126382251081970' },
        { platform: 'YouTube', category: 'Violence & Dangerous Content', rule_text: 'Thumbnails must accurately represent video content', source_url: 'https://support.google.com/youtube/answer/72431' },
        { platform: 'Facebook', category: 'Youth Safety', rule_text: 'Posts must not contain misleading health information', source_url: 'https://www.facebook.com/communitystandards' }
    ];
    
    try {
        for (const rule of sampleRules) {
            await fetch(ADMIN_SUPABASE_URL + '/rest/v1/platform_rules', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Bearer ' + SUPABASE_KEY,
                    'apikey': SUPABASE_KEY
                },
                body: JSON.stringify({
                    ...rule,
                    is_active: true
                })
            });
        }
        
        showToast('Sample rules added successfully');
        await loadRulesData();
    } catch (error) {
        console.error('Add sample rules error:', error);
        showToast('Failed to add sample rules', 'error');
    }
}

var emergencyModes = {
    stopScans: false,
    killAPI: false,
    maintenanceDB: false,
    bypassLimits: false,
    priorityQueue: false,
    resourceOverride: false,
    bulkSuspend: false,
    contentBlocks: false,
    emergencyAlerts: false,
    clearCache: false,
    restartServices: false,
    rollbackConfig: false
};

function toggleEmergencyMode(toggle, mode) {
    const isActive = toggle.checked;
    emergencyModes[mode] = isActive;
    
    if (isActive) {
        const confirmMsg = ` CRITICAL: Activate ${mode}? This action will be logged and monitored.`;
        if (!confirm(confirmMsg)) {
            toggle.checked = false;
            emergencyModes[mode] = false;
            return;
        }
        
        showToast(`Emergency Mode: ${mode} ACTIVATED`, "error");
        console.log(`?? EMERGENCY: ${mode} activated at ${new Date().toISOString()}`);
        
        // Log to Supabase emergency_logs table
        logEmergencyAction(mode, "ACTIVATED");
        
        // Execute emergency action
        executeEmergencyAction(mode, true);
        
    } else {
        showToast(`Emergency Mode: ${mode} deactivated`, "success");
        console.log(`? RECOVERY: ${mode} deactivated at ${new Date().toISOString()}`);
        
        logEmergencyAction(mode, "DEACTIVATED");
        executeEmergencyAction(mode, false);
    }
    
    updateEmergencyStatus();
}

async function logEmergencyAction(mode, action) {
    try {
        await fetch(ADMIN_SUPABASE_URL + "/rest/v1/emergency_logs", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "Authorization": "Bearer " + SUPABASE_KEY,
                "apikey": SUPABASE_KEY
            },
            body: JSON.stringify({
                mode: mode,
                action: action,
                timestamp: new Date().toISOString(),
                admin_user: "admin", // Replace with actual user
                details: `Emergency mode ${mode} was ${action.toLowerCase()}`
            })
        });
    } catch (error) {
        console.error("Failed to log emergency action:", error);
    }
}

function executeEmergencyAction(mode, activate) {
    switch(mode) {
        case "stopScans":
            if (activate) {
                // Stop all scanning operations
                window.emergencyStopScans = true;
                showToast(" All scanning operations halted", "error");
            } else {
                window.emergencyStopScans = false;
                showToast(" Scanning operations resumed", "success");
            }
            break;
            
        case "killAPI":
            if (activate) {
                window.emergencyKillAPI = true;
                showToast(" API connections terminated", "error");
            } else {
                window.emergencyKillAPI = false;
                showToast(" API connections restored", "success");
            }
            break;
            
        case "maintenanceDB":
            if (activate) {
                window.emergencyMaintenanceMode = true;
                showToast("?? Database in maintenance mode", "error");
            } else {
                window.emergencyMaintenanceMode = false;
                showToast("?? Database maintenance mode disabled", "success");
            }
            break;
            
        case "bypassLimits":
            if (activate) {
                window.emergencyBypassLimits = true;
                showToast(" Rate limits bypassed", "error");
            } else {
                window.emergencyBypassLimits = false;
                showToast(" Rate limits restored", "success");
            }
            break;
            
        case "priorityQueue":
            if (activate) {
                window.emergencyPriorityMode = true;
                showToast(" Priority queue mode active", "error");
            } else {
                window.emergencyPriorityMode = false;
                showToast(" Normal queue processing restored", "success");
            }
            break;
            
        case "resourceOverride":
            if (activate) {
                window.emergencyResourceOverride = true;
                showToast(" Resource allocation overridden", "error");
            } else {
                window.emergencyResourceOverride = false;
                showToast(" Normal resource allocation restored", "success");
            }
            break;
            
        case "bulkSuspend":
            if (activate) {
                window.emergencyBulkSuspend = true;
                showToast(" Bulk suspension mode active", "error");
            } else {
                window.emergencyBulkSuspend = false;
                showToast(" Bulk suspension mode disabled", "success");
            }
            break;
            
        case "contentBlocks":
            if (activate) {
                window.emergencyContentBlocks = true;
                showToast(" Platform-wide content blocks active", "error");
            } else {
                window.emergencyContentBlocks = false;
                showToast(" Content blocks disabled", "success");
            }
            break;
            
        case "emergencyAlerts":
            if (activate) {
                window.emergencyAlertsActive = true;
                showToast(" Emergency notifications active", "error");
                sendEmergencyAlert("Emergency mode activated by admin");
            } else {
                window.emergencyAlertsActive = false;
                showToast(" Emergency notifications disabled", "success");
            }
            break;
            
        case "clearCache":
            if (activate) {
                // Clear caches
                showToast(" System caches cleared", "success");
                setTimeout(() => document.getElementById("clearCache").checked = false, 2000);
            }
            break;
            
        case "restartServices":
            if (activate) {
                showToast(" Core services restarting...", "error");
                setTimeout(() => {
                    showToast(" Core services restarted", "success");
                    document.getElementById("restartServices").checked = false;
                }, 3000);
            }
            break;
            
        case "rollbackConfig":
            if (activate) {
                showToast(" Rolling back to last known good configuration...", "error");
                setTimeout(() => {
                    showToast(" Configuration rollback complete", "success");
                    document.getElementById("rollbackConfig").checked = false;
                }, 4000);
            }
            break;
    }
}

function updateEmergencyStatus() {
    const statusEl = document.getElementById("emergencyStatus");
    const activeModes = Object.keys(emergencyModes).filter(mode => emergencyModes[mode]);
    
    if (activeModes.length === 0) {
        statusEl.innerHTML = " All systems operating normally. No emergency modes active.";
        statusEl.style.color = "var(--text-secondary)";
    } else {
        statusEl.innerHTML = ` EMERGENCY MODES ACTIVE (${activeModes.length}):<br>` + 
            activeModes.map(mode => ` ${mode.toUpperCase()}`).join("<br>");
        statusEl.style.color = "#ef4444";
    }
}

async function sendEmergencyAlert(message) {
    try {
        // Send emergency notification
        await fetch(ADMIN_SUPABASE_URL + "/rest/v1/emergency_notifications", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "Authorization": "Bearer " + SUPABASE_KEY,
                "apikey": SUPABASE_KEY
            },
            body: JSON.stringify({
                message: message,
                timestamp: new Date().toISOString(),
                severity: "CRITICAL",
                admin_user: "admin"
            })
        });
    } catch (error) {
        console.error("Failed to send emergency alert:", error);
    }
}

function exportRules() {
    const csvContent = "data:text/csv;charset=utf-8," + 
        "Platform,Category,Rule Text,Source URL,Status,Last Updated,Admin Notes\n" +
        allRules.map(rule => {
            return `"${rule.platform}","${rule.category || ''}","${rule.rule_text.replace(/"/g, '""')}","${rule.source_url || ''}","${rule.is_active ? 'Active' : 'Inactive'}","${rule.last_updated}","${rule.admin_notes || ''}"`;
        }).join("\n");
    
    const encodedUri = encodeURI(csvContent);
    const link = document.createElement("a");
    link.setAttribute("href", encodedUri);
    link.setAttribute("download", `platform_rules_${new Date().toISOString().split('T')[0]}.csv`);
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    
    showToast('Rules exported successfully');
}
    </script>

    <script>
        async function initRevenueChart() {
            try {
                console.log("Revenue chart disabled - no subscriptions table");
                return;
                
                const monthlyRevenue = {};
                data.forEach(sub => {
                    const month = new Date(sub.created_at).toLocaleString("default", {month: "short"});
                    const revenue = sub.tier === "premium" ? 9.99 : 4.99;
                    monthlyRevenue[month] = (monthlyRevenue[month] || 0) + revenue;
                });
                
                new Chart(document.getElementById("revenueChart"), {
                    type: "line",
                    data: {
                        labels: Object.keys(monthlyRevenue),
                        datasets: [{
                            label: "Revenue ($)",
                            data: Object.values(monthlyRevenue),
                            borderColor: "#667eea",
                            backgroundColor: "rgba(102, 126, 234, 0.1)",
                            tension: 0.4
                        }]
                    },
                    options: { responsive: true, maintainAspectRatio: false }
                });
            } catch (error) {
                console.error("Revenue chart error:", error);
            }
        }
        document.addEventListener("DOMContentLoaded", initRevenueChart);
        
        // Export Scan History Function
        function exportScanHistory() {
            // This would export the current scan history to CSV
            showToast('Scan history export feature coming soon!');
        }
    </script>
    <!-- Control Action Modals -->
    <div class="control-modal" id="scanHistoryModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>📊 Scan History</h2>
                <button class="close-btn" onclick="closeModal('scanHistoryModal')">Close</button>
            </div>
            <div class="modal-filters" style="display: flex; gap: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap;">
                <select id="platformFilter" style="background: var(--glass-bg); border: 1px solid var(--glass-border); color: var(--text-primary); padding: 0.5rem 1rem; border-radius: 12px;">
                    <option value="">All Platforms</option>
                    <option value="TikTok">TikTok</option>
                    <option value="Instagram">Instagram</option>
                    <option value="YouTube">YouTube</option>
                    <option value="Facebook">Facebook</option>
                </select>
                <select id="statusFilter" style="background: var(--glass-bg); border: 1px solid var(--glass-border); color: var(--text-primary); padding: 0.5rem 1rem; border-radius: 12px;">
                    <option value="">All Status</option>
                    <option value="clean">Clean</option>
                    <option value="violation">Violation</option>
                </select>
                <button onclick="exportScanHistory()" style="background: var(--accent-gradient); border: none; color: white; padding: 0.5rem 1rem; border-radius: 12px; cursor: pointer; font-weight: 600;">📄 Export CSV</button>
            </div>
            <div class="scan-list" id="scanHistoryList">
                <div class="rules-loading">Loading scan history from database...</div>
            </div>
        </div>
    </div>

    <div class="control-modal" id="platformRulesModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>📋 Platform Rules</h2>
                <button class="close-btn" onclick="closeModal('platformRulesModal')">Close</button>
            </div>
            <div id="platformRulesContent">
                <div class="rules-loading">Loading latest platform rules...</div>
            </div>
        </div>
    </div>

    <div class="control-modal" id="systemSettingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>⚙️ System Settings</h2>
                <button class="close-btn" onclick="closeModal('systemSettingsModal')">Close</button>
            </div>
            <div>
                <h3 style="color: var(--text-primary); margin-bottom: 1.5rem;">System Configuration</h3>
                <div style="display: grid; gap: 1.5rem;">
                    <div style="background: var(--glass-bg); padding: 1.5rem; border-radius: 16px; border: 1px solid var(--glass-border);">
                        <h4 style="color: var(--text-primary); margin-bottom: 1rem;">API Settings</h4>
                        <div style="display: grid; gap: 1rem;">
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; color: var(--text-secondary);">Rate Limit (requests/minute):</label>
                                <input type="number" value="1000" style="width: 100%; padding: 0.75rem; border-radius: 12px; border: 1px solid var(--glass-border); background: var(--glass-bg); color: var(--text-primary);">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; color: var(--text-secondary);">Timeout (seconds):</label>
                                <input type="number" value="30" style="width: 100%; padding: 0.75rem; border-radius: 12px; border: 1px solid var(--glass-border); background: var(--glass-bg); color: var(--text-primary);">
                            </div>
                        </div>
                    </div>
                    <div style="background: var(--glass-bg); padding: 1.5rem; border-radius: 16px; border: 1px solid var(--glass-border);">
                        <h4 style="color: var(--text-primary); margin-bottom: 1rem;">Notification Settings</h4>
                        <div style="display: grid; gap: 1rem;">
                            <label style="display: flex; align-items: center; gap: 0.75rem; color: var(--text-primary);">
                                <input type="checkbox" checked style="transform: scale(1.2);">
                                Email notifications for critical alerts
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.75rem; color: var(--text-primary);">
                                <input type="checkbox" checked style="transform: scale(1.2);">
                                SMS notifications for system failures
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.75rem; color: var(--text-primary);">
                                <input type="checkbox" style="transform: scale(1.2);">
                                Daily summary reports
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="control-modal" id="supportCenterModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>🆘 Support Center</h2>
                <button class="close-btn" onclick="closeModal('supportCenterModal')">Close</button>
            </div>
            <div>
                <h3 style="color: var(--text-primary); margin-bottom: 1.5rem;">Help & Support</h3>
                <div style="display: grid; gap: 1.5rem;">
                    <div style="background: var(--glass-bg); padding: 1.5rem; border-radius: 16px; border: 1px solid var(--glass-border);">
                        <h4 style="color: var(--text-primary); margin-bottom: 1rem;">📚 Documentation</h4>
                        <div style="display: grid; gap: 0.75rem;">
                            <a href="#" style="color: #3b82f6; text-decoration: none; padding: 0.5rem; background: rgba(59, 130, 246, 0.1); border-radius: 8px; display: block;">API Documentation</a>
                            <a href="#" style="color: #3b82f6; text-decoration: none; padding: 0.5rem; background: rgba(59, 130, 246, 0.1); border-radius: 8px; display: block;">User Guide</a>
                            <a href="#" style="color: #3b82f6; text-decoration: none; padding: 0.5rem; background: rgba(59, 130, 246, 0.1); border-radius: 8px; display: block;">Troubleshooting Guide</a>
                        </div>
                    </div>
                    <div style="background: var(--glass-bg); padding: 1.5rem; border-radius: 16px; border: 1px solid var(--glass-border);">
                        <h4 style="color: var(--text-primary); margin-bottom: 1rem;">📞 Contact Support</h4>
                        <div style="display: grid; gap: 0.75rem;">
                            <div style="color: var(--text-secondary);">Email: support@checkreel.com</div>
                            <div style="color: var(--text-secondary);">Phone: +1 (555) 123-4567</div>
                            <div style="color: var(--text-secondary);">Response Time: 24 hours</div>
                        </div>
                    </div>
                    <div style="background: var(--glass-bg); padding: 1.5rem; border-radius: 16px; border: 1px solid var(--glass-border);">
                        <h4 style="color: var(--text-primary); margin-bottom: 1rem;">🎫 Submit Ticket</h4>
                        <div style="display: grid; gap: 1rem;">
                            <select style="width: 100%; padding: 0.75rem; border-radius: 12px; border: 1px solid var(--glass-border); background: var(--glass-bg); color: var(--text-primary);">
                                <option>Select Priority</option>
                                <option>Critical</option>
                                <option>High</option>
                                <option>Medium</option>
                                <option>Low</option>
                            </select>
                            <textarea placeholder="Describe your issue..." rows="4" style="width: 100%; padding: 0.75rem; border-radius: 12px; border: 1px solid var(--glass-border); background: var(--glass-bg); color: var(--text-primary); resize: vertical;"></textarea>
                            <button style="background: var(--accent-gradient); border: none; color: white; padding: 0.75rem 1.5rem; border-radius: 12px; cursor: pointer; font-weight: 600;">Submit Ticket</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</html>
                
    <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CheckReel Admin Control Room</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#667eea">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            --secondary-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --accent-gradient: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            --danger-gradient: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            --glass-bg: rgba(255, 255, 255, 0.08);
            --glass-border: rgba(255, 255, 255, 0.18);
            --text-primary: rgba(255, 255, 255, 0.95);
            --text-secondary: rgba(255, 255, 255, 0.7);
            --text-muted: rgba(255, 255, 255, 0.5);
            --shadow-lg: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            --shadow-xl: 0 35px 60px -12px rgba(0, 0, 0, 0.3);
            --blur-lg: blur(16px);
            --blur-xl: blur(24px);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--primary-gradient);
            background-attachment: fixed;
            min-height: 100vh;
            color: var(--text-primary);
            line-height: 1.6;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 20%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(255, 118, 117, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(56, 249, 215, 0.2) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        [dir="rtl"] {
            direction: rtl;
            text-align: right;
        }

        .header {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: var(--blur-lg);
            border-bottom: 1px solid var(--glass-border);
            padding: 1.5rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1.5rem;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow-lg);
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .logo {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, #fff 0%, #f0f0f0 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            cursor: pointer;
            transition: all 0.3s ease;
            letter-spacing: -0.02em;
        }

        .logo:hover {
            transform: scale(1.05);
            filter: drop-shadow(0 0 20px rgba(255, 255, 255, 0.3));
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .language-selector, .pwa-install, .control-toggle {
            background: var(--glass-bg);
            backdrop-filter: var(--blur-lg);
            border: 1px solid var(--glass-border);
            color: var(--text-primary);
            padding: 0.75rem 1.5rem;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 500;
            font-size: 0.9rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .language-selector:hover, .pwa-install:hover, .control-toggle:hover {
            transform: translateY(-2px);
            background: rgba(255, 255, 255, 0.12);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.2);
        }

        #adminToggle {
            display: none;
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            border: 1px solid rgba(255, 107, 107, 0.3);
            box-shadow: 0 8px 32px rgba(255, 107, 107, 0.2);
        }

        .main-container {
            display: grid;
            grid-template-columns: 1fr 380px;
            gap: 2.5rem;
            padding: 2.5rem;
            max-width: 1800px;
            margin: 0 auto;
        }

        .dashboard-content {
            display: flex;
            flex-direction: column;
            gap: 2.5rem;
        }

        .status-bar {
            background: var(--glass-bg);
            backdrop-filter: var(--blur-xl);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 1.5rem 2.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1.5rem;
            box-shadow: var(--shadow-lg);
            position: relative;
            overflow: hidden;
        }

        .status-bar::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--accent-gradient);
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            color: var(--text-primary);
            font-weight: 500;
        }

        .status-indicator {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            animation: pulse 2s infinite;
            box-shadow: 0 0 20px currentColor;
        }

        .status-indicator.online { 
            background: #10b981;
            box-shadow: 0 0 20px #10b981;
        }
        
        .status-indicator.warning { 
            background: #f59e0b;
            box-shadow: 0 0 20px #f59e0b;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.1); }
        }

        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 2rem;
        }

        .kpi-card {
            background: var(--glass-bg);
            backdrop-filter: var(--blur-xl);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 2rem;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
        }

        .kpi-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--secondary-gradient);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .kpi-card:hover::before {
            transform: scaleX(1);
        }

        .kpi-card:hover {
            transform: translateY(-8px) scale(1.02);
            background: rgba(255, 255, 255, 0.12);
            box-shadow: var(--shadow-xl);
        }

        .kpi-card:nth-child(1)::before { background: var(--accent-gradient); }
        .kpi-card:nth-child(2)::before { background: var(--secondary-gradient); }
        .kpi-card:nth-child(3)::before { background: var(--danger-gradient); }
        .kpi-card:nth-child(4)::before { background: linear-gradient(135deg, #a78bfa 0%, #ec4899 100%); }
        .kpi-card:nth-child(5)::before { background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); }
        .kpi-card:nth-child(6)::before { background: linear-gradient(135deg, #34d399 0%, #059669 100%); }

        .kpi-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .kpi-title {
            color: var(--text-secondary);
            font-size: 0.95rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .kpi-icon {
            font-size: 2rem;
            opacity: 0.8;
            filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.2));
        }

        .kpi-value {
            font-size: 3rem;
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: 0.75rem;
            line-height: 1;
            letter-spacing: -0.02em;
        }

        .kpi-change {
            font-size: 0.9rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .kpi-change.positive { 
            color: #10b981;
            text-shadow: 0 0 10px rgba(16, 185, 129, 0.3);
        }
        
        .kpi-change.negative { 
            color: #ef4444;
            text-shadow: 0 0 10px rgba(239, 68, 68, 0.3);
        }

        .user-tier-management {
            background: var(--glass-bg);
            backdrop-filter: var(--blur-xl);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 2.5rem;
            margin-bottom: 2.5rem;
            box-shadow: var(--shadow-lg);
            position: relative;
            overflow: hidden;
        }

        .user-tier-management::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--accent-gradient);
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 2rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            letter-spacing: -0.01em;
        }

        .tier-upgrade-form {
            display: grid;
            grid-template-columns: 2fr 1fr auto;
            gap: 1.5rem;
            align-items: end;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .form-label {
            color: var(--text-secondary);
            font-size: 0.95rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .form-input, .form-select {
            padding: 1rem 1.5rem;
            border-radius: 16px;
            border: 1px solid var(--glass-border);
            background: var(--glass-bg);
            backdrop-filter: var(--blur-lg);
            color: var(--text-primary);
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: rgba(102, 126, 234, 0.5);
            background: rgba(255, 255, 255, 0.12);
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1), 0 8px 24px rgba(0, 0, 0, 0.15);
        }

        .form-input::placeholder {
            color: var(--text-muted);
        }

        .form-select option {
            background: #1f2937;
            color: white;
        }

        .btn-upgrade {
            background: var(--accent-gradient);
            border: none;
            color: white;
            padding: 1rem 2rem;
            border-radius: 16px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            box-shadow: 0 8px 32px rgba(67, 233, 123, 0.2);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .btn-upgrade:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 40px rgba(67, 233, 123, 0.3);
        }

        .btn-upgrade:active {
            transform: translateY(-1px);
        }

        .charts-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 2.5rem;
        }

        .chart-container {
            background: var(--glass-bg);
            backdrop-filter: var(--blur-xl);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 2.5rem;
            box-shadow: var(--shadow-lg);
            position: relative;
            overflow: hidden;
        }

        .chart-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--secondary-gradient);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .chart-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            letter-spacing: -0.01em;
        }

        .chart-controls {
            display: flex;
            gap: 0.75rem;
        }

        .chart-btn {
            background: var(--glass-bg);
            backdrop-filter: var(--blur-lg);
            border: 1px solid var(--glass-border);
            color: var(--text-secondary);
            padding: 0.5rem 1rem;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .chart-btn.active, .chart-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            color: var(--text-primary);
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
        }

        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 2.5rem;
            margin-top: 2.5rem;
        }

        .analytics-card {
            background: var(--glass-bg);
            backdrop-filter: var(--blur-xl);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 2rem;
            box-shadow: var(--shadow-lg);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .analytics-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-xl);
        }

        .analytics-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            letter-spacing: -0.01em;
        }

        .metric-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
            transition: all 0.3s ease;
        }

        .metric-item:hover {
            background: rgba(255, 255, 255, 0.03);
            margin: 0 -1rem;
            padding: 1rem;
            border-radius: 12px;
        }

        .metric-item:last-child {
            border-bottom: none;
        }

        .metric-label {
            color: var(--text-secondary);
            font-size: 0.95rem;
            font-weight: 500;
        }

        .metric-value {
            color: var(--text-primary);
            font-weight: 700;
            font-size: 1.1rem;
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 2.5rem;
        }

        .sidebar-section {
            background: var(--glass-bg);
            backdrop-filter: var(--blur-xl);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 2rem;
            box-shadow: var(--shadow-lg);
            position: relative;
            overflow: hidden;
        }

        .sidebar-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            letter-spacing: -0.01em;
        }

        .quick-action, .activity-item, .alert-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            margin-bottom: 0.75rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: var(--blur-lg);
        }

        .quick-action:hover, .activity-item:hover {
            background: rgba(255, 255, 255, 0.12);
            transform: translateX(8px) translateY(-2px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
        }

        .alert-item.critical {
            border-left: 4px solid #ef4444;
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, var(--glass-bg) 100%);
        }

        .alert-item.warning {
            border-left: 4px solid #f59e0b;
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.1) 0%, var(--glass-bg) 100%);
        }

        .alert-item.info {
            border-left: 4px solid #3b82f6;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, var(--glass-bg) 100%);
        }

        .action-icon, .activity-icon, .alert-icon {
            font-size: 1.5rem;
            filter: drop-shadow(0 0 8px rgba(255, 255, 255, 0.2));
        }

        .action-text, .activity-text, .alert-text {
            color: var(--text-primary);
            font-weight: 600;
            flex: 1;
        }

        .activity-details, .alert-details {
            display: flex;
            flex-direction: column;
            flex: 1;
        }

        .activity-time, .alert-time {
            color: var(--text-muted);
            font-size: 0.8rem;
            font-weight: 500;
        }

        .toast {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: var(--blur-xl);
            border-radius: 16px;
            padding: 1.5rem 2rem;
            box-shadow: var(--shadow-xl);
            display: flex;
            align-items: center;
            gap: 1rem;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1000;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        .toast.success {
            border-left: 4px solid #10b981;
        }

        .toast.error {
            border-left: 4px solid #ef4444;
        }

        .toast-icon {
            font-size: 1.5rem;
        }

        .toast-message {
            color: #1f2937;
            font-weight: 600;
        }

        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.2);
            border-top-color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 0.8s linear infinite;
            display: inline-block;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .control-display {
            background: var(--glass-bg);
            backdrop-filter: var(--blur-lg);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 2rem;
            text-align: center;
            height: 240px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .control-display:hover {
            background: rgba(255, 255, 255, 0.12);
            transform: scale(1.02);
        }

        .platform-stats {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .platform-item {
            font-size: 1.2rem;
            color: var(--text-primary);
            padding: 0.75rem;
            background: var(--glass-bg);
            border-radius: 12px;
            font-weight: 600;
        }

        .platform-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.75rem;
            height: 200px;
        }

        .platform-box {
            background: var(--glass-bg);
            backdrop-filter: var(--blur-lg);
            border-radius: 16px;
            padding: 0.5rem;
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 70px;
            border: 1px solid var(--glass-border);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .platform-box:hover {
            transform: translateY(-4px);
            background: rgba(255, 255, 255, 0.12);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
        }

        .platform-icon {
            font-size: 20px;
            margin-bottom: 0.25rem;
            filter: drop-shadow(0 0 8px rgba(255, 255, 255, 0.2));
        }

        .platform-name {
            display: none;
        }

        .platform-count {
            font-size: 1.2rem;
            font-weight: 800;
            color: var(--text-primary);
        }

        #adminSection {
            display: none;
            background: var(--glass-bg);
            backdrop-filter: var(--blur-xl);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 2.5rem;
            margin-bottom: 2.5rem;
            border-left: 4px solid #ef4444;
            box-shadow: var(--shadow-lg);
            position: relative;
            overflow: hidden;
        }

        #adminSection::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--danger-gradient);
        }

        #adminSection.active {
            display: block;
            animation: slideInUp 0.5s ease;
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .control-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: var(--blur-lg);
            z-index: 2000;
            display: none;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease;
        }

        .control-modal.active {
            display: flex;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: var(--glass-bg);
            backdrop-filter: var(--blur-xl);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 2.5rem;
            max-width: 900px;
            width: 90%;
            max-height: 80%;
            overflow-y: auto;
            color: var(--text-primary);
            box-shadow: var(--shadow-xl);
            animation: scaleIn 0.3s ease;
        }

        @keyframes scaleIn {
            from { 
                opacity: 0; 
                transform: scale(0.9);
            }
            to { 
                opacity: 1; 
                transform: scale(1);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--glass-border);
        }

        .close-btn {
            background: var(--glass-bg);
            backdrop-filter: var(--blur-lg);
            border: 1px solid var(--glass-border);
            color: var(--text-primary);
            padding: 0.75rem 1.5rem;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
        }

        .scan-list, .setting-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .scan-item, .setting-item {
            background: var(--glass-bg);
            backdrop-filter: var(--blur-lg);
            border-radius: 16px;
            padding: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid var(--glass-border);
            transition: all 0.3s ease;
        }

        .scan-item:hover, .setting-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }

        .status-badge {
            padding: 0.5rem 1rem;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .status-clean {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.2) 0%, rgba(16, 185, 129, 0.1) 100%);
            color: #10b981;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .status-violation {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.2) 0%, rgba(239, 68, 68, 0.1) 100%);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .rules-loading {
            text-align: center;
            padding: 3rem;
            color: var(--text-secondary);
            font-size: 1.1rem;
            font-weight: 500;
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .tier-upgrade-form {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .main-container {
                grid-template-columns: 1fr;
                padding: 2rem;
            }
        }

        @media (max-width: 1024px) {
            .sidebar {
                order: -1;
            }
            
            .analytics-grid {
                grid-template-columns: 1fr;
            }

            .kpi-grid {
                grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            }
        }

        @media (max-width: 768px) {
            .header {
                padding: 1rem;
                flex-direction: column;
                gap: 1rem;
            }

            .header-controls {
                justify-content: center;
                width: 100%;
            }
            
            .main-container {
                padding: 1rem;
                gap: 1.5rem;
            }
            
            .kpi-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .kpi-value {
                font-size: 2.5rem;
            }

            .logo {
                font-size: 2rem;
            }

            .sidebar-section, .chart-container, .analytics-card {
                padding: 1.5rem;
            }

            .modal-content {
                padding: 2rem;
                margin: 1rem;
            }
        }

        @media (max-width: 480px) {
            .platform-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .status-bar {
                padding: 1rem;
                flex-direction: column;
                gap: 1rem;
            }

            .tier-upgrade-form {
                gap: 0.75rem;
            }

            .form-input, .form-select, .btn-upgrade {
                padding: 0.75rem 1rem;
            }
        }

        /* Advanced Animations */
        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(50px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-50px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .kpi-card:nth-child(1) { animation: fadeInUp 0.6s ease 0.1s both; }
        .kpi-card:nth-child(2) { animation: fadeInUp 0.6s ease 0.2s both; }
        .kpi-card:nth-child(3) { animation: fadeInUp 0.6s ease 0.3s both; }
        .kpi-card:nth-child(4) { animation: fadeInUp 0.6s ease 0.4s both; }
        .kpi-card:nth-child(5) { animation: fadeInUp 0.6s ease 0.5s both; }
        .kpi-card:nth-child(6) { animation: fadeInUp 0.6s ease 0.6s both; }

        .dashboard-content { animation: slideInLeft 0.8s ease 0.2s both; }
        .sidebar { animation: slideInRight 0.8s ease 0.4s both; }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.2) 0%, rgba(255, 255, 255, 0.1) 100%);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.3) 0%, rgba(255, 255, 255, 0.2) 100%);
        }

        /* Loading States */
        .loading-shimmer {
            background: linear-gradient(90deg, 
                rgba(255, 255, 255, 0.1) 25%, 
                rgba(255, 255, 255, 0.2) 50%, 
                rgba(255, 255, 255, 0.1) 75%);
            background-size: 200% 100%;
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        /* Platform Rules Dropdown Styles */
.platform-rules-select {
    background: var(--glass-bg);
    border: 1px solid var(--glass-border);
    color: var(--text-primary);
    padding: 0.5rem 1rem;
    border-radius: 12px;
    transition: all 0.3s ease;
}

.platform-rules-select:hover {
    background: rgba(255, 255, 255, 0.12);
    border-color: #43e97b;
}

.platform-rules-select:focus {
    background: rgba(255, 255, 255, 0.15);
    border-color: #43e97b;
    box-shadow: 0 0 0 3px rgba(67, 233, 123, 0.2);
    outline: none;
}

.emergency-control {
    background: var(--glass-bg);
    border: 1px solid var(--glass-border);
    border-radius: 12px;
    padding: 1rem;
    transition: all 0.3s ease;
}

.emergency-control:hover {
    background: rgba(255, 255, 255, 0.05);
    border-color: rgba(255, 255, 255, 0.2);
}

.emergency-toggle {
    position: relative;
    display: inline-block;
    width: 60px;
    height: 34px;
}

.emergency-toggle input {
    opacity: 0;
    width: 0;
    height: 0;
}

.toggle-slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgba(255, 255, 255, 0.2);
    transition: 0.4s;
    border-radius: 34px;
    border: 1px solid var(--glass-border);
}

.toggle-slider:before {
    position: absolute;
    content: "";
    height: 26px;
    width: 26px;
    left: 4px;
    bottom: 3px;
    background-color: white;
    transition: 0.4s;
    border-radius: 50%;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

.emergency-toggle input:checked + .toggle-slider {
    background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
    border-color: #ef4444;
    box-shadow: 0 0 20px rgba(239, 68, 68, 0.3);
}

.emergency-toggle input:checked + .toggle-slider:before {
    transform: translateX(26px);
}

.platform-rules-select option {
    background: #1f2937;
    color: white;
}
